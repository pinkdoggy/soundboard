<!doctype html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="assets/favicon.png" type="image/png">

  <title>é˜¿è¬èˆ‡å‹•ç‰©æœ‹å‹æŒ‰éˆ•</title>
  <style>
    /* =============================================================================
       1. CSS è®Šæ•¸ç³»çµ±ï¼ˆCSS Custom Propertiesï¼‰
       
       å®šç¾©å…¨ç«™ä½¿ç”¨çš„è¨­è¨ˆ Tokenï¼ŒåŒ…å«ï¼š
       - è‰²å½©ç³»çµ±ï¼ˆäº®è‰²/æš—è‰²ä¸»é¡Œï¼‰
       - é–“è·ç³»çµ±ï¼ˆ4px åŸºç¤å–®ä½ï¼‰
       - åœ“è§’ç³»çµ±
       - é™°å½±ç³»çµ±
       - å‹•ç•«æ™‚é–“ç³»çµ±
       ============================================================================= */

    /* -----------------------------------------------------------------------------
       1.1 æš—è‰²ä¸»é¡Œè®Šæ•¸ï¼ˆé è¨­ï¼‰
       ----------------------------------------------------------------------------- */
    :root {
      /* --- è‰²å½©ï¼šåŸºç¤ --- */
      --bg: #0b0d10;
      /* é é¢èƒŒæ™¯è‰² */
      --search: #0b0d1000;
      /* æœå°‹åˆ—èƒŒæ™¯ï¼ˆé€æ˜ï¼‰ */
      --fg: #e9eef5;
      /* ä¸»è¦æ–‡å­—è‰² */
      --muted: #a8b3c7;
      /* æ¬¡è¦/è¼”åŠ©æ–‡å­—è‰² */
      --card: #141821;
      /* å¡ç‰‡èƒŒæ™¯è‰² */
      --card-2: #212832;
      /* æ¬¡ç´šå¡ç‰‡/æŒ‰éˆ•èƒŒæ™¯è‰² */
      --border: #202636;
      /* é‚Šæ¡†è‰² */

      /* --- è‰²å½©ï¼šå¼·èª¿è‰² --- */
      --accent: #6aa9ff;
      /* ä¸»å¼·èª¿è‰²ï¼ˆè—ï¼‰ */
      --accent-2: #ff9e6a;
      /* æ¬¡å¼·èª¿è‰²ï¼ˆæ©˜ï¼‰ */
      --heart: #ff5a7a;
      /* æ„›å¿ƒ/æ”¶è—è‰² */
      --chip-fg: #0b0d10;
      /* æ¨™ç±¤æ–‡å­—è‰²ï¼ˆæ·±è‰²èƒŒæ™¯ç”¨ï¼‰ */

      /* --- è‰²å½©ï¼šäº’å‹•ç‹€æ…‹ --- */
      --hover-overlay: rgba(96, 150, 255, 0.20);
      /* æ‡¸åœè¦†è“‹å±¤ */

      /* --- ç»ç’ƒæ“¬æ…‹ --- */
      --glass-bg: rgba(20, 24, 33, 0.8);
      /* ç»ç’ƒèƒŒæ™¯ */
      --glass-border: rgba(255, 255, 255, 0.12);
      /* ç»ç’ƒé‚Šæ¡† */

      /* --- èƒŒæ™¯åœ–å±¤ --- */
      --bg-blend-mode: normal;
      /* èƒŒæ™¯æ··åˆæ¨¡å¼ */
      --bg-opacity: 0.25;
      /* èƒŒæ™¯é€æ˜åº¦ */

      /* --- é–“è·ç³»çµ±ï¼ˆ4px åŸºç¤å–®ä½ï¼‰ --- */
      --space-xs: 4px;
      /* æ¥µå°é–“è· */
      --space-sm: 8px;
      /* å°é–“è· */
      --space-md: 12px;
      /* ä¸­é–“è· */
      --space-lg: 16px;
      /* å¤§é–“è· */
      --space-xl: 20px;
      /* ç‰¹å¤§é–“è· */
      --space-2xl: 24px;
      /* è¶…å¤§é–“è· */

      /* --- åœ“è§’ç³»çµ± --- */
      --radius-sm: 8px;
      /* å°åœ“è§’ï¼ˆå°æŒ‰éˆ•ï¼‰ */
      --radius-md: 10px;
      /* ä¸­åœ“è§’ï¼ˆæŒ‰éˆ•ã€Toastï¼‰ */
      --radius-lg: 12px;
      /* å¤§åœ“è§’ï¼ˆå¡ç‰‡ã€é¸å–®ï¼‰ */
      --radius-xl: 16px;
      /* ç‰¹å¤§åœ“è§’ï¼ˆé¢æ¿ï¼‰ */
      --radius-pill: 999px;
      /* è† å›Šåœ“è§’ */

      /* --- é™°å½±ç³»çµ± --- */
      --shadow-sm: 0 2px 6px rgba(0, 0, 0, 0.18);
      /* å°é™°å½±ï¼ˆæ¨™ç±¤ï¼‰ */
      --shadow-md: 0 6px 24px rgba(0, 0, 0, 0.25);
      /* ä¸­é™°å½±ï¼ˆå¡ç‰‡ï¼‰ */
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.35);
      /* å¤§é™°å½±ï¼ˆé ­åƒï¼‰ */
      --shadow: var(--shadow-md);
      /* é è¨­é™°å½±ï¼ˆç›¸å®¹èˆŠä»£ç¢¼ï¼‰ */

      /* --- å‹•ç•«æ™‚é–“ --- */
      --duration-fast: 0.06s;
      /* å¿«é€Ÿå‹•ç•«ï¼ˆé»æ“Šå›é¥‹ï¼‰ */
      --duration-normal: 0.15s;
      /* æ­£å¸¸å‹•ç•«ï¼ˆhoverï¼‰ */
      --duration-slow: 0.3s;
      /* æ…¢é€Ÿå‹•ç•«ï¼ˆè½‰å ´ï¼‰ */

      /* --- æ§åˆ¶é …å°ºå¯¸ --- */
      --control-h: 44px;
      /* æ§åˆ¶é …é«˜åº¦ï¼ˆè§¸æ§å‹å–„ï¼‰ */
    }

    /* -----------------------------------------------------------------------------
       1.2 äº®è‰²ä¸»é¡Œè®Šæ•¸
       ----------------------------------------------------------------------------- */
    :root.light {
      /* --- è‰²å½©ï¼šåŸºç¤ --- */
      --bg: #f8fafc;
      --search: #f8fafc00;
      --fg: #0d1320;
      --muted: #4b5563;
      --card: #ffffff;
      --card-2: #f3f6fb;
      --border: #e5e7eb;

      /* --- è‰²å½©ï¼šå¼·èª¿è‰² --- */
      --accent: #2563eb;
      --accent-2: #eb7b25;
      --heart: #e11d48;
      --chip-fg: #ffffff;

      /* --- ç»ç’ƒæ“¬æ…‹ --- */
      --glass-bg: rgba(255, 255, 255, 0.6);
      --glass-border: rgba(15, 23, 42, 0.12);

      /* --- èƒŒæ™¯åœ–å±¤ --- */
      --bg-blend-mode: normal;
      --bg-opacity: 0.35;

      /* --- é™°å½±ç³»çµ±ï¼ˆäº®è‰²ä¸»é¡Œè¼ƒæ·ºï¼‰ --- */
      --shadow-sm: 0 2px 6px rgba(2, 6, 23, 0.06);
      --shadow-md: 0 4px 18px rgba(2, 6, 23, 0.08);
      --shadow-lg: 0 6px 24px rgba(2, 6, 23, 0.12);
      --shadow: var(--shadow-md);
    }

    /* =============================================================================
       2. CSS Reset / åŸºç¤æ¨£å¼
       
       åŒ…å«ï¼š
       - Box-sizing é‡è¨­
       - Body åŸºç¤æ¨£å¼
       - èƒŒæ™¯åœ–å±¤
       - åŸºç¤å…ƒç´ æ¨£å¼
       ============================================================================= */

    /* --- å…¨åŸŸ Box-sizing --- */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    /* --- HTML/Body åŸºç¤ --- */
    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background-color: var(--bg);
      color: var(--fg);
      font: medium ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Noto Sans, "Helvetica Neue", Arial;
      position: relative;
      z-index: 1;
      /* å°‡æ‰€æœ‰å…§å®¹æå‡åˆ°èƒŒæ™¯åœ–ä¹‹ä¸Š */
    }

    /* --- è‡ªè¨‚æ²è»¸æ¨£å¼ (Webkit) --- */
    ::-webkit-scrollbar {
      width: 14px;
      height: 14px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--muted);
      border-radius: var(--radius-pill);
      border: 3px solid var(--bg); /* å‰µé€ é–“è·æ„Ÿ */
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent);
      border-width: 2px; /* hover æ™‚è®“æ²è»¸çœ‹èµ·ä¾†æ›´ç²—ä¸€é» */
    }

    ::-webkit-scrollbar-corner {
      background: transparent;
    }

    /* --- èƒŒæ™¯åœ–å±¤ï¼ˆå½å…ƒç´ å¯¦ç¾å›ºå®šèƒŒæ™¯ï¼‰ --- */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('assets/background-by-jia.avif');
      background-size: auto 90%;
      background-repeat: repeat;
      background-attachment: fixed;
      mix-blend-mode: var(--bg-blend-mode);
      opacity: var(--bg-opacity);
      z-index: -1;
      pointer-events: none;
    }

    /* --- é€£çµåŸºç¤ --- */
    a {
      color: inherit;
    }

    /* =============================================================================
       3. å…±ç”¨å…ƒä»¶æ¨£å¼
       
       å¯é‡ç”¨çš„ UI å…ƒä»¶ï¼ŒåŒ…å«ï¼š
       - .glassï¼šç»ç’ƒæ“¬æ…‹åŸºç¤
       - .btnï¼šæŒ‰éˆ•ç³»åˆ—
       - .chipï¼šæ¨™ç±¤è† å›Š
       - .tagï¼šéŸ³æ•ˆæ¨™ç±¤
       - .gridï¼šéŸ¿æ‡‰å¼ç¶²æ ¼
       ============================================================================= */

    /* -----------------------------------------------------------------------------
       3.1 ç»ç’ƒæ“¬æ…‹æ¨£å¼
       
       çµ±ä¸€å¥—ç”¨åŠé€æ˜æ¨¡ç³ŠèƒŒæ™¯æ•ˆæœçš„å…ƒä»¶
       ----------------------------------------------------------------------------- */

    /* å¥—ç”¨ç»ç’ƒæ¨£å¼çš„å…ƒä»¶ */
    .searchbar,
    .sound,
    .menu,
    #page-about .about-content,
    .bg-credit,
    .cg-header,
    .cg-board,
    .cg-result,
    .cg-rules {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: saturate(1.8) blur(12px);
      -webkit-backdrop-filter: saturate(1.8) blur(12px);
      box-shadow: var(--shadow);
    }

    /* -----------------------------------------------------------------------------
       3.2 æŒ‰éˆ•ç³»çµ±
       ----------------------------------------------------------------------------- */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      padding: var(--space-sm) var(--space-md);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      background: linear-gradient(to bottom, var(--card), var(--card-2));
      color: var(--fg);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--duration-normal) ease;
      box-shadow: var(--shadow-sm);
    }

    .btn:hover {
      background: linear-gradient(to bottom, var(--card-2), var(--border));
      border-color: var(--accent);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: var(--shadow-sm);
    }

    /* å°å‹æŒ‰éˆ•è®Šé«” */
    .btn--small,
    .small-btn {
      padding: var(--space-xs) var(--space-sm);
      font-size: 12px;
      border-radius: var(--radius-sm);
    }

    /* åœ–ç¤ºæŒ‰éˆ•è®Šé«” */
    .btn--icon {
      min-width: 32px;
      padding: 6px;
    }

    /* -----------------------------------------------------------------------------
       3.3 æ¨™ç±¤è† å›Šï¼ˆChipï¼‰
       
       ç”¨æ–¼æœå°‹åˆ—ä¸­çš„å·²é¸æ¨™ç±¤
       ----------------------------------------------------------------------------- */
    .chip {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-pill);
      font-size: 12px;
      color: var(--chip-fg);
      box-shadow: var(--shadow-sm);
      cursor: pointer;
    }

    .chip button {
      appearance: none;
      border: 0;
      background: transparent;
      color: inherit;
      cursor: pointer;
      font-size: 14px;
      line-height: 1;
      padding: 0 0 0 2px;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-xs);
      margin-top: var(--space-xs);
    }

    /* -----------------------------------------------------------------------------
       3.4 éŸ³æ•ˆæ¨™ç±¤ï¼ˆTagï¼‰
       
       ç”¨æ–¼éŸ³æ•ˆå¡ç‰‡ä¸Šçš„åˆ†é¡æ¨™ç±¤
       ----------------------------------------------------------------------------- */
    .tag {
      display: inline-block;
      padding: 3px 6px;
      border-radius: var(--radius-pill);
      font-size: small;
      color: var(--chip-fg);
      white-space: nowrap;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    /* æ¨™ç±¤ä¸€è¦½å€åŸŸ */
    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px var(--space-sm);
      margin: var(--space-sm) 0;
    }

    /* -----------------------------------------------------------------------------
       3.5 éŸ¿æ‡‰å¼ç¶²æ ¼ç³»çµ±
       
       éŸ³æ•ˆå¡ç‰‡çš„ç¶²æ ¼ä½ˆå±€ï¼Œæ ¹æ“šè¢å¹•å¯¬åº¦è‡ªå‹•èª¿æ•´æ¬„æ•¸
       ----------------------------------------------------------------------------- */
    .grid {
      display: grid;
      gap: var(--space-xs);
      grid-template-columns: repeat(6, minmax(0, 1fr));
    }

    /* =============================================================================
       4. ä½ˆå±€å…ƒä»¶
       
       é é¢çµæ§‹ç›¸é—œçš„ä½ˆå±€å…ƒä»¶ï¼š
       - .wrapï¼šä¸»å®¹å™¨
       - headerï¼šé é¦–
       - .section-headerï¼šå€å¡Šæ¨™é¡Œåˆ—
       ============================================================================= */

    /* -----------------------------------------------------------------------------
       4.1 ä¸»å®¹å™¨
       ----------------------------------------------------------------------------- */
    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: var(--space-xl);
    }

    /* -----------------------------------------------------------------------------
       4.2 é é¦–ï¼ˆHeaderï¼‰
       ----------------------------------------------------------------------------- */
    header {
      display: flex;
      align-items: center;
      flex-wrap: nowrap;
      /* ä¿æŒæ¨™é¡Œèˆ‡é¸å–®åœ¨åŒä¸€è¡Œ */
      gap: var(--space-md);
      margin-bottom: 14px;
    }

    header h1 {
      white-space: normal;
      min-width: 0;
      overflow-wrap: anywhere;
      margin-right: auto;
      /* å°‡å¾Œæ–¹å…ƒç´ æ¨åˆ°å³å´ */
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 var(--space-sm) 0 0;
      letter-spacing: 0.5px;
    }

    /* ä¸»é¡Œåˆ‡æ›æŒ‰éˆ•ï¼ˆä½¿ç”¨é€šç”¨æŒ‰éˆ•æ¨£å¼ï¼‰ */
    .theme-toggle {
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--fg);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-md);
      cursor: pointer;
      box-shadow: var(--shadow);
    }

    /* -----------------------------------------------------------------------------
       4.3 å°è¦½åˆ†é ï¼ˆTabsï¼‰
       ----------------------------------------------------------------------------- */
    .tabs {
      display: flex;
      gap: var(--space-sm);
      align-items: center;
      flex-wrap: wrap;
    }

    .tab {
      display: inline-block;
      padding: 6px var(--space-lg);
      font-size: 14px;
      border: 1px solid var(--border);
      border-radius: var(--radius-pill);
      background: var(--card-2);
      color: var(--fg);
      cursor: pointer;
      transition: background var(--duration-normal) ease, color var(--duration-normal) ease;
    }

    .tab:hover {
      background: var(--card);
    }

    .tab.active {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--chip-fg);
    }

    /* æ‰‹æ©Ÿç‰ˆæ¼¢å ¡é¸å–®æŒ‰éˆ• */
    .nav-toggle {
      display: none;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--fg);
      border-radius: var(--radius-md);
      padding: var(--space-sm);
      cursor: pointer;
      box-shadow: var(--shadow);
    }

    /* -----------------------------------------------------------------------------
       4.4 å€å¡Šæ¨™é¡Œåˆ—ï¼ˆSection Headerï¼‰
       ----------------------------------------------------------------------------- */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 14px 0 var(--space-sm);
    }

    .section-header h3 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.2px;
    }

    .section-header .actions {
      display: flex;
      gap: 3px;
    }

    .section-title {
      margin: 18px 0 10px;
      font-weight: 700;
      letter-spacing: 0.3px;
    }

    /* =============================================================================
       5. åŠŸèƒ½æ¨¡çµ„æ¨£å¼
       
       å„åŠŸèƒ½å€å¡Šçš„å°ˆå±¬æ¨£å¼
       ============================================================================= */

    /* -----------------------------------------------------------------------------
       5.1 æœå°‹åˆ—æ¨¡çµ„
       ----------------------------------------------------------------------------- */
    .search-row {
      display: flex;
      flex-wrap: nowrap;
      gap: 0;
      align-items: stretch;
      position: sticky;
      top: 0;
      background: var(--search);
      padding: var(--space-sm) 0 var(--space-md);
      z-index: 5;
    }

    .searchbar {
      flex: 1 1 auto;
      min-width: 0;
      display: flex;
      align-items: center;
      gap: 6px;
      border-radius: var(--radius-lg) 0 0 var(--radius-lg);
      border-right: 0;
      padding: 6px var(--space-sm);
      position: relative;
      height: var(--control-h);
      transition: box-shadow var(--duration-normal) ease, border-color var(--duration-normal) ease;
    }

    .searchbar:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(106, 169, 255, 0.25);
      z-index: 1;
    }

    .searchbar input {
      flex: 1;
      min-width: 0;
      background: transparent;
      border: 0;
      outline: 0;
      color: var(--fg);
      font-size: 16px;
      height: 100%;
      line-height: var(--control-h);
      padding: 0 6px;
    }

    /* æ¸…é™¤æŒ‰éˆ•ï¼ˆæœå°‹åˆ—å³å´ï¼‰ */
    .search-row #clearBtn {
      flex: 0 0 auto;
      white-space: nowrap;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      border-left: 1px solid var(--glass-border);
      background: var(--glass-bg);
      backdrop-filter: saturate(1.5) blur(8px);
      -webkit-backdrop-filter: saturate(1.5) blur(8px);
      height: var(--control-h);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0 14px;

      /* è¦†è“‹ .btn çš„é è¨­äº’å‹•æ¨£å¼ */
      box-shadow: none;
      transition: color var(--duration-normal) ease;
    }

    .search-row #clearBtn:hover {
      background: var(--glass-bg);
      /* ä¿æŒåŸé‚Šæ¡†è‰²ï¼Œä¸éš¨ .btn:hover è®Šè‰² */
      border-top-color: var(--border);
      border-right-color: var(--border);
      border-bottom-color: var(--border);
      border-left-color: var(--glass-border);
      transform: none;
      box-shadow: none;
      color: var(--accent);
    }

    .search-row #clearBtn:active {
      transform: none;
      box-shadow: none;
    }

    /* -----------------------------------------------------------------------------
       5.2 éŸ³æ•ˆå¡ç‰‡æ¨¡çµ„
       ----------------------------------------------------------------------------- */
    .sound {
      border-radius: var(--radius-lg);
      padding: var(--space-sm);
      display: flex;
      flex-direction: column;
      gap: 5px 2px;
      user-select: none;
      cursor: pointer;
      transition: transform var(--duration-normal) cubic-bezier(0.34, 1.56, 0.64, 1), 
                  box-shadow var(--duration-normal) ease,
                  border-color var(--duration-normal) ease;
    }

    .sound:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: var(--accent);
      z-index: 10;
    }

    .sound:active {
      transform: scale(0.98);
      transition: transform var(--duration-fast) ease;
    }

    .sound-top {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .title {
      font-weight: 600;
      font-size: smaller;
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* æ„›å¿ƒæŒ‰éˆ• */
    .heart {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border);
      background: var(--card-2);
      cursor: pointer;
      flex: 0 0 auto;
      padding: 0;
    }

    .heart svg {
      width: 14px;
      height: 14px;
      display: block;
      flex-shrink: 0;
    }

    .heart[aria-pressed="true"] svg path {
      fill: var(--heart);
    }

    /* -----------------------------------------------------------------------------
       5.3 æ’­æ”¾èˆå°æ¨¡çµ„ï¼ˆé ­åƒå‹•ç•«ï¼‰
       ----------------------------------------------------------------------------- */
    .stage {
      position: fixed;
      left: 0;
      right: 0;
      bottom: var(--space-md);
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-md) 14px;
      justify-content: center;
      pointer-events: none;
      z-index: 40;
      padding: 0 var(--space-md);
    }

    .group {
      display: inline-flex;
      gap: var(--space-sm);
      align-items: flex-end;
    }

    .avatar {
      width: 75px;
      height: 75px;
      border-radius: var(--radius-pill);
      background: transparent;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.8);
      box-shadow: var(--shadow-lg);
      transform-origin: 50% 100%;
    }

    .avatar>img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* -----------------------------------------------------------------------------
       5.4 å³éµé¸å–®æ¨¡çµ„
       ----------------------------------------------------------------------------- */
    .menu {
      position: fixed;
      z-index: 9999;
      min-width: 180px;
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .menu.hidden {
      display: none;
    }

    .menu-item {
      padding: 10px var(--space-md);
      cursor: pointer;
      border-bottom: 1px solid var(--border);
      transition: background var(--duration-normal) ease;
    }

    .menu-item:last-child {
      border-bottom: 0;
    }

    .menu-item:hover {
      background: var(--hover-overlay);
    }

    /* -----------------------------------------------------------------------------
       5.5 Toast é€šçŸ¥æ¨¡çµ„
       ----------------------------------------------------------------------------- */
    .toast {
      position: fixed;
      left: 50%;
      bottom: 80px;
      transform: translateX(-50%);
      background: var(--card);
      border: 1px solid var(--border);
      padding: 10px 14px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow);
      z-index: 70;
    }

    .toast.hidden {
      display: none;
    }

    /* -----------------------------------------------------------------------------
       5.6 Modal å°è©±æ¡†æ¨¡çµ„
       ----------------------------------------------------------------------------- */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 120;
    }

    .modal-backdrop.hidden {
      display: none;
    }

    .modal {
      background: var(--bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      max-width: 320px;
      box-shadow: var(--shadow);
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: var(--space-lg);
    }

    /* =============================================================================
       6. é é¢å°ˆå±¬æ¨£å¼
       ============================================================================= */

    /* -----------------------------------------------------------------------------
       6.1 é—œæ–¼é é¢
       ----------------------------------------------------------------------------- */
    #page-about .about-content {
      border-radius: 14px;
      padding: 14px var(--space-lg);
    }

    /* èƒŒæ™¯åœ–ç½²å */
    .bg-credit {
      position: fixed;
      right: var(--space-lg);
      bottom: var(--space-lg);
      font-size: large;
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      font-weight: 800;
      z-index: 60;
    }

    .bg-credit a {
      text-decoration: underline;
    }

    /* èƒŒæ™¯æ»¿ç‰ˆæ¨¡å¼ */
    body.bg-full {
      --bg-opacity: 1 !important;
    }

    /* =============================================================================
       7. å‹•ç•«ç³»çµ±ï¼ˆKeyframesï¼‰
       ============================================================================= */

    /* å½ˆå…¥å‹•ç•«ï¼šç”¨æ–¼é ­åƒé€²å ´ */
    @keyframes popIn {
      0% {
        transform: translateY(20px) scale(0.7);
        opacity: 0;
      }

      100% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    /* æŠ–å‹•å‹•ç•«ï¼šç”¨æ–¼æ’­æ”¾ä¸­çš„é ­åƒ */
    @keyframes jitter {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
      }

      20% {
        transform: translateY(-2px) rotate(-1deg);
      }

      40% {
        transform: translateY(1px) rotate(1deg);
      }

      60% {
        transform: translateY(-1px) rotate(0.6deg);
      }

      80% {
        transform: translateY(1px) rotate(-0.6deg);
      }
    }

    /* è·³å‡ºå‹•ç•«ï¼šç”¨æ–¼é ­åƒé›¢å ´ */
    @keyframes hopOut {
      0% {
        transform: translateY(0);
        opacity: 1;
      }

      22% {
        transform: translateY(-12px);
        opacity: 1;
      }

      100% {
        transform: translateY(60px);
        opacity: 0;
      }
    }

    /* å‹•ç•«é¡åˆ¥ */
    .pop-in {
      animation: popIn 0.28s cubic-bezier(0.2, 0.9, 0.18, 1) both;
    }

    .jit {
      animation: jitter 0.9s ease-in-out infinite;
    }

    .hop-out {
      animation: hopOut 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }

    /* =============================================================================
       8. éŸ¿æ‡‰å¼æ¨£å¼ï¼ˆMedia Queriesï¼‰
       
       çµ±ä¸€ç®¡ç†æ‰€æœ‰æ–·é»èª¿æ•´ï¼Œå¾å¤§åˆ°å°æ’åˆ—
       ============================================================================= */

    /* --- ä¸­ç­‰è¢å¹•ï¼ˆâ‰¤1000pxï¼‰ï¼š5æ¬„ç¶²æ ¼ --- */
    @media (max-width: 1000px) {
      .grid {
        grid-template-columns: repeat(5, minmax(0, 1fr));
      }
    }

    /* --- å¹³æ¿ï¼ˆâ‰¤800pxï¼‰ï¼š4æ¬„ç¶²æ ¼ --- */
    @media (max-width: 800px) {
      .grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    /* --- å°å‹å¹³æ¿/æ‰‹æ©Ÿæ©«å‘ï¼ˆâ‰¤760pxï¼‰ï¼šæ¼¢å ¡é¸å–® --- */
    @media (max-width: 760px) {
      .nav-toggle {
        display: inline-flex;
      }

      header .tabs {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        padding: var(--space-sm);
        border-radius: var(--radius-lg);
        gap: 6px;
        flex-direction: column;
        align-items: stretch;
        min-width: 180px;
        z-index: 120;
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        backdrop-filter: saturate(1.8) blur(12px);
        -webkit-backdrop-filter: saturate(1.8) blur(12px);
        box-shadow: var(--shadow);
      }

      body.nav-open header .tabs {
        display: flex;
      }
    }

    /* --- å¤§å‹æ‰‹æ©Ÿï¼ˆâ‰¤600pxï¼‰ï¼š3æ¬„ç¶²æ ¼ --- */
    @media (max-width: 600px) {
      .grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      header .tabs {
        margin-top: var(--space-sm);
      }

      header .theme-toggle {
        margin-top: var(--space-sm);
      }
    }

    /* --- å°å‹æ‰‹æ©Ÿï¼ˆâ‰¤400pxï¼‰ï¼š2æ¬„ç¶²æ ¼ --- */
    @media (max-width: 400px) {
      .grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    /* =============================================================================
       9. å·¥å…·é¡åˆ¥ï¼ˆUtility Classesï¼‰
       ============================================================================= */

    /* éš±è—å…ƒç´  */
    .hidden {
      display: none;
    }

    /* åœç”¨éæ¸¡å‹•ç•«ï¼ˆç”¨æ–¼ä¸»é¡Œåˆ‡æ›æ™‚é¿å… lagï¼‰ */
    .no-transition,
    .no-transition * {
      transition: none !important;
    }

    /* æè¿°æ–‡å­— */
    .desc {
      color: var(--muted);
      font-size: 14px;
      margin: 0 0 6px;
    }

    /* ç©ºç‹€æ…‹æç¤º */
    .empty {
      color: var(--muted);
      padding: var(--space-md) 0;
    }

    /* æŒçºŒç™¼å…‰æ•ˆæœï¼ˆç”¨æ–¼é«˜äº®å¡ç‰‡ã€å„²å­˜æŒ‰éˆ•ç­‰ï¼‰ */
    .glow-persistent {
      box-shadow: 0 0 0 4px rgba(106, 169, 255, 0.5), 0 0 12px rgba(106, 169, 255, 0.75);
      transition: box-shadow var(--duration-slow) ease;
    }

    /* SortableJS æ‹–æ”¾æ¨£å¼ */
    .drag-ghost {
      opacity: 0.6;
      transform: scale(0.98);
    }

    .drag-chosen {
      outline: 2px dashed var(--accent);
    }

    .dragging {
      cursor: grabbing;
    }

    body.sorting #favGrid .card {
      cursor: grab;
    }

    /* Header ç›¸å°å®šä½ï¼ˆç”¨æ–¼ä¸‹æ‹‰é¸å–®ï¼‰ */
    header {
      position: relative;
    }

    /* -----------------------------------------------------------------------------
       6.3 è¨˜æ†¶éŠæˆ²é é¢
       ----------------------------------------------------------------------------- */
    .cg-board {
      display: grid;
      grid-template-columns: repeat(4, 70px);
      grid-template-rows: repeat(4, 70px);
      gap: var(--space-sm);
      justify-content: center;
      margin: 12px auto;
      width: min(720px, 96%);
      padding: 12px;
      border-radius: var(--radius-lg);
      justify-items: center;
    }

    .cg-card {
      width: 70px;
      height: 70px;
      background: #888;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      perspective: 600px;
      will-change: transform;
      transition: transform var(--duration-normal) ease, box-shadow var(--duration-normal) ease;
      user-select: none;
    }

    .cg-card.matched {
      opacity: 0.5;
      pointer-events: none;
    }

    .cg-card-inner {
      width: 100%;
      height: 100%;
      transition: transform 0.4s cubic-bezier(.4, 2, .6, 1);
      transform-style: preserve-3d;
      position: relative;
    }

    .cg-card.flipped .cg-card-inner {
      transform: rotateY(180deg);
    }

    .cg-card-front,
    .cg-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cg-card-front {
      background: #888;
    }

    .cg-card:active,
    .cg-card.clicked {
      transform: scale(1.06);
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.28);
    }

    .cg-card-back {
      background: #fff;
      transform: rotateY(180deg);
      overflow: hidden;
    }

    .cg-card-back img {
      width: 80%;
      height: 80%;
      object-fit: contain;
      border-radius: var(--radius-sm);
    }

    .cg-lock {
      position: absolute;
      right: 6px;
      top: 6px;
      background: rgba(0, 0, 0, 0.4);
      color: white;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-pill);
      font-weight: 700;
      font-size: 14px;
    }

    .cg-header {
      display: flex;
      gap: 6px;
      align-items: center;
      justify-content: space-between;
      margin: var(--space-xs) auto;
      padding: var(--space-sm) 12px;
      width: min(720px, 96%);
      border-radius: var(--radius-lg);
      position: sticky;
      top: 12px;
      z-index: 60;
      flex-wrap: wrap;
    }

    #cg-timer {
      font-size: 1.0rem;
      font-weight: 700;
      color: var(--fg);
      letter-spacing: 0.6px;
      min-width: 25px;
      text-align: left;
    }

    #cg-timer.cg-running {
      color: #34d399;
    }

    #cg-accuracy {
      color: var(--muted);
      font-weight: 600;
      margin-left: var(--space-sm);
    }

    .cg-stats {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex: 1 1 auto;
      min-width: 0;
    }

    .cg-controls {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex: 0 0 auto;
    }

    .cg-header button {
      margin-left: var(--space-sm);
      flex: 0 0 auto;
    }

    .cg-result {
      text-align: center;
      font-size: 1.05rem;
      border-radius: 14px;
      padding: 14px var(--space-lg);
      max-width: 480px;
      margin: 18px auto 0;
    }

    .cg-result h3 {
      margin: 0 0 6px;
      font-size: 1.15rem;
    }

    .cg-result .stats {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      color: var(--muted);
      font-weight: 600;
    }

    .cg-result .big-num {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--fg);
    }

    .cg-rules {
      width: min(720px, 96%);
      margin: 14px auto 28px;
      border-radius: var(--radius-lg);
      padding: 12px var(--space-lg);
      color: var(--fg);
    }

    .cg-rules h4 {
      margin: 0 0 var(--space-sm);
      font-size: 1.05rem;
    }

    .cg-rules ul {
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
    }

    /* éŠæˆ²é é¢éŸ¿æ‡‰å¼èª¿æ•´ */
    @media (max-width: 420px) {
      .cg-header {
        gap: var(--space-sm);
        padding: var(--space-sm);
      }

      #cg-timer {
        font-size: 1rem;
      }

      .cg-board {
        grid-template-columns: repeat(4, 56px);
        grid-template-rows: repeat(4, 56px);
        gap: var(--space-xs);
        padding: 10px;
      }

      .cg-card {
        width: 56px;
        height: 56px;
      }
    }

    /* -----------------------------------------------------------------------------
       6.4 ç¥¨é¸çµæœé é¢
       ----------------------------------------------------------------------------- */
    #page-awards .awards-grid {
      display: grid;
      gap: var(--space-xs);
      grid-template-columns: repeat(4, minmax(120px, 240px));
      align-items: center;
      justify-items: center;
      justify-content: center;
    }

    #page-awards .awards-grid img {
      width: 100%;
      height: auto;
      display: block;
      max-width: 100%;
      object-fit: cover;
    }

    #page-awards .grid .title {
      text-align: left;
    }

    @media (max-width: 700px) {
      #page-awards .awards-grid {
        grid-template-columns: repeat(2, minmax(120px, 240px));
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>é˜¿è¬èˆ‡å‹•ç‰©æœ‹å‹æŒ‰éˆ•2365</h1>
      <button id="navToggle" class="nav-toggle" aria-label="æ‰“é–‹é¸å–®" aria-expanded="false" aria-controls="primaryNav"
        title="é¸å–®">
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </button>

      <!-- å°è¦½åˆ†é ï¼šæ”¾ç½®æ–¼æ¨™é¡Œèˆ‡ä¸»é¡Œåˆ‡æ›æŒ‰éˆ•ä¹‹é–“ï¼Œé å³æ’ç‰ˆ -->
      <nav id="primaryNav" class="tabs" role="tablist" aria-label="ä¸»é¸å–®">
        <button id="tab-home" class="tab active" data-page="home" role="tab" aria-selected="true"
          aria-controls="page-home">ä¸»é </button>
        <button id="tab-game" class="tab" data-page="game" role="tab" aria-selected="false"
          aria-controls="page-game">å°éŠæˆ²</button>
        <button id="tab-about" class="tab" data-page="about" role="tab" aria-selected="false"
          aria-controls="page-about">é—œæ–¼</button>
        <button id="tab-awards" class="tab" data-page="awards" role="tab" aria-selected="false"
          aria-controls="page-awards">ç¥¨é¸çµæœ</button>
        <button id="settingsBtn" class="tab" aria-label="é–‹å•Ÿè¨­å®šé¢æ¿" aria-haspopup="dialog">è¨­å®š</button>
      </nav>

    </header>

    <!-- é¦–é å…§å®¹ï¼šéŸ³æ•ˆåˆ—è¡¨ -->
    <main id="page-home" role="tabpanel" aria-labelledby="tab-home">
      <!-- æœå°‹åˆ—ï¼ˆç¨ç«‹æˆ rowï¼‰ -->
      <div class="search-row">
        <div class="searchbar" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor"
              d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14" />
          </svg>
          <input id="q" placeholder="æœå°‹æ¨™é¡Œæˆ– #æ¨™ç±¤ï¼ˆå¯å¤šå€‹ï¼Œç”¨ç©ºç™½åˆ†éš”ï¼‰" autocomplete="off" aria-label="æœå°‹éŸ³æ•ˆ" />
          <div id="activeChips" class="chips" role="list" aria-label="å·²é¸å–çš„æœå°‹æ¨™ç±¤"></div>
        </div>
        <button id="clearBtn" class="btn" aria-label="æ¸…é™¤æœå°‹">æ¸…é™¤</button>
      </div>
      <!-- æ¨™ç±¤ä¸€è¦½ -->
      <div id="tagList" class="tag-list" role="list" aria-label="å¯é»é¸çš„éŸ³æ•ˆæ¨™ç±¤"></div>
      <!-- æœ€æ„›å€ -->
      <section aria-labelledby="fav-section-title">
        <div class="section-header">
          <h3 id="fav-section-title">æœ€æ„›éŸ³æ•ˆ</h3>
          <div class="actions">
            <button id="sortFavBtn" class="btn small-btn" aria-label="é–‹å•Ÿæ‰‹å‹•æ’åˆ—æ¨¡å¼">æ‰‹å‹•æ’åˆ—</button>
            <button id="doneSortBtn" class="btn small-btn glow-persistent hidden" aria-label="å„²å­˜ç›®å‰æ’åˆ—é †åº">å„²å­˜æ’åˆ—</button>
            <button id="shareFavBtn" class="btn small-btn" aria-label="åˆ†äº«æœ€æ„›åˆ—è¡¨">åˆ†äº«</button>
          </div>
        </div>
        <div id="favGrid" class="grid" role="list" aria-label="æœ€æ„›éŸ³æ•ˆåˆ—è¡¨"></div>
        <div id="favEmpty" class="empty hidden" role="status">é‚„æ²’æœ‰æœ€æ„›ã€‚é»éŸ³æ•ˆå³ä¸Šçš„ â¤ï¸ åŠ å…¥æœ€æ„›ã€‚</div>
      </section>
      <!-- æ”¶åˆ°çš„åˆ—è¡¨ï¼šåƒ…ç•¶ URL åŒ…å« list åƒæ•¸æ™‚é¡¯ç¤º -->
      <section id="receivedSection" class="hidden" aria-labelledby="received-section-title">
        <div id="receivedHeader" class="section-header">
          <h3 id="received-section-title">æ”¶åˆ°çš„åˆ—è¡¨</h3>
        </div>
        <div id="receivedGrid" class="grid" role="list" aria-label="æ”¶åˆ°çš„éŸ³æ•ˆåˆ—è¡¨"></div>
      </section>
      <!-- å…¨éƒ¨éŸ³æ•ˆ -->
      <section aria-labelledby="all-sounds-title">
        <div class="section-header">
          <h3 id="all-sounds-title">å…¨éƒ¨éŸ³æ•ˆ</h3>
          <div class="actions">
            <button id="shuffleBtn" class="btn small-btn" aria-label="éš¨æ©Ÿæ’åˆ—éŸ³æ•ˆé †åº">æ´—ç‰Œ</button>
            <button id="resetOrderBtn" class="btn small-btn" aria-label="æ¢å¾©é è¨­æ’åˆ—é †åº">é è¨­é †åº</button>
          </div>
        </div>
        <p class="desc">æç¤ºï¼šé»éŸ³æ•ˆå³å¯æ’­æ”¾ï¼›å³éµï¼ˆæˆ–è¡Œå‹•è£ç½®é•·æŒ‰ï¼‰å¯åˆ†äº«/ä¸‹è¼‰ã€‚</p>
        <div id="grid" class="grid" role="list" aria-label="å…¨éƒ¨éŸ³æ•ˆåˆ—è¡¨"></div>
        <div id="empty" class="empty hidden" role="status">æ²’æœ‰ç¬¦åˆæœå°‹çš„éŸ³æ•ˆã€‚</div>
      </section>
    </main>
    <!-- å°éŠæˆ²åˆ†é  -->
    <div id="page-game" class="hidden" role="tabpanel" aria-labelledby="tab-game">
      <div id="concentration-game" role="application" aria-label="è¨˜æ†¶å°éŠæˆ²">
        <div class="cg-header">
          <div class="cg-stats" aria-live="polite">
            <span id="cg-timer" aria-label="éŠæˆ²æ™‚é–“">00:00</span>
            <span id="cg-accuracy" aria-label="æº–ç¢ºç‡">æº–ç¢ºç‡ï¼š--%</span>
          </div>
          <div class="cg-controls">
            <button id="cg-restart" class="btn small-btn" aria-label="é‡æ–°é–‹å§‹éŠæˆ²">é‡é–‹ä¸€å±€</button>
          </div>
        </div>
        <div id="cg-board" class="cg-board" role="grid" aria-label="è¨˜æ†¶å¡ç‰Œé¢æ¿"></div>
        <div id="cg-result" class="cg-result hidden" role="alert" aria-live="assertive"></div>
        <!-- è¦å‰‡èªªæ˜å¡ï¼šèˆ‡å…¶ä»–éŠæˆ²å€å¡ŠåŒå¯¬ä¸¦ç½®æ–¼ä¸‹æ–¹ -->
        <div id="cg-rules" class="cg-rules" aria-labelledby="cg-rules-title">
          <h4 id="cg-rules-title">è¨˜æ†¶å°éŠæˆ²è¦å‰‡</h4>
          <ul>
            <li>ç¬¬ä¸€æ¬¡ç¿»é–‹çš„ç‰Œä¸å°è¨ˆåˆ†é€ æˆå½±éŸ¿ï¼Œå±¬æ–¼è¨˜æ†¶æç¤ºã€‚</li>
            <li>æ¯ç¿»é–‹å…©å¼µå¡ï¼Œè‹¥ç‚ºç›¸åŒä¸»æ’­çš„ç›¸åŒéŸ³æ•ˆå³ç‚ºé…å°ï¼Œå…±æœ‰ 8 å°é…å°ã€‚</li>
            <li>ï¼ˆä¸æœƒå‡ºç¾å¸¶æœ‰ã€Œé«’è©±ã€æˆ–ã€ŒSUSã€æ¨™ç±¤çš„èªéŸ³ï¼Œä½†æ˜¯æœƒæœ‰å°–å«ï¼Œè«‹å°å¿ƒè€³è†œã€‚ï¼‰</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- é—œæ–¼åˆ†é  -->
    <div id="page-about" class="hidden" role="tabpanel" aria-labelledby="tab-about">
      <div class="about-content">
        <p>æœ¬ç«™ç”±ç²‰è‚è£½ä½œï¼Œä¸¦éç”±å­ä¸–é†«å¸«é˜¿è¬å®˜æ–¹ç¶“ç‡Ÿã€‚éŸ³æ•ˆå…§å®¹çš†æ˜¯ç²‰è‚å»è„ˆçµ¡å¼ã€æ–·ç« å–ç¾©çš„å‰ªè¼¯ï¼Œåƒ…ä¾›å¨›æ¨‚ã€‚æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š2025/11/5ã€‚</p>

        <p>é˜¿è¬æœ¬å®¶â†’ <a href="https://x.com/drlifesucks" target="_blank">å­ä¸–é†«å¸«é˜¿è¬X</a>ã€<a
            href="https://www.youtube.com/@Dr.lifesucks" target="_blank">å­ä¸–é†«å¸«é˜¿è¬Youtube</a> </p>
        <p><a href="https://discord.gg/e6ch4VbRB4" target="_blank">éŸ³æ•ˆæ¿å•é¡Œå›å ±èˆ‡å»ºè­°å€</a></p>
        <img src="assets/art-by-sigh.png" alt=""
          style="margin: 0 auto; max-width:100%; max-height: 250px; display: block; object-fit: cover;" />
        <p style="text-align: right;">æ’ç•«ï¼š<a href="https://x.com/sigh121212" target="_blank">Minie(Sigh)</a></p>
        <h2>å¤§å¾·èŠ³åéŒ„</h2>
        <p>æ„Ÿè¬53ã€Kieåœ¨DCå¼„äº†ä¸€å †éŸ³æ•ˆï¼Œè®“å—æƒ³åˆ°å¯ä»¥åšé€™å€‹ç¶²ç«™ï¼Œä¸¦åœ¨æå‡ºé€™å€‹æƒ³æ³•çš„ä¸€é–‹å§‹å°±å¼„äº†ä¸€å †éŸ³æ•ˆéä¾†ã€‚é‚„æœ‰åŒæ¨£æ„Ÿè¬åœ¨åŸå‹éšæ®µå°±å¹«å¿™æ”¶é›†éŸ³æ•ˆçš„ç±³ç³•è·Ÿè–°è–°è‰ã€‚
          <br />æ„Ÿè¬Jiaç¹ªè£½è¶…å¯æ„›çš„èƒŒæ™¯åœ–è·Ÿæ”¶é›†äº†å¾ˆå¤šéŸ³æ•ˆã€‚
          <br />
          <br />æ„Ÿè¬ç²‰è‚å€‘æ”¶é›†å¾ˆå¤šéŸ³æ•ˆï¼Œè±å¯Œäº†é€™å€‹ç¶²ç«™ï¼ˆWordç­†åŠƒé †ï¼‰ï¼š
          <br />AmBinBongã€CZã€HUIã€Lococco de
          suzuranã€Nokimi07ã€Sighã€TENNã€Yichenæ²‰æ²‰ã€ğŸŒ™ğŸ°æœˆæ¡‚è‘‰é¦™åŒ…â™ğŸµã€å¸ƒä¸(25:00)ã€å¹¸ç¦æŸ´æŸ´ã€é’æœ«æã€å‡Œä¼ŠLingYiï¼ˆ01ï¼‰ã€å¤ç™½è¡«ã€æ¾â–½ç±³ç²‰ è‚‰å¹²ã€è²“è²“é›¨ã€‚
          ä»¥åŠå…¶ä»–å›å ±å•é¡Œã€æå‡ºå»ºè­°çš„ç²‰è‚å€‘ï¼Œä½ å€‘è®“é€™å€‹ç¶²ç«™çš„åŠŸèƒ½æ›´å®Œå–„ã€‚
        </p>
      </div>
      <div class="bg-credit"><a href="https://x.com/jiauwu_0730" target="_blank" rel="noopener">èƒŒæ™¯æ’ç•«ç”± Jia ç¹ªè£½</a></div>

    </div>

    <!-- ç¥¨é¸çµæœåˆ†é  -->
    <div id="page-awards" class="hidden" role="tabpanel" aria-labelledby="tab-awards">
      <div style="max-width:1100px;margin:0 auto;padding:18px;">
        <h2 style="text-align:center">ç¬¬ä¸€å±†éŸ³æ•ˆæ¿çˆ­éœ¸æˆ°</h2>
        <div style="text-align:center;margin:12px 0">
          <div class="awards-grid" role="img" aria-label="ç¬¬ä¸€å±†ç²çè€…åœ–ç‰‡">
            <img src="assets/award1-1.jpg" alt="ç¬¬ä¸€å±†è²“ä¸‹å»" />
            <img src="assets/award1-2.jpg" alt="ç¬¬ä¸€å±†Matsuko" />
            <img src="assets/award1-3.jpg" alt="ç¬¬ä¸€å±†è±¹å­é ­" />
            <img src="assets/award1-4.jpg" alt="ç¬¬ä¸€å±†ç“¦å“ˆ" />
          </div>
          <h3 id="awards-top10-title">ç²çå€ï¼ˆå‰ååï¼‰</h3>
          <div id="awards-top10" class="grid" role="list" aria-labelledby="awards-top10-title"></div>
          <h3 id="awards-next20-title" style="margin-top:18px">å…¥åœçï¼ˆå¾Œ20åï¼‰</h3>
          <div id="awards-next20" class="grid" role="list" aria-labelledby="awards-next20-title"></div>
        </div>
      </div>
    </div>

    <!-- è¨­å®š Modalï¼ˆç«™å…§æ‰€æœ‰è¨­å®šï¼šéŸ³é‡ / ä¸»é¡Œé–‹é—œ ç­‰ï¼‰ -->
    <div id="settingsModal" class="modal-backdrop hidden" role="dialog" aria-modal="true"
      aria-labelledby="settingsTitle">
      <div class="modal">
        <h3 id="settingsTitle" style="margin-top: 0px;margin-bottom: 12px;">è¨­å®š</h3>
        <div style="display:flex;flex-direction:column;gap:8px;">
          <button id="themeBtn" class="btn" type="button" aria-label="åˆ‡æ›äº®è‰²/æš—è‰²ä¸»é¡Œ">é›»ç‡ˆé–‹é—œ</button>
          <label for="settingsVolume">æ’­æ”¾éŸ³é‡ï¼š <span id="settingsVolumeValue" aria-live="polite">100%</span></label>
          <input id="settingsVolume" type="range" min="0" max="100" step="1" value="100"
            aria-describedby="settingsVolumeValue" />
          <div style="display:flex;justify-content:flex-end;margin-top:6px;gap:8px;">
            <button id="settingsClose" class="btn" type="button" aria-label="é—œé–‰è¨­å®šé¢æ¿">é—œé–‰</button>
          </div>
        </div>
      </div>
    </div>

    <!-- æ’­æ”¾å½©è›‹èˆå° -->
    <div id="stage" class="stage" aria-hidden="true"></div>
    <!-- å³éµ/é•·æŒ‰é¸å–® -->
    <div id="menu" class="menu hidden" role="menu" aria-label="éŸ³æ•ˆé¸å–®"></div>
    <!-- Toastæç¤º -->
    <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
    <script src="scripts/Sortable.min.js"></script>
    <script>
      /**
       * =============================================================================
       * é˜¿è¬èˆ‡å‹•ç‰©æœ‹å‹æŒ‰éˆ• - ä¸»æ‡‰ç”¨ç¨‹å¼
       * =============================================================================
       * 
       * å–®æª”æ¡ˆæ‡‰ç”¨æ¶æ§‹ï¼Œä½¿ç”¨ IIFE æ¨¡å¼å°è£ä»¥é¿å…å…¨åŸŸå‘½åç©ºé–“æ±¡æŸ“ã€‚
       * ä¸»è¦åŠŸèƒ½ï¼šéŸ³æ•ˆæœå°‹èˆ‡æ’­æ”¾ã€æœ€æ„›æ”¶è—ã€è¨˜æ†¶å°éŠæˆ²ã€‚
       * 
       * ç›¸ä¾å¥—ä»¶ï¼š
       * - SortableJSï¼šæœ€æ„›æ’åºæ‹–æ”¾åŠŸèƒ½
       * 
       * æ¨¡çµ„çµæ§‹ç´¢å¼•ï¼š
       * 1. å¸¸æ•¸èˆ‡è¨­å®š
       * 2. å‹åˆ¥å®šç¾© (JSDoc)
       * 3. DOM å…ƒç´ å¼•ç”¨
       * 4. æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹
       * 5. å·¥å…·å‡½å¼
       * 6. éŸ³é »æ’­æ”¾æ ¸å¿ƒ
       * 7. æ··éŸ³è»Œé“ç³»çµ±
       * 8. UI æ¸²æŸ“å‡½å¼
       * 9. æœå°‹èˆ‡éæ¿¾
       * 10. è·¯ç”±èˆ‡ URL ç®¡ç†
       * 11. äº‹ä»¶è™•ç†
       * 12. åˆå§‹åŒ–æµç¨‹
       * 13. è¨˜æ†¶å°éŠæˆ²
       * =============================================================================
       */
      (function () {
        'use strict';

        /* =======================================================================
           1. å¸¸æ•¸èˆ‡è¨­å®š
           ======================================================================= */

        /**
         * æª”æ¡ˆç‰ˆæœ¬å­—ä¸²ï¼šæ¯æ¬¡éƒ¨ç½²è®Šæ›´æ­¤å€¼ï¼Œå¯ç¢ºä¿æŠ“å–æœ€æ–°è³‡æ–™ä¸¦å¼·åˆ¶ CDN/ç€è¦½å™¨é‡æ–°è¼‰å…¥ã€‚
         * @const {string}
         */
        const VERSION = 'ver2025-12-5';

        /**
         * æ‡‰ç”¨ç¨‹å¼è¨­å®šï¼šé›†ä¸­ç®¡ç†å¯èª¿æ•´çš„è¨­å®šå€¼ã€‚
         * @const {Object}
         */
        const CONFIG = {
          // è³‡æ–™ä¾†æºè·¯å¾‘
          paths: {
            tags: 'config/tags.json',
            sounds: 'config/sounds.json',
            voteResults: 'config/vote-results.json'
          },

          // localStorage éµå
          storage: {
            favorites: 'favorites',
            favoritesVersion: 'favorites_version',
            favoritesBackup: 'favorites_legacy_backup',
            theme: 'theme',
            globalVolume: 'globalVolume'
          },

          // UI æ™‚é–“è¨­å®šï¼ˆæ¯«ç§’ï¼‰
          timing: {
            toastDuration: 2500,           // Toast é¡¯ç¤ºæ™‚é•·
            longPressDelay: 650,           // é•·æŒ‰è§¸ç™¼é¸å–®å»¶é²
            searchDebounce: 180,           // æœå°‹é˜²æŠ–å»¶é²
            animationDelay: 60,            // é ­åƒå‹•ç•«å»¶é²é–“éš”
            hopOutDelay: 90                // é ­åƒé›¢å ´å‹•ç•«å»¶é²
          },

          // UI æ¸²æŸ“è¨­å®š
          ui: {
            batchSize: 72                  // æ¯æ¬¡æ¸²æŸ“çš„å¡ç‰‡æ•¸é‡ (6æ¬„ x 12åˆ—)
          },

          // ç¥¨é¸ç›¸é—œ
          awards: {
            topRankCount: 30,              // è®€å–å‰ N å
            top10Count: 10,                // é¡¯ç¤ºç‚ºå‰ 10 å
            next20Count: 20                // é¡¯ç¤ºç‚ºå…¥åœç
          },

          // è¨˜æ†¶éŠæˆ²ç›¸é—œ
          game: {
            pairCount: 8,                  // é…å°æ•¸é‡
            cardFlipDelay: 500,            // ç¿»ç‰Œæª¢æŸ¥å»¶é²
            rewardAccuracy: 90,            // è§¸ç™¼çå‹µçš„æº–ç¢ºç‡é–€æª»
            rewardSoundIds: ['c4B1fg', 'Hv3yFA', 'JkJ9-A', '5VHtAg']
          },

          // é è¨­é¡è‰²
          colors: {
            defaultTag: '#94a3b8'          // é è¨­æ¨™ç±¤è‰²
          }
        };

        /**
         * UI è¨Šæ¯æ–‡å­—ï¼šé›†ä¸­ç®¡ç†é¡¯ç¤ºçµ¦ä½¿ç”¨è€…çš„æ–‡å­—ã€‚
         * @const {Object}
         */
        const MESSAGES = {
          // Toast è¨Šæ¯
          toast: {
            linkCopied: 'å·²è¤‡è£½åˆ†äº«é€£çµ',
            listLinkCopied: 'å·²è¤‡è£½åˆ†äº«æœ€æ„›åˆ—è¡¨é€£çµ',
            noFavorites: 'æ²’æœ‰æœ€æ„›å¯åˆ†äº«',
            sortingSaved: 'å·²å„²å­˜æœ€æ„›æ’åº',
            sortingBlocked: 'æ­£åœ¨ç·¨è¼¯æœ€æ„›æ’åºï¼Œç„¡æ³•è®Šæ›´æœ€æ„›',
            favMigrated: (count, missing) => `å·²å‡ç´šæœ€æ„›æ ¼å¼ï¼Œå…± ${count} ç­†${missing ? `ï¼›æœªåŒ¹é… ${missing} ç­†` : ''}ã€‚`,
            gameReward: 'ä½ æ˜¯è¨˜æ†¶çŒ›è‚'
          },

          // éŒ¯èª¤è¨Šæ¯
          errors: {
            configLoadFailed: 'è¼‰å…¥è¨­å®šæª”å¤±æ•—ï¼Œè«‹ç¢ºèª <code>config/</code> è·¯å¾‘æ˜¯å¦æ­£ç¢ºã€‚',
            gameNoSounds: 'ç›®å‰æ²’æœ‰è¶³å¤ çš„éŸ³æ•ˆå¯ä¾›é…å°ï¼ˆéœ€è‡³å°‘ 1 çµ„ï¼‰ã€‚è«‹å›åˆ°ä¸»é æˆ–ç¨å¾Œå†è©¦ã€‚'
          },

          // ç©ºç‹€æ…‹æç¤º
          empty: {
            noFavorites: 'é‚„æ²’æœ‰æœ€æ„›ã€‚é»éŸ³æ•ˆå³ä¸Šçš„ â¤ï¸ åŠ å…¥æœ€æ„›ã€‚',
            noResults: 'æ²’æœ‰ç¬¦åˆæœå°‹çš„éŸ³æ•ˆã€‚'
          }
        };

        /* =======================================================================
           2. å·¥å…·å‡½å¼
           ======================================================================= */

        /** ç‚º URL é™„åŠ ç‰ˆæœ¬å­—ä¸² */
        const withV = url => url + (url.includes('?') ? '&' : '?') + 'v=' + encodeURIComponent(VERSION);

        /** Fisher-Yates æ´—ç‰Œæ¼”ç®—æ³• */
        function shuffleInPlace(arr, rng = Math.random) {
          for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(rng() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
          }
          return arr;
        }

        /* =======================================================================
           3. DOM å…ƒç´ å¼•ç”¨
           ======================================================================= */

        /** DOM å…ƒç´ å¿«å–ç‰©ä»¶ */
        const els = {
          q: document.getElementById('q'),
          activeChips: document.getElementById('activeChips'),
          clearBtn: document.getElementById('clearBtn'),
          tagList: document.getElementById('tagList'),
          grid: document.getElementById('grid'),
          favGrid: document.getElementById('favGrid'),
          empty: document.getElementById('empty'),
          favEmpty: document.getElementById('favEmpty'),
          settingsBtn: document.getElementById('settingsBtn'),
          themeBtn: document.getElementById('themeBtn'),
          stage: document.getElementById('stage'),
          navToggle: document.getElementById('navToggle'),
          get menu() { return document.getElementById('menu'); },
          get toast() { return document.getElementById('toast'); },
          get navTabs() { return document.querySelectorAll('.tab[data-page]'); },
          // åˆ†é èˆ‡è¨­å®š
          pageHome: document.getElementById('page-home'),
          pageGame: document.getElementById('page-game'),
          pageAbout: document.getElementById('page-about'),
          pageawards: document.getElementById('page-awards'),
          settingsModal: document.getElementById('settingsModal'),
          settingsClose: document.getElementById('settingsClose'),
          settingsVolume: document.getElementById('settingsVolume'),
          settingsVolumeValue: document.getElementById('settingsVolumeValue'),
          receivedSection: document.getElementById('receivedSection'),
          receivedGrid: document.getElementById('receivedGrid'),
          awardsTop10: document.getElementById('awards-top10'),
          awardsNext20: document.getElementById('awards-next20'),
          sortFavBtn: document.getElementById('sortFavBtn'),
          doneSortBtn: document.getElementById('doneSortBtn'),
          shareFavBtn: document.getElementById('shareFavBtn'),
          shuffleBtn: document.getElementById('shuffleBtn'),
          resetOrderBtn: document.getElementById('resetOrderBtn')
        };

        /* =======================================================================
           4. æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹
           ======================================================================= */

        /** å…¨åŸŸæ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ç‰©ä»¶ */
        const state = {
          tags: {},
          tagList: [],
          usedTagList: [],
          sounds: [],
          soundMap: new Map(),
          defaultSoundsSnapshot: [],
          favorites: JSON.parse(localStorage.getItem(CONFIG.storage.favorites) || '[]'),
          favSet: new Set(),
          isSorting: false,
          sortable: null,
          queryText: '',
          queryTags: new Set(),
          page: 'home',
          contextTimer: null,
          toastTimer: null,
          highlightedCardId: '',
          receivedList: [],
          cgRunning: false,
          // è™›æ“¬æ»¾å‹•/åˆ†æ‰¹æ¸²æŸ“ç‹€æ…‹
          displayList: [],
          renderedCount: 0,
          observer: null
        };

        state.favSet = new Set(state.favorites);
        state.globalVolume = (() => {
          const v = localStorage.getItem(CONFIG.storage.globalVolume);
          const n = Number(v);
          return (v !== null && !isNaN(n) && n >= 0 && n <= 1) ? n : 1.0;
        })();

        let cgCleanup = null;

        /* =======================================================================
           5. éŸ³é »æ’­æ”¾æ ¸å¿ƒ
           ======================================================================= */

        /** å°‡å…¨åŸŸéŸ³é‡è¨­å®šå¥—ç”¨åˆ° Audio å…ƒç´  */
        const applyVolumeToAudio = a => { try { a && (a.volume = state.globalVolume); } catch { } };

        /** å»ºç«‹ Audio æ’­æ”¾å™¨ä¸¦å•Ÿå‹•æ’­æ”¾ */
        function createPlayer(src, opts = {}) {
          const { snd, onPlay, onEnded, preload = 'auto', loop = false, autoplay = true } = opts;
          try {
            const audio = new Audio(src);
            Object.assign(audio, { preload, loop });
            onPlay && audio.addEventListener('play', () => onPlay(snd, audio));
            onEnded && audio.addEventListener('ended', () => onEnded(snd, audio));
            applyVolumeToAudio(audio);
            autoplay && audio.play().catch(() => { });
            return audio;
          } catch (e) {
            console.warn('[createPlayer] failed', e);
            return null;
          }
        }

        /** ä»¥ Sound ç‰©ä»¶æ’­æ”¾éŸ³æ•ˆï¼ŒåŒæ™‚è§¸ç™¼èˆå°é ­åƒå‹•ç•« */
        const playSoundObject = snd => snd?.src ? createPlayer(snd.src, { snd, onPlay: onPlayStart, onEnded: onPlayEnd }) : null;

        /* =======================================================================
           7. DOM å»ºæ§‹å·¥å…·
           ======================================================================= */

        /**
         * DOM å…ƒç´ å»ºæ§‹å·¥å…·é›†
         */
        const dom = {
          /**
           * å»ºç«‹ DOM å…ƒç´ ã€‚
           * @param {string} tag - æ¨™ç±¤åç¨±
           * @param {Object} attrs - å±¬æ€§ç‰©ä»¶
           * @param {Array|string} children - å­ç¯€é»
           * @returns {HTMLElement}
           */
          el(tag, attrs = {}, children = []) {
            const e = document.createElement(tag);
            for (const [k, v] of Object.entries(attrs)) {
              if (k === 'class') e.className = v;
              else if (k === 'style') Object.assign(e.style, v);
              else if (k.startsWith('on') && typeof v === 'function') e.addEventListener(k.slice(2), v);
              else if (v != null) e.setAttribute(k, v);
            }
            for (const c of [].concat(children).filter(Boolean)) {
              e.append(c);
            }
            return e;
          },

          /** å»ºç«‹æ„›å¿ƒ SVG åœ–ç¤º */
          svgHeart() {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('viewBox', '0 0 24 24');
            svg.innerHTML = '<path d="M12 21s-6.716-4.438-9.428-7.15C.59 11.868.59 8.608 2.57 6.627 4.55 4.647 7.81 4.647 9.79 6.627L12 8.838l2.21-2.21c1.98-1.98 5.24-1.98 7.22 0 1.98 1.98 1.98 5.24 0 7.223C18.716 16.562 12 21 12 21z" fill="none" stroke="currentColor" stroke-width="1.5"/>';
            return svg;
          }
        };

        /* =======================================================================
           8. é€šç”¨å·¥å…·å‡½å¼
           ======================================================================= */

        /**
         * é€šç”¨å·¥å…·å‡½å¼é›†åˆ
         */
        const utils = {
          /** æ­£è¦åŒ–å­—ä¸²ï¼šUnicode NFKC */
          slug: s => s.normalize('NFKC').trim(),

          /** æ ¹æ“š ID å–å¾— DOM å…ƒç´  */
          byId: id => document.getElementById(id),

          /** å„²å­˜æœ€æ„›åˆ—è¡¨åˆ° localStorage */
          saveFav: () => localStorage.setItem(CONFIG.storage.favorites, JSON.stringify(state.favorites)),

          /** æª¢æŸ¥éŸ³æ•ˆæ˜¯å¦åœ¨æœ€æ„›åˆ—è¡¨ä¸­ */
          inFav: id => state.favSet.has(id),

          /** è§¸ç™¼æª”æ¡ˆä¸‹è¼‰ */
          download(url, filename) {
            const a = Object.assign(document.createElement('a'), { href: url, download: filename || '' });
            document.body.appendChild(a);
            a.click();
            a.remove();
          },

          /**
           * è§£ææœå°‹æŸ¥è©¢å­—ä¸²ç‚ºçµæ§‹åŒ–ç‰©ä»¶ã€‚
           * 
           * @returns {Object} { terms: Array<string>, tags: Set<string> }
           */
          parseQuery() {
            const parts = state.queryText.trim().split(/\s+/).filter(Boolean);
            const tags = new Set([...state.queryTags]); // ä¿ç•™å·²é¸æ¨™ç±¤
            const terms = [];
            for (const p of parts) {
              if (p.startsWith('#')) {
                // æå– #ç¬¦è™Ÿå¾Œçš„æ¨™ç±¤ keyï¼Œä¸¦ slug åŒ–
                tags.add(utils.slug(p.slice(1)));
              } else {
                // ä¸€èˆ¬æœå°‹è©
                terms.push(utils.slug(p));
              }
            }
            return { terms, tags };
          },

          /**
           * åˆ¤æ–·å–®å€‹éŸ³æ•ˆæ˜¯å¦ç¬¦åˆæœå°‹æ¢ä»¶ã€‚
           * 
           * è¦å‰‡ï¼š
           * 1. tags éæ¿¾ï¼šéŸ³æ•ˆå¿…é ˆåŒ…å«æ‰€æœ‰å·²é¸æ¨™ç±¤ï¼ˆsubset checkï¼‰
           * 2. text éæ¿¾ï¼šéŸ³æ•ˆæ¨™é¡Œæˆ–æ¨™ç±¤å¿…é ˆåŒ…å«æ‰€æœ‰æœå°‹è©ï¼ˆcase-insensitiveï¼‰
           * 
           * @param {Object} sound - éŸ³æ•ˆç‰©ä»¶
           * @param {Array<string>} terms - æœå°‹è©é™£åˆ—ï¼ˆå·²æå–çš„æ–‡å­—éƒ¨ä»½ï¼‰
           * @param {Set<string>} tags - å·²é¸æ¨™ç±¤çš„ keyï¼ˆå·² slug åŒ–ï¼‰
           * @returns {boolean} æ˜¯å¦ç¬¦åˆæ¢ä»¶
           */
          match(sound, terms, tags) {
            const lowerTitle = sound.title.toLowerCase();
            const sluggedTags = sound.tags.map(t => utils.slug(t));
            // tags éæ¿¾ï¼šæª¢æŸ¥æ‰€æœ‰å·²é¸æ¨™ç±¤æ˜¯å¦éƒ½åœ¨éŸ³æ•ˆçš„æ¨™ç±¤æ¸…å–®ä¸­
            for (const t of tags) if (!sluggedTags.includes(t)) return false;
            // terms éæ¿¾ï¼šæª¢æŸ¥æ‰€æœ‰æœå°‹è©æ˜¯å¦éƒ½èƒ½åœ¨æ¨™é¡Œæˆ–æ¨™ç±¤ä¸­æ‰¾åˆ°
            for (const term of terms) {
              const lower = term.toLowerCase();
              if (!lowerTitle.includes(lower) && !sound.tags.some(t => t.toLowerCase().includes(lower))) return false;
            }
            return true;
          },

          /** å»ºç«‹é˜²æŠ–å‡½å¼ */
          debounce(fn, wait = 200) {
            let t;
            return (...args) => {
              clearTimeout(t);
              t = setTimeout(() => fn(...args), wait);
            };
          }
        };

        /* =======================================================================
           10. è·¯ç”±èˆ‡ URL ç®¡ç†
           
           è™•ç†ç€è¦½å™¨æ­·å²ã€æ·±é€£çµåˆ†äº«ã€æœå°‹æ¢ä»¶åŒæ­¥ã€‚
           ======================================================================= */

        /**
         * å°‡ç•¶å‰æœå°‹æ¢ä»¶å°è£ç‚º URLSearchParamsã€‚
         * @returns {URLSearchParams}
         */
        function buildSearchParams() {
          const { terms, tags } = utils.parseQuery();
          const params = new URLSearchParams(window.location.search);
          if (terms.length) params.set('q', terms.join(' ')); else params.delete('q');
          if (tags.size) params.set('tags', [...tags].join(',')); else params.delete('tags');
          params.delete('sound'); // ä¿®æ”¹æœå°‹æ™‚æ¸…é™¤éŸ³æ•ˆæ·±é€£çµ
          return params;
        }

        /**
         * å°‡ç‹€æ…‹å¯«å› URLã€‚
         * @param {boolean} push - è‹¥ç‚º true å‰‡ä½¿ç”¨ history.pushStateï¼Œå¦å‰‡ä½¿ç”¨ replaceState
         */
        function updateURLFromState(push = false) {
          const params = buildSearchParams();
          // ä¿ç•™ list åƒæ•¸ï¼ˆåˆ†äº«æ”¶åˆ°çš„åˆ—è¡¨ï¼‰è‹¥å­˜åœ¨
          const current = new URLSearchParams(location.search);
          if (current.has('list')) params.set('list', current.get('list'));
          // ä¿ç•™ sound åƒæ•¸ä»¥ç¢ºä¿åˆ†äº«é€£çµæ­£å¸¸é‹ä½œ
          if (current.has('sound')) params.set('sound', current.get('sound'));
          // åŠ ä¸Š page åƒæ•¸ï¼ˆéé¦–é æ‰å¯«å…¥ï¼‰
          if (state.page && state.page !== 'home') params.set('page', state.page); else params.delete('page');
          const qs = params.toString();
          const url = `${location.pathname}${qs ? '?' + qs : ''}`;
          (push ? history.pushState : history.replaceState).call(history, null, '', url);
        }

        /**
         * å¾ç¾æœ‰ URL è®€å–æœå°‹æ¢ä»¶ä¸¦å¥—ç”¨åˆ°ç‹€æ…‹èˆ‡è¼¸å…¥æ¡†ã€‚
         */
        function applyURLToState() {
          const params = new URLSearchParams(location.search);
          const q = params.get('q') || '';
          const tagsParam = params.get('tags') || '';
          state.queryTags.clear();
          const keys = tagsParam.split(',').map(k => utils.slug(k)).filter(Boolean);
          keys.forEach(k => state.queryTags.add(k));
          state.queryText = q;
          // åŒæ­¥è¼¸å…¥æ¡†æ–‡å­—
          const tagTokens = keys.map(k => '#' + (state.tags[k]?.name || k));
          els.q.value = [q, ...tagTokens].filter(Boolean).join(' ');
          // åˆ†é ï¼šè®€å– page åƒæ•¸
          const pageParam = params.get('page');
          state.page = ['game', 'about', 'awards'].includes(pageParam) ? pageParam : 'home';
          // åˆ†äº«åˆ—è¡¨ï¼šè®€å– list åƒæ•¸
          state.receivedList = params.get('list')?.split(',').filter(Boolean) ?? [];
        }

        /**
         * è‹¥ URL æœ‰ ?sound=<id>ï¼Œå‰‡èšç„¦ä¸¦é«˜äº®è©²å¡ç‰‡ã€‚
         */
        function focusSoundFromURL() {
          const id = new URLSearchParams(location.search).get('sound');
          if (!id) return;
          const card = utils.byId('snd-' + id);
          if (!card) return;
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
          // ç§»é™¤èˆŠçš„é«˜äº®
          if (state.highlightedCardId) utils.byId('snd-' + state.highlightedCardId)?.classList.remove('glow-persistent');
          state.highlightedCardId = id;
          card.classList.add('glow-persistent');
        }

        // popstate äº‹ä»¶ï¼šè¿”å›/å‰é€²æ™‚è¼‰å…¥ URL æ¢ä»¶
        window.addEventListener('popstate', () => {
          applyURLToState();
          render();
          focusSoundFromURL();
        });

        /** å»ºç«‹åƒ…åŒ…å« sound id çš„åˆ†äº«é€£çµ */
        function buildSoundURL(id) {
          const base = location.href.replace(/[?#].*$/, '');
          return `${base}?sound=${encodeURIComponent(id)}`;
        }

        /** å»ºç«‹åˆ†äº«åˆ—è¡¨çš„ URLï¼šåŠ å…¥ list åƒæ•¸ï¼Œä½¿ç”¨é€—è™Ÿåˆ†éš”çš„ id åˆ—è¡¨ã€‚ */
        function buildListURL(ids) {
          const params = buildSearchParams();
          ids?.length ? params.set('list', ids.join(',')) : params.delete('list');
          params.delete('sound');
          const qs = params.toString();
          return `${location.origin}${location.pathname}${qs ? '?' + qs : ''}`;
        }
        /** æ ¹æ“š id è‡ªå‹•æ’­æ”¾éŸ³æ•ˆ */
        /** æ ¹æ“š ID æ’­æ”¾éŸ³æ•ˆ */
        const playSoundById = id => { const snd = state.soundMap.get(id); snd && playSoundObject(snd); };


        /**
         * åˆ‡æ›é é¢ï¼šæ ¹æ“š page åç¨±é¡¯ç¤ºä¸åŒå…§å®¹ï¼Œä¸¦æ›´æ–°ç¶²å€åƒæ•¸èˆ‡å°è¦½æ¨£å¼
         * @param {'home'|'game'|'about'} pg
         */
        const pageMap = { home: 'pageHome', game: 'pageGame', about: 'pageAbout', awards: 'pageawards' };
        /** è§¸ç™¼é é¢åˆ‡æ›äº‹ä»¶ */
        const dispatchPageEvent = (pg, prevPage, phase) => { try { document.dispatchEvent(new CustomEvent('pageChange', { detail: { page: pg, prevPage, phase } })); } catch (e) { } };
        function showPage(pg) {
          const prevPage = state.page;
          dispatchPageEvent(pg, prevPage, 'before');
          state.page = pg;
          // éš±è—æ‰€æœ‰åˆ†é ï¼Œé¡¯ç¤ºç›®æ¨™åˆ†é 
          for (const [key, elKey] of Object.entries(pageMap)) els[elKey]?.classList.toggle('hidden', key !== pg);
          // æ›´æ–°å°è¦½æ¨™ç±¤ active æ¨£å¼èˆ‡ ARIA ç‹€æ…‹
          els.navTabs.forEach(tab => {
            const isActive = tab.getAttribute('data-page') === pg;
            tab.classList.toggle('active', isActive);
            if (tab.getAttribute('role') === 'tab') tab.setAttribute('aria-selected', String(isActive));
          });
          document.body.classList.toggle('bg-full', pg === 'about');
          document.body.classList.remove('nav-open');
          els.navToggle?.setAttribute('aria-expanded', 'false');
          updateURLFromState(true);
          dispatchPageEvent(pg, prevPage, 'after');
        }

        /**
         * æ¸²æŸ“æ¨™ç±¤ä¸€è¦½ï¼šåˆ—å‡ºæ‰€æœ‰ä½¿ç”¨åˆ°çš„æ¨™ç±¤
         */
        function renderTagList() {
          const container = els.tagList;
          if (!container) return;
          container.innerHTML = '';
          state.usedTagList.forEach(t => {
            const el = dom.el('span', { class: 'tag', style: { background: t.color || '#94a3b8' } }, t.name);
            el.addEventListener('click', () => addTagToQuery(t.key));
            container.appendChild(el);
          });
        }

        /** è¤‡è£½æ–‡å­—åˆ°å‰ªè²¼ç°¿ */
        const copyToClipboard = text => navigator.clipboard?.writeText(text).catch(() => legacyCopy(text)) ?? legacyCopy(text);
        function legacyCopy(text) {
          const ta = Object.assign(document.createElement('textarea'), { value: text, style: 'position:fixed;left:-9999px' });
          document.body.appendChild(ta); ta.select();
          try { document.execCommand('copy'); } catch (e) { }
          ta.remove();
          return Promise.resolve();
        }

        /** Toast æç¤ºé¡¯ç¤ºå°è³‡è¨Š */
        function toast(msg, duration = CONFIG.timing.toastDuration) {
          const t = els.toast;
          if (!t) return;
          clearTimeout(state.toastTimer);
          t.textContent = msg;
          t.classList.remove('hidden');
          if (duration > 0) state.toastTimer = setTimeout(() => t.classList.add('hidden'), duration);
        }

        /** æ‰“é–‹éŸ³æ•ˆçš„å³éµ/é•·æŒ‰é¸å–® */
        function openMenuForSound(snd, x, y) {
          const m = els.menu;
          if (!m) return;
          m.innerHTML = '';
          // åˆ†äº«ç¶²å€é …ç›®
          const share = dom.el('div', { class: 'menu-item', role: 'menuitem', tabindex: '0' }, 'åˆ†äº«ç¶²å€');
          share.addEventListener('click', async () => {
            await copyToClipboard(buildSoundURL(snd.id));
            closeMenu();
            toast(MESSAGES.toast.linkCopied);
          });
          // ä¸‹è¼‰éŸ³æª”é …ç›®
          const dl = dom.el('div', { class: 'menu-item', role: 'menuitem', tabindex: '0' }, 'ä¸‹è¼‰éŸ³æª”');
          dl.addEventListener('click', () => { closeMenu(); utils.download(snd.src, snd.file); });
          m.append(share, dl);
          m.classList.remove('hidden');
          // å®šä½é¸å–®ï¼šç¢ºä¿å…ƒç´ æœ‰å°ºå¯¸å¾Œå†è¨ˆç®—
          requestAnimationFrame(() => positionMenu(x, y));
        }

        /** å®šä½é¸å–®åœ¨è¦–çª—å…§ */
        function positionMenu(x, y) {
          const m = els.menu;
          if (!m) return;
          const pad = 6;
          const w = m.offsetWidth || 180;
          const h = m.offsetHeight || 100;
          const vw = window.innerWidth, vh = window.innerHeight;
          m.style.left = Math.min(Math.max(0, x), vw - w - pad) + 'px';
          m.style.top = Math.min(Math.max(0, y), vh - h - pad) + 'px';
        }

        /** é—œé–‰é¸å–® */
        const closeMenu = () => { const m = els.menu; if (m) { m.classList.add('hidden'); m.innerHTML = ''; } };
        // é»æ“Šå¤–éƒ¨æˆ–æŒ‰ ESC é—œé–‰é¸å–®
        document.addEventListener('click', e => { if (els.menu && !els.menu.classList.contains('hidden') && !els.menu.contains(e.target)) closeMenu(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeMenu(); });
        window.addEventListener('resize', closeMenu);

        /** åˆ‡æ›ä¸»é¡Œ */
        /** å¥—ç”¨ä¸»é¡Œæ¨£å¼ï¼Œæš«æ™‚åœç”¨ transition ä»¥é¿å…åˆ‡æ›æ™‚çš„ lag */
        const applyTheme = theme => {
          document.body.classList.add('no-transition');
          document.documentElement.classList.toggle('light', theme === 'light');
          // å¼·åˆ¶ reflow å¾Œæ¢å¾© transition
          document.body.offsetHeight;
          document.body.classList.remove('no-transition');
        };
        const savedTheme = localStorage.getItem(CONFIG.storage.theme) || (matchMedia('(prefers-color-scheme:light)').matches ? 'light' : 'dark');
        applyTheme(savedTheme);
        els.themeBtn.addEventListener('click', () => {
          const next = document.documentElement.classList.contains('light') ? 'dark' : 'light';
          if (next === 'dark') playSoundById('oNTWqg'); // ç“¦å“ˆéŸ³æ•ˆï¼šé–‹ç‡ˆå•Š
          localStorage.setItem(CONFIG.storage.theme, next);
          applyTheme(next);
        });

        // è¨­å®š Modal è¡Œç‚º
        
        /** é¡¯ç¤º/éš±è— Modal ä¸¦è¨­å®šç„¦é» */
        const setModalVisible = (modal, visible, focusEl) => {
          if (!modal) return;
          modal.classList.toggle('hidden', !visible);
          modal.setAttribute('aria-hidden', String(!visible));
          if (focusEl) try { focusEl.focus(); } catch (e) { }
        };

        /** éš±è—è¨­å®šé¢æ¿ */
        const hideSettings = () => setModalVisible(els.settingsModal, false);
        /** æª¢æŸ¥è¨­å®šé¢æ¿æ˜¯å¦é–‹å•Ÿ */
        const isSettingsOpen = () => els.settingsModal && !els.settingsModal.classList.contains('hidden');

        /** æ›´æ–°æ··éŸ³ä¸»éŸ³é‡ */
        const updateMixMasterGain = norm => {
          const gain = mixAudio?.masterGain?.gain;
          if (!gain) return;
          try { gain.value = norm; } catch { gain.rampTo?.(norm, 0.02); }
        };

        els.settingsBtn?.addEventListener('click', e => {
          e.preventDefault();
          setModalVisible(els.settingsModal, true);
          const vol = Math.round((state.globalVolume ?? 1) * 100);
          if (els.settingsVolume) els.settingsVolume.value = String(vol);
          if (els.settingsVolumeValue) els.settingsVolumeValue.textContent = `${vol}%`;
        });

        els.settingsClose?.addEventListener('click', hideSettings);
        document.addEventListener('click', e => { if (isSettingsOpen() && e.target === els.settingsModal) hideSettings(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape' && isSettingsOpen()) hideSettings(); });

        els.settingsVolume?.addEventListener('input', () => {
          const norm = Math.max(0, Math.min(100, Number(els.settingsVolume.value) || 0)) / 100;
          state.globalVolume = norm;
          try { localStorage.setItem(CONFIG.storage.globalVolume, String(norm)); } catch { }
          if (els.settingsVolumeValue) els.settingsVolumeValue.textContent = `${Math.round(norm * 100)}%`;
          updateMixMasterGain(norm);
        });

        /** æ’­æ”¾å½©è›‹ï¼šéŸ³æ•ˆé–‹å§‹æ™‚é¡¯ç¤ºä¸»æ’­é ­åƒ */
        const activeGroups = new Set();
        function onPlayStart(snd, audio) {
          const streamerTags = snd.tags.map(k => state.tags[utils.slug(k)]).filter(t => t?.role === 'streamer' && t.avatar);
          if (!streamerTags.length) return;
          const group = dom.el('div', { class: 'group' });
          activeGroups.add(group);
          streamerTags.forEach((t, i) => {
            const avatar = dom.el('div', { class: 'avatar pop-in jit', style: { animationDelay: `${i * 60}ms` } }, [
              dom.el('img', { src: withV(t.avatar), alt: t.name })
            ]);
            group.appendChild(avatar);
          });
          els.stage.appendChild(group);
          audio.__group = group;
        }
        /** æ’­æ”¾å½©è›‹ï¼šéŸ³æ•ˆçµæŸæ™‚æ’­æ”¾é ­åƒé›¢å ´å‹•ç•« */
        function onPlayEnd(_snd, audio) {
          const group = audio.__group;
          if (!group) return;
          [...group.children].forEach((av, i) => {
            av.classList.remove('jit');
            setTimeout(() => {
              av.classList.add('hop-out');
              av.onanimationend = () => { av.remove(); group.childElementCount === 0 && (group.remove(), activeGroups.delete(group)); };
            }, i * CONFIG.timing.hopOutDelay);
          });
        }

        /** ===== Favorites schema migration: file -> id (v1 -> v2) ===== */
        const ID_REGEX = /^[A-Za-z0-9_-]{6}$/;

        /** è§£æèˆŠç‰ˆæœ€æ„›è³‡æ–™ç‚ºå­—ä¸²é™£åˆ— */
        function parseLegacyFavorites(raw) {
          if (!raw) return [];
          try {
            const parsed = JSON.parse(raw);
            if (Array.isArray(parsed)) return parsed.map(String);
            if (parsed && typeof parsed === 'object') return Object.keys(parsed).filter(k => parsed[k]).map(String);
          } catch {
            // é JSONï¼šæ”¯æ´ç”¨é€—è™Ÿ/ç©ºç™½åˆ†éš”çš„èˆŠæ ¼å¼
            return typeof raw === 'string' ? raw.split(/[,\s]+/).map(s => s.trim()).filter(Boolean) : [];
          }
          return [];
        }

        /** æ­£è¦åŒ–æª”æ¡ˆè·¯å¾‘ä½œç‚ºæŸ¥æ‰¾éµå€¼ */
        const canonFileKey = s => {
          if (!s) return '';
          let k = String(s).split('?')[0].replace(/^\.?\//, '');
          try { k = decodeURIComponent(k); } catch { }
          return k;
        };

        /** ç”± sounds.json å»ºç«‹å°ç…§è¡¨ï¼šfile/basename/å¤§å°å¯«é¬†å¼› -> id */
        /**
         * å¾ sounds.json å»ºç«‹å°ç…§è¡¨ç”¨æ–¼æª”æ¡ˆåç¨±è½‰ ID çš„å°æ‡‰ã€‚
         * 
         * æ”¯æ´å¤šç¨®è¼¸å…¥æ ¼å¼ä¸¦é€²è¡Œæ­£è¦åŒ–ï¼š
         * 1. å®Œæ•´è·¯å¾‘ï¼ˆe.g. `sounds/subfolder/file.mp3`ï¼‰
         * 2. åŸºç¤æª”åï¼ˆe.g. `file.mp3`ï¼‰
         * 3. å¤§å°å¯«ä¸æ•æ„ŸæŸ¥è©¢
         * 
         * è¿”å›å…©å¼µ Mapï¼š
         * - exactï¼šç²¾ç¢ºé…å°ï¼ˆå€åˆ†å¤§å°å¯«ï¼‰
         * - lowerï¼šå¯¬é¬†é…å°ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰
         * 
         * @param {Array} soundsJson - sounds.json é™£åˆ—ï¼Œæ¯é …åŒ…å« file èˆ‡ id
         * @returns {Object} { exact: Map, lower: Map }
         */
        function buildFileMapsFromConfig(soundsJson) {
          const exact = new Map(), lower = new Map();
          for (const s of soundsJson) {
            // æå–æª”æ¡ˆè·¯å¾‘çš„åŸºæœ¬å½¢å¼
            const file = canonFileKey(s.file), base = file.split('/').pop(), id = s.id || base;
            // é‡å°å¤šç¨®è·¯å¾‘è®Šé«”å»ºç«‹å°æ‡‰ï¼šå®Œæ•´è·¯å¾‘ã€åŸºæª”åã€å¸¶/ä¸å¸¶ sounds å‰ç¶´
            [file, base, `sounds/${file}`, `sounds/${base}`].forEach(k => { 
              exact.set(k, id); 
              lower.set(k.toLowerCase(), id); 
            });
          }
          return { exact, lower };
        }

        /** æª¢æŸ¥æœ€æ„›æ˜¯å¦éœ€è¦é·ç§» */
        const favoritesNeedMigration = raw => {
          const list = parseLegacyFavorites(raw);
          return list.length > 0 && !list.every(x => ID_REGEX.test(x));
        };

        /** åŸ·è¡Œæœ€æ„›å¾æª”ååˆ° ID çš„é·ç§» */
        function migrateFavoritesFromFilesToIds(soundsJson) {
          try {
            const raw = localStorage.getItem(CONFIG.storage.favorites);
            if (!favoritesNeedMigration(raw)) {
              localStorage.setItem(CONFIG.storage.favoritesVersion, '2');
              return;
            }
            const legacy = parseLegacyFavorites(raw);
            const { exact, lower } = buildFileMapsFromConfig(soundsJson);

            const out = [];
            const seen = new Set();
            const missing = [];

            legacy.forEach(k => {
              const c = canonFileKey(k);
              const base = c.split('/').pop();
              const candidates = [c, c.replace(/^sounds\//, ''), base, 'sounds/' + c, 'sounds/' + base];
              const id = candidates.map(cand => exact.get(cand) || lower.get(cand.toLowerCase())).find(Boolean);
              if (!id) { missing.push(k); return; }
              if (!seen.has(id)) { seen.add(id); out.push(id); }
            });

            // å¯«å…¥æ–°ç‰ˆ + å‚™ä»½èˆŠç‰ˆ
            localStorage.setItem(CONFIG.storage.favoritesBackup, raw);
            localStorage.setItem(CONFIG.storage.favorites, JSON.stringify(out));
            localStorage.setItem(CONFIG.storage.favoritesVersion, '2');

            // åŒæ­¥åˆ° runtimeï¼ˆæœ¬æ¬¡è¼‰å…¥ç«‹å³ç”Ÿæ•ˆï¼‰
            state.favorites = out;
            state.favSet = new Set(out);
            toast(`å·²å‡ç´šæœ€æ„›æ ¼å¼ï¼Œå…± ${out.length} ç­†${missing.length ? `ï¼›æœªåŒ¹é… ${missing.length} ç­†` : ''}ã€‚`);
            console.info('[favorites migration] done:', { converted: out.length, missing });
          } catch (err) {
            console.warn('[favorites migration] error:', err);
          }
        }

        /** å¾ç¥¨é¸çµæœé‡æ–°æ’åºéŸ³æ•ˆåˆ—è¡¨ */
        async function applyVoteResultsOrdering() {
          try {
            const resp = await fetch(withV(CONFIG.paths.voteResults), { cache: 'no-store' });
            if (!resp.ok) { console.warn('[vote load] resp not ok', resp.status); return false; }
            const voteData = await resp.json();
            const topIds = voteData.slice(0, CONFIG.awards.topRankCount).map(v => v.id).filter(Boolean);
            if (!topIds.length) return false;
            // ä¾ç¥¨é¸é †åºæ”¶é›†å·²åŒ¹é…çš„éŸ³æ•ˆ
            const seen = new Set();
            const matchedList = topIds.map(id => state.soundMap.get(id)).filter(s => s && !seen.has(s.id) && (seen.add(s.id), true));
            // é‡çµ„ï¼šå·²åŒ¹é…çš„å„ªå…ˆï¼Œå…¶é¤˜ä¿æŒåŸåº
            state.sounds = [...matchedList, ...state.sounds.filter(s => !seen.has(s.id))];
            state.soundMap = new Map(state.sounds.map(s => [s.id, s]));
            state.defaultSoundsSnapshot = state.sounds.map(s => ({ ...s }));
            state.voteResults = {
              matchedList,
              top10: matchedList.slice(0, CONFIG.awards.top10Count),
              next20: matchedList.slice(CONFIG.awards.top10Count, CONFIG.awards.topRankCount)
            };
            console.info('[vote reorder] applied ordering, matched:', matchedList.length, '/', topIds.length);
            return true;
          } catch (e) { console.warn('[vote load] failed', e); return false; }
        }

        /** è¼‰å…¥è¨­å®šæª”ä¸¦åˆå§‹åŒ–ç‹€æ…‹ */
        async function loadConfig() {
          const [tagsJson, soundsJson] = await Promise.all([
            fetch(withV(CONFIG.paths.tags), { cache: 'no-store' }).then(r => r.json()),
            fetch(withV(CONFIG.paths.sounds), { cache: 'no-store' }).then(r => r.json())
          ]);
          // è®€å–æ¨™ç±¤
          migrateFavoritesFromFilesToIds(soundsJson);
          state.tags = {};
          state.tagList = tagsJson.map(t => ({ key: utils.slug(t.key), name: t.name, color: t.color, role: t.role, avatar: t.avatar }));
          state.tagList.forEach(t => { state.tags[t.key] = t; });
          // è®€å–éŸ³æ•ˆã€‚è‹¥é…ç½®æª”ä¸­åŒ…å« idï¼Œå‰‡ä½¿ç”¨è©² idï¼›å¦å‰‡ fallback åˆ°æª”åã€‚åŠ ä¸Šç‰ˆæœ¬å­—ä¸²ã€‚
          state.sounds = soundsJson.map(s => {
            const id = s.id || s.file.replace(/^.*[\\\/]/, '');
            return { id, src: withV(`sounds/${s.file}`), file: s.file, title: s.title, tags: s.tags.slice() };
          });
          state.soundMap = new Map(state.sounds.map(s => [s.id, s]));
          // ä¿å­˜ä¸€ä»½åŸå§‹è¼‰å…¥é †åºçš„æ·ºæ‹·è²ï¼Œä¾›ã€Œé è¨­é †åºã€é‚„åŸä½¿ç”¨
          state.defaultSoundsSnapshot = state.sounds.map(s => ({ ...s }));
          // è¼‰å…¥ç¥¨é¸çµæœ JSONï¼Œå°‡å‰ N åä¾ç¥¨é¸é †åºç§»åˆ°æœ€å‰é¢
          await applyVoteResultsOrdering();
          // è¨ˆç®—å“ªäº›æ¨™ç±¤è¢«ä½¿ç”¨åˆ°ï¼Œä»¥ä¾›æ¨™ç±¤ä¸€è¦½
          const usedKeys = new Set();
          state.sounds.forEach(snd => snd.tags.forEach(t => usedKeys.add(utils.slug(t))));
          state.usedTagList = state.tagList.filter(t => usedKeys.has(t.key));
        }

        /** æ¸²æŸ“ä»‹é¢ï¼šä¾æ“šæœå°‹æ¢ä»¶ç¯©é¸éŸ³æ•ˆï¼Œå€åˆ†æœ€æ„›èˆ‡å…¶ä»– */
        /**
         * ä¸»æ¸²æŸ“å‡½å¼ï¼šæ ¹æ“šæœå°‹æ¢ä»¶ç¯©é¸ã€åˆ†é¡ã€æ’åºéŸ³æ•ˆï¼Œä¸¦æ›´æ–° UIã€‚
         * 
         * é‚è¼¯æµç¨‹ï¼š
         * 1. è§£ææœå°‹æ¢ä»¶ï¼ˆè©å½™ + æ¨™ç±¤ï¼‰
         * 2. ç¯©é¸ç¬¦åˆæ¢ä»¶çš„éŸ³æ•ˆ
         * 3. åˆ†é¡è‡³ä¸‰å€‹å€å¡Šï¼ˆæŒ‰å„ªå…ˆç´šï¼‰ï¼š
         *    - æœ€æ„›å€ï¼ˆæ”¶è—çš„éŸ³æ•ˆï¼‰
         *    - æ”¶åˆ°çš„åˆ—è¡¨ï¼ˆåˆ†äº«é€£çµå«æœ‰çš„éŸ³æ•ˆï¼Œéæœ€æ„›ï¼‰
         *    - ä¸€èˆ¬å€ï¼ˆå…¶ä»–ç¯©é¸çµæœï¼‰
         * 4. æ›´æ–° UIï¼šæ¸²æŸ“å¡ç‰‡ç¶²æ ¼ã€ç©ºç‹€æ…‹æç¤ºã€æ´»èºæœå°‹æ¨™ç±¤
         */
        function render() {
          const { terms, tags } = utils.parseQuery();
          // æ­¥é©Ÿ 1 & 2ï¼šç¯©é¸ç¬¦åˆæ¢ä»¶çš„éŸ³æ•ˆ
          const filtered = state.sounds.filter(s => utils.match(s, terms, tags));
          // è§£æåˆ†äº«åˆ—è¡¨åƒæ•¸ï¼ˆå¾ URLï¼‰
          const received = state.receivedList.map(id => state.soundMap.get(id)).filter(Boolean);
          const allowedIds = new Set(filtered.map(s => s.id)); // ç¯©é¸çµæœçš„ ID é›†åˆ
          
          // æ­¥é©Ÿ 3ï¼šåˆ†é¡å€å¡Š
          // æœ€æ„›å€ï¼šåœ¨ç¯©é¸çµæœä¸­çš„æ”¶è—éŸ³æ•ˆ
          const fav = state.favorites.map(id => state.soundMap.get(id)).filter(s => s && allowedIds.has(s.id));
          // æ”¶åˆ°çš„åˆ—è¡¨ï¼šåœ¨ç¯©é¸çµæœä¸­ã€éæœ€æ„›çš„åˆ†äº«éŸ³æ•ˆ
          const rec = received.filter(s => allowedIds.has(s.id) && !state.favSet.has(s.id));
          // ä¸€èˆ¬å€ï¼šç¯©é¸çµæœä¸­æ—¢éæœ€æ„›ä¹Ÿæœªåœ¨åˆ†äº«åˆ—è¡¨çš„éŸ³æ•ˆ
          const rest = filtered.filter(s => !state.favSet.has(s.id) && !rec.includes(s));
          
          // æ­¥é©Ÿ 4ï¼šæ›´æ–° UI
          // æœ€æ„›å€åªåœ¨éç·¨è¼¯æ¨¡å¼ä¸‹æ¸²æŸ“ï¼ˆé¿å…æ‹–æ”¾æ™‚é‡æ–°æ’åºå¡ç‰‡ï¼‰
          if (!state.isSorting) renderGrid(els.favGrid, fav, { inFav: true });
          renderGrid(els.receivedGrid, rec);
          
          // ä¸€èˆ¬å€æ”¹ç”¨åˆ†æ‰¹æ¸²æŸ“ï¼ˆè™›æ“¬æ»¾å‹•å„ªåŒ–ï¼‰
          state.displayList = rest;
          state.renderedCount = 0;
          els.grid.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
          
          // åˆå§‹åŒ– IntersectionObserverï¼ˆå¦‚æœå°šæœªå»ºç«‹ï¼‰
          if (!state.observer) {
            state.observer = new IntersectionObserver(entries => {
              if (entries[0].isIntersecting) renderNextBatch();
            }, { rootMargin: '400px' }); // ææ—© 400px è§¸ç™¼è¼‰å…¥
          } else {
            state.observer.disconnect();
          }
          
          renderNextBatch();

          // ç©ºç‹€æ…‹æç¤º
          els.favEmpty.classList.toggle('hidden', fav.length > 0);
          els.empty.classList.toggle('hidden', filtered.length > 0);
          els.receivedSection?.classList.toggle('hidden', rec.length === 0);
          // æ›´æ–°æœå°‹æ¨™ç±¤åˆ—ï¼ˆchipsï¼‰
          renderActiveChips();
        }

        /** æ¸²æŸ“ä¸‹ä¸€æ‰¹æ¬¡éŸ³æ•ˆå¡ç‰‡ */
        function renderNextBatch() {
          const { displayList, renderedCount } = state;
          if (renderedCount >= displayList.length) return;

          const batch = displayList.slice(renderedCount, renderedCount + CONFIG.ui.batchSize);
          if (batch.length === 0) return;

          // ç§»é™¤èˆŠçš„å“¨å…µå…ƒç´ 
          const oldSentinel = document.getElementById('grid-sentinel');
          if (oldSentinel) oldSentinel.remove();

          const fragment = document.createDocumentFragment();
          for (const s of batch) {
            fragment.appendChild(renderSoundCard(s));
          }
          els.grid.appendChild(fragment);
          state.renderedCount += batch.length;

          // è‹¥é‚„æœ‰å‰©é¤˜é …ç›®ï¼ŒåŠ å…¥å“¨å…µå…ƒç´ ä»¥è§¸ç™¼ä¸‹ä¸€æ¬¡è¼‰å…¥
          if (state.renderedCount < displayList.length) {
            const sentinel = dom.el('div', { id: 'grid-sentinel', style: { gridColumn: '1 / -1', height: '20px', pointerEvents: 'none' } });
            els.grid.appendChild(sentinel);
            state.observer.observe(sentinel);
          }
        }

        /** æ¸²æŸ“ç¥¨é¸é é¢ */
        function renderawardsPage() {
          if (!state.voteResults) {
            els.awardsTop10?.replaceChildren();
            els.awardsNext20?.replaceChildren();
            return;
          }
          if (els.awardsTop10) renderGrid(els.awardsTop10, state.voteResults.top10 ?? []);
          if (els.awardsNext20) renderGrid(els.awardsNext20, state.voteResults.next20 ?? []);
        }
        /** æ¸²æŸ“éŸ³æ•ˆå¡ç‰‡åˆ—è¡¨åˆ°å®¹å™¨ */
        function renderGrid(container, list, opts = { inFav: false }) {
          container.innerHTML = '';
          for (const s of list) { container.appendChild(renderSoundCard(s, opts)); }
        }
        /** å»ºç«‹å–®ä¸€éŸ³æ•ˆå¡ç‰‡å…ƒç´  */
        function renderSoundCard(snd, opts = { inFav: false }) {
          const interactive = !(state.isSorting && opts.inFav);
          const heartAttrs = {
            class: 'heart',
            'aria-pressed': String(utils.inFav(snd.id)),
            'aria-label': 'åŠ å…¥/ç§»é™¤æœ€æ„›',
            ...(!interactive && { disabled: 'true', 'aria-disabled': 'true', title: 'æ­£åœ¨ç·¨è¼¯æœ€æ„›æ’åºï¼Œç„¡æ³•è®Šæ›´æœ€æ„›' })
          };
          const heartBtn = dom.el('button', heartAttrs, dom.svgHeart());
          if (interactive) heartBtn.onclick = e => { e.stopPropagation(); toggleFavorite(snd.id, heartBtn); };
          const tagWrap = dom.el('div', { class: 'tags' });
          for (const t of snd.tags) {
            const tagKey = utils.slug(t);
            const color = state.tags[tagKey]?.color || '#94a3b8';
            const el = dom.el('span', { class: 'tag', style: { background: color } }, t);
            el.addEventListener('click', e => { e.stopPropagation(); addTagToQuery(tagKey); });
            tagWrap.appendChild(el);
          }
          const card = dom.el('div', { id: 'snd-' + snd.id, 'data-id': snd.id, class: 'sound', role: 'button', tabindex: '0', 'aria-label': `æ’­æ”¾éŸ³æ•ˆï¼š${snd.title}` }, [
            dom.el('div', { class: 'sound-top' }, [
              dom.el('div', { class: 'title', title: snd.title }, snd.title),
              heartBtn
            ]),
            tagWrap
          ]);
          const play = () => { try { playSoundObject(snd); } catch (e) { console.error(e); } };
          const endHold = () => clearTimeout(state.contextTimer);
          if (interactive) {
            card.addEventListener('click', play);
            card.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); play(); } });
            card.addEventListener('contextmenu', e => { e.preventDefault(); closeMenu(); openMenuForSound(snd, e.clientX, e.clientY); });
            card.addEventListener('pointerdown', e => {
              clearTimeout(state.contextTimer);
              const { clientX, clientY } = e;
              state.contextTimer = setTimeout(() => {
                closeMenu();
                openMenuForSound(snd, clientX || window.innerWidth / 2, clientY || window.innerHeight / 2);
              }, CONFIG.timing.longPressDelay);
            });
            card.addEventListener('pointerup', endHold);
            card.addEventListener('pointerleave', endHold);
          }
          card.addEventListener('pointercancel', endHold);
          return card;
        }

        /** åˆ‡æ›éŸ³æ•ˆçš„æœ€æ„›ç‹€æ…‹ */
        function toggleFavorite(id, btn) {
          if (state.isSorting) { toast(MESSAGES.toast.sortingBlocked); return; }
          if (state.favSet.has(id)) {
            state.favorites = state.favorites.filter(x => x !== id);
          } else {
            state.favorites.push(id);
          }
          state.favSet = new Set(state.favorites);
          utils.saveFav();
          if (btn) btn.setAttribute('aria-pressed', String(state.favSet.has(id)));
          render();
        }

        /** æ¸²æŸ“å·²é¸æ¨™ç±¤ chips */
        function renderActiveChips() {
          els.activeChips.innerHTML = '';
          for (const key of state.queryTags) {
            const tag = state.tags[key];
            const color = tag?.color || '#94a3b8';
            const chip = dom.el('span', { class: 'chip', style: { background: color }, onclick: () => { state.queryTags.delete(key); render(); updateURLFromState(true); } }, [
              `#${tag?.name || key}`,
              dom.el('button', { title: 'ç§»é™¤', onclick: () => { state.queryTags.delete(key); render(); updateURLFromState(true); } }, 'Ã—')
            ],
            );
            els.activeChips.appendChild(chip);
          }
        }

        /** å°‡æ¨™ç±¤åŠ å…¥æœå°‹æ¢ä»¶ */
        function addTagToQuery(tagKey) {
          state.queryTags.add(tagKey);
          render();
          updateURLFromState(true);
        }

        /** åˆå§‹åŒ–äº‹ä»¶ç¶å®š */
        function initEvents() {
          // æœå°‹æ¡†è¼¸å…¥ï¼ˆä½¿ç”¨ debounce é™ä½ render é »ç‡ï¼‰
          const handleSearchInput = () => {
            state.queryText = els.q.value;
            render();
            updateURLFromState(false);
          };
          els.q.addEventListener('input', utils.debounce(handleSearchInput, CONFIG.timing.searchDebounce));

          // æ¸…é™¤æœå°‹
          els.clearBtn.addEventListener('click', () => {
            els.q.value = '';
            state.queryText = '';
            state.queryTags.clear();
            render();
            updateURLFromState(true);
          });

          // å°è¦½åˆ‡æ›
          els.navTabs.forEach(tab => {
            tab.addEventListener('click', () => {
              const pg = tab.getAttribute('data-page');
              showPage(pg || 'home');
            });
          });
          // æ‰‹æ©Ÿé¸å–®é–‹é—œ
          if (els.navToggle) {
            els.navToggle.addEventListener('click', () => {
              const open = !document.body.classList.contains('nav-open');
              document.body.classList.toggle('nav-open', open);
              els.navToggle.setAttribute('aria-expanded', String(open));
            });
          }

          const closeNavMenu = () => {
            document.body.classList.remove('nav-open');
            els.navToggle?.setAttribute('aria-expanded', 'false');
          };
          // é»æ“Šé é¢å…¶ä»–åœ°æ–¹é—œé–‰æ‰‹æ©Ÿé¸å–®
          document.addEventListener('click', e => {
            if (!document.body.classList.contains('nav-open')) return;
            const headerEl = document.querySelector('header');
            if (headerEl && !headerEl.contains(e.target)) closeNavMenu();
          });
          // é»æ“Šå°è¦½å¾Œåœ¨å°è¢å¹•è‡ªå‹•æ”¶åˆ
          els.navTabs.forEach(t => t.addEventListener('click', closeNavMenu));

          // æ´—ç‰ŒæŒ‰éˆ•
          if (els.shuffleBtn) {
            els.shuffleBtn.addEventListener('click', () => {
              // åªæ´—ç‰Œã€Œéæœ€æ„›ã€éŸ³æ•ˆï¼Œä¸å½±éŸ¿æœ€æ„›å€çš„æ’åˆ—
              const nf = [];
              const idxs = [];
              state.sounds.forEach((s, i) => {
                if (!state.favSet.has(s.id)) { nf.push(s); idxs.push(i); }
              });
              shuffleInPlace(nf);
              idxs.forEach((i, k) => { state.sounds[i] = nf[k]; });
              render();
            });
          }
          // é è¨­é †åºæŒ‰éˆ•ï¼šå°‡éæœ€æ„›å€å¡Šæ¢å¾©ç‚ºè¼‰å…¥æ™‚çš„é †åº
          if (els.resetOrderBtn) {
            els.resetOrderBtn.addEventListener('click', () => {
              if (!state.defaultSoundsSnapshot || !state.defaultSoundsSnapshot.length) return;
              // æˆ‘å€‘åªæ¢å¾©éæœ€æ„›ï¼ˆrestï¼‰å€æ®µçš„é †åºï¼ŒåŒ shuffleBtn çš„è¡Œç‚ºç›¸å°æ‡‰
              const snapshot = state.defaultSoundsSnapshot;
              const idIndex = new Map(snapshot.map((s, i) => [s.id, i]));
              state.sounds.sort((a, b) => (idIndex.get(a.id) ?? Infinity) - (idIndex.get(b.id) ?? Infinity));
              render();
            });
          }
          // åˆ†äº«æœ€æ„›åˆ—è¡¨

          // æ‰‹å‹•æ’åºï¼ˆæª¢æŸ¥é»Aï¼‰ï¼šå•Ÿç”¨/åœç”¨ SortableJS åƒ…é‡å°æœ€æ„›æ¸…å–®
          if (els.sortFavBtn && els.doneSortBtn) {
            els.sortFavBtn.addEventListener('click', () => {
              state.isSorting = true;
              document.body.classList.add('sorting');
              els.sortFavBtn.classList.add('hidden');
              els.doneSortBtn.classList.remove('hidden');
              // é‡æ–°æ¸²æŸ“æœ€æ„›å€å¡Š
              const { terms, tags } = utils.parseQuery();
              const allowedIds = new Set(state.sounds.filter(s => utils.match(s, terms, tags)).map(s => s.id));
              const fav = state.favorites.map(id => state.soundMap.get(id)).filter(s => s && allowedIds.has(s.id));
              renderGrid(els.favGrid, fav, { inFav: true });
              // å•Ÿç”¨ SortableJS
              typeof Sortable !== 'undefined'
                ? state.sortable = Sortable.create(els.favGrid, {
                  dataIdAttr: 'data-id', animation: 150, delay: 150, delayOnTouchOnly: true,
                  ghostClass: 'drag-ghost', chosenClass: 'drag-chosen', dragClass: 'dragging',
                  filter: '.heart', preventOnFilter: false
                })
                : console.warn('SortableJS æœªè¼‰å…¥');
            });
            els.doneSortBtn.addEventListener('click', () => {
              const orderedIds = [...els.favGrid.children].map(el => el.dataset.id).filter(Boolean);
              if (orderedIds.length) {
                state.favorites = orderedIds.concat(state.favorites.filter(id => !orderedIds.includes(id)));
                state.favSet = new Set(state.favorites);
                utils.saveFav();
                toast(MESSAGES.toast.sortingSaved);
              }
              state.sortable?.destroy(); state.sortable = null;
              state.isSorting = false;
              document.body.classList.remove('sorting');
              els.doneSortBtn.classList.add('hidden');
              els.sortFavBtn.classList.remove('hidden');
              render();
            });
          }
          if (els.shareFavBtn) {
            els.shareFavBtn.addEventListener('click', async () => {
              const ids = [...state.favorites];
              if (ids.length === 0) { toast(MESSAGES.toast.noFavorites); return; }
              const url = buildListURL(ids);
              await copyToClipboard(url);
              toast(MESSAGES.toast.listLinkCopied);
            });
          }
        }

        // å…¥å£ï¼šè¼‰å…¥è¨­å®šå¾Œåˆå§‹åŒ–ç‹€æ…‹ã€æ¸²æŸ“ä¸¦å¥—ç”¨ URL æŸ¥è©¢
        loadConfig().then(() => {
          applyURLToState();
          renderTagList();
          showPage(state.page);
          render();
          focusSoundFromURL();
          initEvents();
          // é»æ“Šæ¨™é¡Œæ™‚å›åˆ°ä¸»é ä¸¦æ¸…é™¤æœå°‹ï¼ˆé˜»æ­¢é è¨­çš„å…¨é å°å‘ï¼‰ï¼Œç„¶å¾Œé‡æ–°æ¸²æŸ“èˆ‡æ›´æ–° URL
          try {
            const titleLink = document.querySelector('header h1');
            if (titleLink) {
              titleLink.addEventListener('click', (e) => {
                // å¦‚æœä½¿ç”¨è€…ä½¿ç”¨ Ctrl/Cmd + click æˆ– æƒ³è¦åœ¨æ–°åˆ†é é–‹å•Ÿï¼Œä¿ç•™åŸè¡Œç‚º
                if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
                // è‹¥å·²åœ¨ä¸»é ï¼Œå‰‡å¼·åˆ¶é‡æ–°æ•´ç†é é¢
                if (state.page === 'home') {
                  // å…è¨±ç€è¦½å™¨åšå®Œæ•´ reload
                  return location.reload();
                }
                e.preventDefault();
                // æ¸…é™¤æœå°‹ç‹€æ…‹ä¸¦å›é¦–é 
                state.queryText = '';
                state.queryTags.clear();
                if (els.q) els.q.value = '';
                showPage('home');
                render();
                updateURLFromState(true);
                // å¹³æ»‘æ»¾å›é ‚éƒ¨
                try { window.scrollTo({ top: 0, behavior: 'smooth' }); } catch (e) { }
              });
            }
          } catch (e) {/* ignore */ }
        }).catch(err => {
          console.error(err);
          els.grid.innerHTML = `<div class="empty">${MESSAGES.errors.configLoadFailed}</div>`;
        });

        /** åˆå§‹åŒ–é…å°è¨˜æ†¶éŠæˆ² */
        function setupConcentrationGame() {
          const gameEl = document.getElementById('concentration-game');
          const boardEl = document.getElementById('cg-board');
          const timerEl = document.getElementById('cg-timer');
          const accEl = document.getElementById('cg-accuracy');
          const resultEl = document.getElementById('cg-result');
          const restartBtn = document.getElementById('cg-restart');
          if (!gameEl) return;

          // æ³¨æ„ï¼šä¸è¦åœ¨æ­¤è™•é‡æ–°å®£å‘Š cgCleanup â€”â€” è«‹ä½¿ç”¨å¤–å±¤ä½œç”¨åŸŸçš„ cgCleanupï¼Œ
          // ä»¥ä¾¿åœ¨åˆ‡æ›é é¢æ™‚ï¼ˆç”± showPage å‘¼å«ï¼‰èƒ½æ­£ç¢ºåŸ·è¡Œæ¸…ç†å·¥ä½œã€‚

          // --- éŠæˆ²ç‹€æ…‹ ---
          let cards = [];
          let first = null, second = null;
          // scoring: correct = æ­£ç¢ºæ•¸ (æ¯é…å° +2), wrong = éŒ¯è§£æ•¸ (å¯ +0/+1/+2)
          let correct = 0, wrong = 0;
          // matchedPairs counts how many pairs have been solved (0..pairCount)
          let matchedPairs = 0, tries = 0;
          let timer = 0, timerId = null, running = false;
          let allowClick = true;
          let pairs = [];
          // pending pair / timeout ç”¨æ–¼å»¶é²æª¢æŸ¥é…å°ï¼›è‹¥ä½¿ç”¨è€…åœ¨ç­‰å¾…æœŸé–“é»æ“Šå…¶ä»–å¡ï¼Œæœƒç«‹åˆ»çµç®—é€™å°ã€‚
          let pendingTimeout = null;
          let pendingPair = null; // {f, s}
          let timerStarted = false; // only start timer on first card flip

          /**
           * å¾ç¯©é¸éçš„æœ‰æ•ˆéŸ³æ•ˆä¸­é¸å‡ºæœ€å¤š 8 ç­†ä½œç‚ºé…å°ä¾†æºã€‚
           * 
           * é¸æ“‡ç­–ç•¥ï¼ˆå„ªå…ˆé †åºï¼‰ï¼š
           * 1. å·²çŸ¥ä¸»æ’­ï¼ˆæœ‰é…é¡ï¼‰ï¼šæŒ‰å„ªå…ˆé †åºé¸å–ç›´åˆ°é…é¡æ»¿æˆ–ç„¡å­˜é‡
           * 2. æœªçŸ¥ä¸»æ’­ï¼šæœ€å¤šé¸ 2 ç­†ä½œç‚ºè£œå……
           * 
           * é…é¡åˆ†é…ï¼š
           * - åœ°åŸºä¸»é˜¿è¬ï¼š2 ç­†
           * - ç“¦å“ˆ/Matsuko/è±¹å­é ­/è²“ä¸‹å»ï¼šå„ 1 ç­†
           * - å…¶ä»–å‹•ç‰©æœ‹å‹ï¼š2 ç­†
           * 
           * @param {Array} validSounds - å·²ç¯©é¸çš„éŸ³æ•ˆæ¸…å–®ï¼ˆå·²ç§»é™¤é«’è©±/SUSã€åªæœ‰ä¸€å€‹ streamer æ¨™ç±¤ï¼‰
           * @returns {Array} æœ€å¤š 8 ç­†é¸ä¸­çš„éŸ³æ•ˆ
           */
          function selectSounds(validSounds) {
            const quotas = { 'é˜¿è¬': 2, 'ç“¦å“ˆ': 1, 'Matsuko': 1, 'è±¹å­é ­': 1, 'è²“ä¸‹å»': 1 };
            const knownTags = new Set(Object.keys(quotas));
            const counts = Object.fromEntries(Object.keys(quotas).map(k => [k, 0]));
            let others = 0; // å…¶ä»–å‹•ç‰©æœ‹å‹çš„è¨ˆæ•¸
            const chosen = [];
            
            for (const snd of validSounds) {
              if (chosen.length >= CONFIG.game.pairCount) break; // é”é…å°æ•¸ä¸Šé™ï¼Œåœæ­¢
              const tags = snd.tags ?? [];
              // å„ªå…ˆé¸æ“‡æœ‰é…é¡ä¸”æœªæ»¿çš„å·²çŸ¥ä¸»æ’­
              const knownTag = tags.find(t => knownTags.has(t) && counts[t] < quotas[t]);
              if (knownTag) { counts[knownTag]++; chosen.push(snd); }
              // æ¬¡é¸ï¼šå…¶ä»–å‹•ç‰©æœ‹å‹ï¼Œå¿…é ˆè¦å† 2 ç­†
              else if (!tags.some(t => knownTags.has(t)) && others < 2) { others++; chosen.push(snd); }
            }
            return chosen;
          }

          // --- è³‡æ–™ç¯©é¸ ---
          /**
           * æŒ‘é¸é…å°éŠæˆ²çš„éŸ³æ•ˆæ¸…å–®ã€‚
           * 
           * ç¯©é¸è¦å‰‡ï¼š
           * 1. å¿…é ˆæ°å¥½åŒ…å« 1 å€‹ streamer æ¨™ç±¤ï¼ˆè­˜åˆ¥ä¸»æ’­ï¼‰
           * 2. ä¸èƒ½åŒ…å« 'é«’è©±' æˆ– 'SUS' æ¨™ç±¤
           * 3. æ‡‰ç”¨é¸æ“‡é…é¡ï¼ˆåœ°åŸºä¸»2å€‹ã€é­”æ³•å€¼ç­å®¤å…¶ä»–4äººå„1å€‹ã€å…¶ä»–å‹•ç‰©æœ‹å‹éš¨æ©Ÿé¸2ï¼‰
           * 4. å†æ¬¡æ´—ç‰Œä»¥éš¨æ©ŸåŒ–å°ç‰Œé †åº
           * 
           * @returns {Array<Object>} é¸å®šçš„é…å°ç‰©ä»¶æ¸…å–®ï¼Œæ¯å€‹åŒ…å« idã€audioã€avatarã€streamerNameã€title
           */
          function pickPairs() {
            // è¼”åŠ©ï¼šå¾ tagList æ“·å–æ‰€æœ‰ streamer çš„ keyï¼ˆä¸¦åš slug åŒ–ï¼‰ä»¥ä¾›å¾ŒçºŒæ¯”å°
            const streamerKeys = state.tagList
              .filter(t => t.role === 'streamer')
              .map(t => utils.slug(t.key));

            // åˆ¤æ–·æ¨™ç±¤æ˜¯å¦ç‚º streamerï¼ˆå·² slug åŒ–ï¼‰
            const isStreamer = t => streamerKeys.includes(t);
            
            // ç¯©é¸æœ‰æ•ˆçš„éŸ³æ•ˆï¼šæ°å¥½ 1 å€‹ streamerï¼Œç„¡é«’è©±/SUS
            let validSounds = state.sounds.filter(s => {
              const st = s.tags.filter(isStreamer);
              if (st.length !== 1) return false; // å¿…é ˆæ°å¥½ 1 å€‹ streamer
              if (s.tags.includes('é«’è©±') || s.tags.includes('SUS')) return false; // æ’é™¤ç¦æ­¢æ¨™ç±¤
              return true;
            });

            // æ´—ç‰Œï¼Œæ‡‰ç”¨é…é¡é¸æ“‡ï¼Œç¢ºä¿å¤šæ¨£æ€§
            validSounds = shuffleInPlace(validSounds);
            let chosen = selectSounds(validSounds);
            chosen = shuffleInPlace(chosen); // å†æ´—ç‰Œä»¥éš¨æ©ŸåŒ–å°ç‰Œé †åº
            // æœ€å¾Œç¢ºä¿ä¸è¶…éé…å°æ•¸é‡
            chosen.splice(CONFIG.game.pairCount);

            // æ˜ å°„åˆ°é…å°ç”¨ç‰©ä»¶ï¼ˆåŒ…å« id, audio, avatar, streamerName, title ç­‰æ¬„ä½ï¼‰
            return chosen.map(s => {
              const streamerTag = s.tags.find(isStreamer);
              const tagObj = state.tags[utils.slug(streamerTag)];
              return {
                id: s.id,
                audio: s.src,
                streamer: streamerTag,
                avatar: tagObj?.avatar || '',
                streamerName: tagObj?.name || streamerTag,
                title: s.title
              };
            });
          }

          /** é–‹å§‹æ–°éŠæˆ² */
          function startGame() {
            pairs = pickPairs();
            // å¦‚æœæ‰¾ä¸åˆ°è¶³å¤ çš„é…å°éŸ³æ•ˆï¼Œé¡¯ç¤ºè¨Šæ¯ä¸¦ä¸­æ­¢éŠæˆ²å•Ÿå‹•
            if (!pairs?.length) {
              resultEl.innerHTML = `<h3>ç„¡æ³•é–‹å§‹éŠæˆ²</h3><p style="color:var(--muted)">${MESSAGES.errors.gameNoSounds}</p>`;
              resultEl.classList.remove('hidden');
              running = state.cgRunning = false;
              return;
            }
            [cards, pendingTimeout, pendingPair] = [[], (clearTimeout(pendingTimeout), null), null];
            // ç‚ºæ¯å€‹é…å°å»ºç«‹å…©å¼µç›¸åŒçš„å¡ç‰‡
            for (const p of pairs) {
              const base = { type: 'card', pairId: p.id, audio: p.audio, avatar: p.avatar, streamer: p.streamer, streamerName: p.streamerName, title: p.title, matched: false, seen: false };
              cards.push({ ...base, id: `${p.id}-0` }, { ...base, id: `${p.id}-1` });
            }
            shuffleInPlace(cards);
            [matchedPairs, correct, wrong, tries, timer, first, second] = [0, 0, 0, 0, 0, null, null];
            allowClick = true;
            timerStarted = running = state.cgRunning = false;
            if (timerEl) { timerEl.textContent = formatTime(0); timerEl.classList.remove('cg-running'); }
            updateBoard();
            updateStats();
            resultEl.classList.add('hidden');
            // æä¾›æ¸…ç†å‡½å¼
            cgCleanup = () => {
              running = false;
              state.cgRunning = false;
              stopTimer();
              stopCurrentAudio();
              timerEl?.classList.remove('cg-running');
              boardEl.innerHTML = '';
              clearTimeout(pendingTimeout);
              pendingTimeout = pendingPair = null;
            };
          }
          /** é‡æ–°æ¸²æŸ“éŠæˆ²æ¿é¢ */
          function updateBoard() {
            boardEl.innerHTML = '';
            for (const [idx, card] of cards.entries()) {
              const cardEl = dom.el('div', {
                class: `cg-card${card.flipped || card.matched ? ' flipped' : ''}${card.matched ? ' matched' : ''}`,
                'data-idx': idx,
                onclick: () => onCardClick(idx),
                onpointerdown: () => { cardEl.classList.add('clicked'); setTimeout(() => cardEl.classList.remove('clicked'), 160); }
              });
              const backContent = card.avatar
                ? `<img src="${withV(card.avatar)}" alt="${card.streamerName}">`
                : `<div style="font-weight:700;color:var(--muted);font-size:12px">${card.streamerName}</div>`;
              cardEl.innerHTML = `<div class="cg-card-inner"><div class="cg-card-front"></div><div class="cg-card-back">${backContent}${card.matched ? '<div class="cg-lock">âœ“</div>' : ''}</div></div>`;
              boardEl.appendChild(cardEl);
            }
          }

          let currentAudio = null;
          /** åœæ­¢ç•¶å‰æ’­æ”¾çš„éŸ³æ•ˆ */
          const stopCurrentAudio = () => { if (currentAudio) { try { currentAudio.pause(); currentAudio.currentTime = 0; } catch (e) { } currentAudio = null; } };

          /** è™•ç†å¡ç‰‡é»æ“Šä¸¦æª¢æŸ¥é…å° */
          function onCardClick(idx) {
            // å¦‚æœæœ‰å¾…è™•ç†çš„ pendingPairï¼Œä½¿ç”¨è€…æ­¤åˆ»é»æ“Šå…¶ä»–å¡ç‰‡æ™‚æ‡‰ç«‹å³çµç®—è©² pendingPair
            if (pendingPair?.f || pendingPair?.s) {
              clearTimeout(pendingTimeout);
              pendingTimeout = null;
              const p = pendingPair;
              pendingPair = null;
              checkMatchPair(p.f, p.s);
              first = second = null;
              allowClick = true;
            }
            if (!allowClick) return;
            const card = cards[idx];
            if (card.flipped || card.matched) return;
            // åœ¨ç©å®¶ç¬¬ä¸€æ¬¡äº’å‹•ï¼ˆç¿»ç‰Œï¼‰æ™‚å•Ÿç”¨è¨ˆæ™‚å™¨
            if (!timerStarted) {
              timerStarted = running = state.cgRunning = true;
              timerEl?.classList.add('cg-running');
              startTimer();
            }
            // åŸ·è¡Œç¿»ç‰Œï¼ˆæ›´æ–°è³‡æ–™ç‹€æ…‹ä¸¦é‡æ–°æ¸²æŸ“æ¿é¢ï¼Œè§¸ç™¼ CSS ç¿»ç‰Œå‹•ç•«ï¼‰
            card.flipped = true;
            updateBoard();
            if (!first) {
              // è¨˜éŒ„é€™å¼µå¡ç‰Œåœ¨ç¿»å‰æ˜¯å¦å·²è¢«ç¿»çœ‹éï¼ˆç”¨æ–¼è¨ˆåˆ†åˆ¤å®šï¼‰
              card._seenBefore = !!card.seen;
              // æ¨™è¨˜ç‚ºå·²çœ‹éï¼ˆé¿å…å¾ŒçºŒé‡è¤‡è¨ˆåˆ†ï¼‰
              card.seen = true;
              first = card;
              // æ’­æ”¾è©²å¡çš„éŸ³æ•ˆä¸¦é¡¯ç¤ºæ¨™é¡Œ
              stopCurrentAudio();
              currentAudio = createPlayer(card.audio, { preload: 'auto' });
              if (card.title) toast(card.title, 3000);
            } else if (!second) {
              // ç¬¬äºŒå¼µå¡çš„è™•ç†ï¼šåŒæ¨£æ¨™è¨˜æ˜¯å¦å…ˆå‰çœ‹éä¸¦æ’­æ”¾éŸ³æ•ˆ
              card._seenBefore = !!card.seen;
              card.seen = true;
              second = card;
              stopCurrentAudio();
              currentAudio = createPlayer(card.audio, { preload: 'auto' });
              if (card.title) toast(card.title, 3000);
              tries++;
              allowClick = false;
              // æ•ç²ç•¶å‰ç¬¬ä¸€å¼µ/ç¬¬äºŒå¼µå¡çš„å¼•ç”¨ï¼Œé¿å…åœ¨å»¶é²æœŸé–“è¢«å…¶ä»–é‚è¼¯æ”¹å¯«é€ æˆ race conditionã€‚
              const fCard = first;
              const sCard = second;
              // å„²å­˜ç‚º pendingPairï¼Œä¸¦å•Ÿå‹•è¶…æ™‚ï¼ˆ500msï¼‰ã€‚å¦‚æœä½¿ç”¨è€…åœ¨æ­¤æœŸé–“é»æ“Šå…¶ä»–å¡
              // å‰‡æœƒåœ¨ onCardClick é–‹é ­ç«‹åˆ»çµç®—é€™å°ã€‚
              pendingPair = { f: fCard, s: sCard };
              if (pendingTimeout) { clearTimeout(pendingTimeout); pendingTimeout = null; }
              pendingTimeout = setTimeout(() => {
                pendingTimeout = null;
                const p = pendingPair; pendingPair = null;
                checkMatchPair(p.f, p.s);
                // é‡ç½®å…¨åŸŸæš«å­˜ï¼Œå…è¨±ä¸‹ä¸€å›åˆäº’å‹•
                first = null;
                second = null;
                allowClick = true;
              }, CONFIG.game.cardFlipDelay);
            }
            updateStats();
          }

          /** æª¢æŸ¥å…©å¼µå¡ç‰‡æ˜¯å¦é…å° */
          function checkMatchPair(f, s) {
            if (!f || !s) return;
            if (f.pairId === s.pairId) {
              f.matched = s.matched = true;
              correct += 2;
              matchedPairs++;
            } else {
              const seenCount = [f, s].filter(c => c._seenBefore).length;
              wrong += seenCount || 0;
              f.flipped = s.flipped = false;
            }
            delete f._seenBefore; delete s._seenBefore;
            updateBoard();
            updateStats();
            if (matchedPairs === pairs.length) { stopCurrentAudio(); endGame(); }
          }

          /** æ›´æ–°éŠæˆ²çµ±è¨ˆé¡¯ç¤º */
          function updateStats() {
            timerEl.textContent = formatTime(timer);
            const denom = correct + wrong;
            accEl.textContent = denom ? `æº–ç¢ºç‡ï¼š${Math.round((correct / denom) * 100)}%` : 'æº–ç¢ºç‡ï¼š--%';
          }

          /** æ ¼å¼åŒ–æ™‚é–“ç‚º mm:ss */
          const formatTime = t => `${String(Math.floor(t / 60)).padStart(2, '0')}:${String(t % 60).padStart(2, '0')}`;

          /** å•Ÿå‹•éŠæˆ²è¨ˆæ™‚å™¨ */
          function startTimer() {
            clearInterval(timerId);
            timerId = setInterval(() => { if (state.cgRunning) { timer++; timerEl.textContent = formatTime(timer); } }, 1000);
          }
          /** åœæ­¢éŠæˆ²è¨ˆæ™‚å™¨ */
          const stopTimer = () => { clearInterval(timerId); timerId = null; };

          /** çµæŸéŠæˆ²ä¸¦é¡¯ç¤ºæˆç¸¾ */
          function endGame() {
            running = state.cgRunning = false;
            stopTimer();
            stopCurrentAudio();
            timerEl?.classList.remove('cg-running');
            const denom = correct + wrong;
            const perc = denom ? Math.round((correct / denom) * 100) : '--';
            const stat = (v, l) => `<div><div class="big-num">${v}</div><div class="muted">${l}</div></div>`;
            const stats = [[formatTime(timer), 'ç”¨æ™‚'], [correct, 'æ­£ç¢ºæ•¸'], [wrong, 'éŒ¯è§£æ•¸'], [perc + '%', 'æº–ç¢ºç‡']].map(([v, l]) => stat(v, l)).join('');
            resultEl.innerHTML = `<h3>å®Œæˆï¼</h3>
                                  <div class="stats">${stats}</div>
                                  <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
                                    <button class="btn small-btn" id="cg-restart-2">å†ä¾†ä¸€å±€</button>
                                    <button class="btn small-btn" id="cg-home">å›ä¸»é </button>
                                  </div>`;
            resultEl.classList.remove('hidden');
            // è‹¥æº–ç¢ºç‡é”æ¨™ï¼Œéš¨æ©Ÿæ’­æ”¾çå‹µéŸ³æ•ˆ
            if (perc >= CONFIG.game.rewardAccuracy) {
              const reward = state.soundMap.get(CONFIG.game.rewardSoundIds[Math.floor(Math.random() * CONFIG.game.rewardSoundIds.length)]);
              if (reward?.src) { stopCurrentAudio(); currentAudio = createPlayer(reward.src, { preload: 'auto' }); toast(MESSAGES.toast.gameReward, 3000); }
            }
            utils.byId('cg-restart-2')?.addEventListener('click', startGame);
            utils.byId('cg-home')?.addEventListener('click', () => showPage('home'));
          }

          restartBtn.onclick = startGame;

          // åˆå§‹ï¼šè¼‰å…¥é é¢æ™‚é¡¯ç¤ºå¡ç‰Œï¼ˆä¸å•Ÿå‹•è¨ˆæ™‚ï¼‰ã€‚æŒ‰ã€Œé‡é–‹ä¸€å±€ã€å¯é‡æ–°å»ºç«‹ä¸€å±€ï¼›è¨ˆæ™‚çš†åœ¨ç¬¬ä¸€å¼µç¿»ç‰Œæ™‚å•Ÿå‹•ã€‚
          // é€™è£¡å‘¼å« startGame() ä»¥å»ºç«‹ä¸¦é¡¯ç¤ºå¡ç‰Œï¼ˆä½† timerStarted=falseï¼Œä¸æœƒè‡ªå‹•é–‹å§‹è¨ˆæ™‚ï¼‰
          startGame();
        }

        // åˆ‡æ›åˆ°å°éŠæˆ²åˆ†é æ™‚åˆå§‹åŒ–/æ¸…ç† Concentration Gameï¼ˆä½¿ç”¨äº‹ä»¶é©…å‹•ï¼‰
        document.addEventListener('pageChange', ({ detail: { page, prevPage, phase } = {} }) => {
          try {
            if (phase === 'before' && prevPage === 'game') cgCleanup?.();
            if (phase === 'after') {
              page === 'game' && setupConcentrationGame?.();
              page === 'awards' && renderawardsPage();
            }
          } catch { /* swallow to avoid breaking page flow */ }
        });

      })();
    </script>
</body>

</html>