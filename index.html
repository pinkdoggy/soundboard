<!doctype html><html lang="zh-Hant"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="assets/favicon.png" type="image/png"><title>阿萬與動物朋友按鈕</title><style>:root{--bg:#0b0d10;--search:#0b0d1000;--fg:#e9eef5;--muted:#a8b3c7;--card:#141821;--card-2:#212832;--border:#202636;--accent:#6aa9ff;--accent2:#ff9e6a;--heart:#ff5a7a;--chip-fg:#0b0d10;--shadow:0 6px 24px rgba(0, 0, 0, .25);--bg-blend-mode:normal;--bg-opacity:0.25;--control-h:44px;--liquid-hover:rgba(96, 150, 255, .20)}:root.light{--bg:#f8fafc;--search:#f8fafc00;--fg:#0d1320;--muted:#4b5563;--card:#ffffff;--card-2:#f3f6fb;--border:#e5e7eb;--accent:#2563eb;--accent2:#eb7b25;--heart:#e11d48;--chip-fg:#ffffff;--shadow:0 4px 18px rgba(2, 6, 23, .08);--bg-blend-mode:normal;--bg-opacity:0.35}*{box-sizing:border-box}body,html{height:100%}body{margin:0;background-color:var(--bg);color:var(--fg);font:medium ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Noto Sans,"Helvetica Neue",Arial;position:relative;z-index:1}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:url('assets/background-by-jia.avif');background-size:auto 90%;background-repeat:repeat;background-attachment:fixed;mix-blend-mode:var(--bg-blend-mode);opacity:var(--bg-opacity);z-index:-1}a{color:inherit}.wrap{max-width:1100px;margin:0 auto;padding:20px}header{display:flex;align-items:center;flex-wrap:wrap;gap:12px;margin-bottom:14px}header h1{white-space:nowrap;margin-right:auto}h1{font-size:1.4rem;margin:0 8px 0 0;letter-spacing:.5px}.theme-toggle{border:1px solid var(--border);background:var(--card);color:var(--fg);border-radius:10px;padding:8px 12px;cursor:pointer;box-shadow:var(--shadow)}.search-row{display:flex;flex-wrap:wrap;gap:0;align-items:stretch;position:sticky;top:0;background:var(--search);padding:8px 0 12px;z-index:5}.searchbar{flex:1 1 260px;display:flex;align-items:center;gap:6px;background:var(--glass-bg)!important;border:1px solid var(--glass-border)!important;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-radius:12px;padding:6px 8px;box-shadow:var(--shadow);position:relative;height:var(--control-h)}.searchbar input{flex:1;background:0 0;border:0;outline:0;color:var(--fg);font-size:16px;min-width:160px;height:100%;line-height:var(--control-h);padding:0 6px}.chips{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}.chip{display:inline-flex;align-items:center;gap:4px;border-radius:999px;padding:4px 8px;font-size:12px;color:var(--chip-fg);box-shadow:0 2px 6px rgba(0,0,0,.18)}.chip button{appearance:none;border:0;background:0 0;color:inherit;cursor:pointer;font-size:14px;line-height:1;padding:0 0 0 2px}.searchbar .chip{cursor:pointer}.section-title{margin:18px 0 10px;font-weight:700;letter-spacing:.3px}.grid{display:grid;gap:4px;grid-template-columns:repeat(6,minmax(0,1fr))}@media (max-width:1000px){.grid{grid-template-columns:repeat(5,minmax(0,1fr))}}@media (max-width:800px){.grid{grid-template-columns:repeat(4,minmax(0,1fr))}}@media (max-width:600px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}@media (max-width:400px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}.sound{background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1) blur(8px);-webkit-backdrop-filter:saturate(1) blur(8px);border-radius:12px;padding:8px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:5px 2px;user-select:none;cursor:pointer;transition:transform .06s ease}.sound:active{transform:scale(.985)}.sound-top{display:flex;align-items:center;gap:4px}.title{font-weight:600;font-size:smaller;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.heart{width:24px;height:24px;border-radius:50%;place-items:center;border:1px solid var(--border);background:var(--card-2);cursor:pointer;flex:0 0 auto}.heart svg{width:16px;height:16px;display:block}.heart[aria-pressed=true] svg path{fill:var(--heart)}.tags{display:flex;flex-wrap:wrap;gap:6px}.tag{border-radius:999px;padding:3px 6px;font-size:small;color:var(--chip-fg);cursor:pointer;white-space:nowrap;box-shadow:0 2px 6px rgba(0,0,0,.16)}.stage{position:fixed;left:0;right:0;bottom:12px;display:flex;flex-wrap:wrap;gap:12px 14px;justify-content:center;pointer-events:none;z-index:40;padding:0 12px}.group{display:inline-flex;gap:8px;align-items:flex-end}.avatar{width:75px;height:75px;border-radius:999px;background:0 0;overflow:hidden;border:2px solid rgba(255,255,255,.8);box-shadow:0 8px 24px rgba(0,0,0,.35);transform-origin:50% 100%}.avatar>img{width:100%;height:100%;object-fit:cover}@keyframes popIn{0%{transform:translateY(20px) scale(.7);opacity:0}100%{transform:translateY(0) scale(1);opacity:1}}@keyframes jitter{0%,100%{transform:translateY(0) rotate(0)}20%{transform:translateY(-2px) rotate(-1deg)}40%{transform:translateY(1px) rotate(1deg)}60%{transform:translateY(-1px) rotate(.6deg)}80%{transform:translateY(1px) rotate(-.6deg)}}@keyframes hopOut{0%{transform:translateY(0);opacity:1}22%{transform:translateY(-12px);opacity:1}100%{transform:translateY(60px);opacity:0}}.pop-in{animation:popIn .28s cubic-bezier(.2,.9,.18,1) both}.jit{animation:jitter .9s ease-in-out infinite}.hop-out{animation:hopOut .5s cubic-bezier(.2,.8,.2,1) forwards}.hidden{display:none}.desc{color:var(--muted);font-size:14px;margin:0 0 6px}.empty{color:var(--muted);padding:12px 0}.row{display:flex;gap:10px;flex-wrap:wrap}.btn{border:1px solid var(--border);background:var(--card);color:var(--fg);border-radius:10px;padding:8px 12px;cursor:pointer}.tabs{display:flex;gap:8px;align-items:center;flex-wrap:wrap}.tab{display:inline-block;padding:6px 16px;font-size:14px;border:1px solid var(--border);border-radius:999px;background:var(--card-2);color:var(--fg);cursor:pointer;transition:background .15s ease,color .15s ease}.tab:hover{background:var(--card)}.tab.active{background:var(--accent);border-color:var(--accent);color:var(--chip-fg)}@media (max-width:600px){header .tabs{margin-top:8px}header .theme-toggle{margin-top:8px}}.section-header{display:flex;align-items:center;justify-content:space-between;margin:14px 0 8px}.section-header .actions{display:flex;gap:3px}.section-header h3{margin:0;font-size:1rem;font-weight:600;letter-spacing:.2px}.small-btn{font-size:12px;padding:4px 8px;border-radius:8px}.tag-list{display:flex;flex-wrap:wrap;gap:6px 8px;margin:8px 0}.tag-list .tag{cursor:pointer}.menu{position:fixed;z-index:9999;min-width:180px;background:var(--glass-bg)!important;border:1px solid var(--glass-border)!important;backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);border-radius:12px;overflow:hidden}.menu.hidden{display:none}.menu-item{padding:10px 12px;cursor:pointer;border-bottom:1px solid var(--border)}.menu-item:last-child{border-bottom:0}.menu-item:hover{background:var(--liquid-hover)}.toast{position:fixed;left:50%;bottom:80px;transform:translateX(-50%);background:var(--card);border:1px solid var(--border);padding:10px 14px;border-radius:10px;box-shadow:var(--shadow);z-index:70}.toast.hidden{display:none}.mix-panel{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;width:min(980px,calc(100% - 32px));background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.6) blur(18px);-webkit-backdrop-filter:saturate(1.6) blur(18px);border-radius:16px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px;padding:12px 14px 14px;z-index:80}.mix-panel.hidden{display:none}.mix-header{display:flex;flex-direction:column;gap:6px}.mix-scroll-host{position:relative;overflow-x:auto;overflow-y:hidden;border-radius:12px;background:rgba(15,23,42,.22);border:1px solid rgba(255,255,255,.12);scrollbar-width:none}.mix-scroll-host::-webkit-scrollbar{display:none}.mix-scroll-content{position:relative;min-height:75px}.mix-track-lanes{position:relative}.mix-track{position:relative;height:25px;border-bottom:1px dashed var(--glass-border);background-color:var(--glass-bg);overflow:hidden}.mix-track:last-of-type{border-bottom:0}.mix-track::before{content:attr(data-label);position:absolute;left:0;top:50%;transform:translate(-110%,-50%);font-size:12px;color:var(--muted)}.mix-clip{position:absolute;top:1px;height:23px;border-radius:8px;padding:4px 26px 4px 8px;font-size:12px;font-weight:600;color:var(--chip-fg);display:flex;align-items:center;cursor:grab;box-shadow:0 1px 3px rgba(0,0,0,.35)}.mix-clip:active{cursor:grabbing}.mix-clip.dragging{opacity:.85;box-shadow:0 2px 5px rgba(0,0,0,.55);cursor:grabbing}.mix-clip,.mix-scroll-host,.mix-track-lanes{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.mix-clip,.mix-scroll-host,.mix-track-lanes{touch-action:none}.mix-clip-title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}.mix-clip-remove{position:absolute;right:4px;top:4px;border:0;width:15px;height:15px;border-radius:999px;background:rgba(15,23,42,.6);color:var(--chip-fg);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px}.mix-clip-remove:hover{background:rgba(15,23,42,.8)}.mix-clip-placeholder{height:23px;margin:0;position:absolute;top:1px;left:0;right:0;pointer-events:none}.mix-playhead{position:absolute;top:0;bottom:0;width:2px;background:var(--accent);z-index:3;pointer-events:none}.mix-bar-row{display:flex;align-items:center;gap:8px;margin:0 4px}.mix-bar-row>.mix-bar{flex:1;display:flex;align-items:center;gap:6px;min-width:0}.mix-bar input[type=range]{flex:1;min-width:0}.mix-controls{display:flex;align-items:center;justify-content:space-between;gap:4px}.mix-controls-left{display:flex;align-items:center;gap:4px}.mix-controls-center{display:flex;align-items:center;gap:2px}.mix-controls-right{display:flex;align-items:center;gap:4px}.mix-btn{border:1px solid var(--glass-border);background:var(--card-2);color:var(--fg);border-radius:8px;padding:6px 6px;cursor:pointer;min-width:32px;display:inline-flex;align-items:center;justify-content:center;gap:2px;font-size:13px}.mix-btn:hover{background:rgba(15,23,42,.55)}.mix-btn[disabled]{opacity:.4;cursor:not-allowed}.mix-muted{color:var(--muted);font-size:12px}.mix-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:120}.mix-modal-backdrop.hidden{display:none}.mix-modal{background:var(--bg);border:1px solid var(--glass-border);border-radius:12px;padding:12px 12px;max-width:320px;box-shadow:var(--shadow)}.mix-modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:16px}.glow-persistent{box-shadow:0 0 0 4px rgba(106,169,255,.5),0 0 12px rgba(106,169,255,.75);transition:box-shadow .3s ease}:root{--glass-bg:rgba(20, 24, 33, .8);--glass-border:rgba(255, 255, 255, .12)}:root.light{--glass-bg:rgba(255, 255, 255, .6);--glass-border:rgba(15, 23, 42, .12)}.glass{background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px);background-clip:padding-box;box-shadow:var(--shadow)}.menu,.searchbar,.sound{background:var(--glass-bg)!important;border-color:var(--glass-border)!important;backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px)}header{position:relative}.nav-toggle{display:none;align-items:center;justify-content:center;border:1px solid var(--border);background:var(--card);color:var(--fg);border-radius:10px;padding:8px;cursor:pointer;box-shadow:var(--shadow)}@media (max-width:760px){.nav-toggle{display:inline-flex}header .tabs{display:none;position:absolute;right:0;top:100%;padding:8px;border-radius:12px;gap:6px;flex-direction:column;align-items:stretch;min-width:180px;z-index:120;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);box-shadow:var(--shadow)}body.nav-open header .tabs{display:flex}}body.bg-full{--bg-opacity:1!important}.bg-page{min-height:50vh}.bg-credit{position:fixed;right:16px;bottom:16px;font-size:large;padding:8px 12px;border-radius:10px;font-weight:800;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(10px);-webkit-backdrop-filter:saturate(1.8) blur(10px);box-shadow:var(--shadow);z-index:60}.bg-credit a{text-decoration:underline}#clearBtn.btn{height:var(--control-h);display:inline-flex;align-items:center;justify-content:center;padding:0 14px}.search-row .searchbar{border-top-right-radius:0;border-bottom-right-radius:0;border-right:0!important}.search-row #clearBtn{border-top-left-radius:0;border-bottom-left-radius:0;border-left:1px solid var(--glass-border);background:var(--glass-bg);backdrop-filter:saturate(1.5) blur(8px);-webkit-backdrop-filter:saturate(1.5) blur(8px)}#page-about .about-content{background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);border-radius:14px;padding:14px 16px;box-shadow:var(--shadow)}header{flex-wrap:nowrap}header h1{white-space:normal;min-width:0;overflow-wrap:anywhere}.search-row{flex-wrap:nowrap}.search-row .searchbar{flex:1 1 auto;min-width:0}.search-row .searchbar input{min-width:0}.search-row #clearBtn{flex:0 0 auto;white-space:nowrap}.drag-ghost{opacity:.6;transform:scale(.98)}.drag-chosen{outline:2px dashed var(--accent)}.dragging{cursor:grabbing}body.sorting #favGrid .card{cursor:grab}</style></head><body><div class="wrap"><header><h1>阿萬與動物朋友按鈕₂₀₀₀</h1><button id="navToggle" class="nav-toggle" aria-label="打開選單" aria-expanded="false" aria-controls="primaryNav" title="選單"><svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6h18M3 12h18M3 18h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button><nav id="primaryNav" class="tabs" aria-label="主選單"><button class="tab active" data-page="home">主頁</button> <button class="tab" data-page="game">小遊戲</button> <button class="tab" data-page="about">關於</button> <button class="tab" data-page="awards">票選結果</button> <button id="settingsBtn" class="tab" aria-label="設定">設定</button></nav></header><div id="page-home"><div class="search-row"><div class="searchbar" role="search"><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"/></svg> <input id="q" placeholder="搜尋標題或 #標籤（可多個，用空白分隔）" autocomplete="off"><div id="activeChips" class="chips"></div></div><button id="clearBtn" class="btn" aria-label="清除搜尋">清除</button></div><div id="tagList" class="tag-list"></div><div class="section-header"><h3>最愛音效</h3><div class="actions"><button id="sortFavBtn" class="btn small-btn">手動排列</button> <button id="doneSortBtn" class="btn small-btn glow-persistent hidden">儲存排列</button> <button id="shareFavBtn" class="btn small-btn">分享</button></div></div><div id="favGrid" class="grid"></div><div id="favEmpty" class="empty hidden">還沒有最愛。點音效右上的 ❤️ 加入最愛。</div><div id="receivedSection" class="hidden"><div id="receivedHeader" class="section-header"><h3>收到的列表</h3></div><div id="receivedGrid" class="grid"></div></div><div class="section-header"><h3>全部音效</h3><div class="actions"><button id="openMixBtn" class="btn small-btn">音軌</button> <button id="shuffleBtn" class="btn small-btn">洗牌</button> <button id="resetOrderBtn" class="btn small-btn">預設順序</button></div></div><p class="desc">提示：點音效即可播放；右鍵（或行動裝置長按）可分享/下載。</p><div id="grid" class="grid"></div><div id="empty" class="empty hidden">沒有符合搜尋的音效。</div></div><div id="page-game" class="hidden"><div id="concentration-game"><div class="cg-header"><div class="cg-stats"><span id="cg-timer">00:00</span> <span id="cg-accuracy">準確率：--%</span></div><div class="cg-controls"><button id="cg-restart" class="btn small-btn">重開一局</button></div></div><div id="cg-board" class="cg-board"></div><div id="cg-result" class="cg-result hidden"></div><div id="cg-rules" class="cg-rules" aria-labelledby="cg-rules-title"><h4 id="cg-rules-title">記憶小遊戲規則</h4><ul><li>第一次翻開的牌不對計分造成影響，屬於記憶提示。</li><li>每翻開兩張卡，若為相同主播的相同音效即為配對，共有 8 對配對。</li><li>（不會出現帶有「髒話」或「SUS」標籤的語音，但是會有尖叫，請小心耳膜。）</li></ul></div></div><style>.cg-board{display:grid;grid-template-columns:repeat(4,70px);grid-template-rows:repeat(4,70px);gap:8px;justify-content:center;margin:12px auto;width:min(720px,96%);padding:12px;border-radius:12px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);box-shadow:var(--shadow);justify-items:center}.cg-card{width:70px;height:70px;background:#888;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;perspective:600px;will-change:transform;transition:transform 140ms ease,box-shadow 140ms ease;user-select:none}.cg-card.matched{opacity:.5;pointer-events:none}.cg-card-inner{width:100%;height:100%;transition:transform .4s cubic-bezier(.4, 2, .6, 1);transform-style:preserve-3d;position:relative}.cg-card.flipped .cg-card-inner{transform:rotateY(180deg)}.cg-card-back,.cg-card-front{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:10px;display:flex;align-items:center;justify-content:center}.cg-card-front{background:#888}.cg-card.clicked,.cg-card:active{transform:scale(1.06);box-shadow:0 10px 28px rgba(0,0,0,.28)}.cg-card-back{background:#fff;transform:rotateY(180deg);overflow:hidden}.cg-card-back img{width:80%;height:80%;object-fit:contain;border-radius:8px}.cg-lock{position:absolute;right:6px;top:6px;background:rgba(0,0,0,.4);color:#fff;width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:50%;font-weight:700;font-size:14px}.cg-header{display:flex;gap:6px;align-items:center;justify-content:space-between;margin:4px auto;padding:8px 12px;width:min(720px,96%);border-radius:12px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);box-shadow:var(--shadow);position:sticky;top:12px;z-index:60;flex-wrap:wrap}#cg-timer{font-size:1rem;font-weight:700;color:var(--fg);letter-spacing:.6px;min-width:25px;text-align:left}#cg-timer.cg-running{color:#34d399}#cg-accuracy{color:var(--muted);font-weight:600;margin-left:8px}.cg-stats{display:flex;align-items:center;gap:8px;flex:1 1 auto;min-width:0}.cg-controls{display:flex;align-items:center;gap:8px;flex:0 0 auto}.cg-header button{margin-left:8px;flex:0 0 auto}@media (max-width:420px){.cg-header{gap:8px;padding:8px}#cg-timer{font-size:1rem}.cg-board{grid-template-columns:repeat(4,56px);grid-template-rows:repeat(4,56px);gap:4px;padding:10px}.cg-card{width:56px;height:56px}}.cg-result{text-align:center;font-size:1.05rem;margin-top:18px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);border-radius:14px;padding:14px 16px;box-shadow:var(--shadow);max-width:480px;margin:18px auto 0}.cg-result h3{margin:0 0 6px;font-size:1.15rem}.cg-result .stats{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;color:var(--muted);font-weight:600}.cg-result .big-num{font-size:1.25rem;font-weight:700;color:var(--fg)}.cg-rules{width:min(720px,96%);margin:14px auto 28px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);border-radius:12px;padding:12px 16px;box-shadow:var(--shadow);color:var(--fg)}.cg-rules h4{margin:0 0 8px;font-size:1.05rem}.cg-rules ul{margin:0;padding-left:18px;color:var(--muted)}</style></div><div id="page-about" class="hidden"><div class="about-content"><p>本站由粉肝製作，並非由厭世醫師阿萬官方經營。音效內容皆是粉肝去脈絡式、斷章取義的剪輯，僅供娛樂。最後更新時間：2025/10/27。</p><p>阿萬本家→ <a href="https://x.com/drlifesucks" target="_blank">厭世醫師阿萬X</a>、<a href="https://www.youtube.com/@Dr.lifesucks" target="_blank">厭世醫師阿萬Youtube</a></p><p><a href="https://discord.gg/e6ch4VbRB4" target="_blank">音效板問題回報與建議區</a></p><img src="assets/art-by-sigh.png" alt="" style="margin:0 auto;max-width:100%;max-height:250px;display:block;object-fit:cover"><p style="text-align:right">插畫：<a href="https://x.com/sigh121212" target="_blank">Minie(Sigh)</a></p><h2>大德芳名錄</h2><p>感謝53、Kie在DC弄了一堆音效，讓南想到可以做這個網站，並在提出這個想法的一開始就弄了一堆音效過來。還有同樣感謝在原型階段就幫忙收集音效的米糕跟薰薰草。<br>感謝Jia繪製超可愛的背景圖跟收集了很多音效。<br><br>感謝粉肝們收集很多音效，豐富了這個網站（Word筆劃順）：<br>AmBinBong、CZ、HUI、Lococco de suzuran、Nokimi07、Sigh、TENN、Yichen沉沉、🌙🐰月桂葉香包♏🎵、布丁(25:00)、幸福柴柴、青末枝、凌伊LingYi（01）、夏白衫、澐▽米粉 肉干、貓貓雨。 以及其他回報問題、提出建議的粉肝們，你們讓這個網站的功能更完善。</p></div><div class="bg-credit"><a href="https://x.com/jiauwu_0730" target="_blank" rel="noopener">背景插畫由 Jia 繪製</a></div></div><div id="page-awards" class="hidden"><style>#page-awards .awards-grid{display:grid;gap:4px;grid-template-columns:repeat(4,minmax(120px,240px));align-items:center;justify-items:center;justify-content:center}@media (max-width:700px){#page-awards .awards-grid{grid-template-columns:repeat(2,minmax(120px,240px));justify-content:center}}#page-awards .awards-grid img{width:100%;height:auto;display:block;max-width:100%;object-fit:cover}#page-awards .grid .title{text-align:left}</style><div style="max-width:1100px;margin:0 auto;padding:18px"><h2 style="text-align:center">第一屆音效板爭霸戰</h2><div style="text-align:center;margin:12px 0"><div class="awards-grid"><img src="assets/award1-1.jpg" alt="第一屆貓下去"> <img src="assets/award1-2.jpg" alt="第一屆Matsuko"> <img src="assets/award1-3.jpg" alt="第一屆豹子頭"> <img src="assets/award1-4.jpg" alt="第一屆瓦哈"></div><h3>獲獎區（前十名）</h3><div id="awards-top10" class="grid"></div><h3 style="margin-top:18px">入圍獎（後20名）</h3><div id="awards-next20" class="grid"></div></div></div></div><div id="settingsModal" class="mix-modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="settingsTitle"><div class="mix-modal"><h3 id="settingsTitle" style="margin-top:0;margin-bottom:12px">設定</h3><div style="display:flex;flex-direction:column;gap:8px"><button id="themeBtn" class="mix-btn" type="button">電燈開關</button> <label for="settingsVolume">播放音量： <span id="settingsVolumeValue">100%</span></label> <input id="settingsVolume" type="range" min="0" max="100" step="1" value="100"><div style="display:flex;justify-content:flex-end;margin-top:6px;gap:8px"><button id="settingsClose" class="mix-btn" type="button">關閉</button></div></div></div></div><div id="mixPanel" class="mix-panel hidden" aria-hidden="true" role="region" aria-label="混音軌道控制"><div class="mix-header"><div class="mix-bar-row"><div class="mix-bar"><span class="mix-muted">縮放</span> <input id="mixZoomRange" type="range" min="5" max="150" step="5" value="50" aria-label="混音軌道縮放"></div><div class="mix-bar"><span class="mix-muted">位置</span> <input id="mixScrollRange" type="range" min="0" max="100" step="1" value="0" aria-label="混音軌道檢視位置"></div></div><div id="mixScrollHost" class="mix-scroll-host" aria-hidden="false"><div id="mixScrollContent" class="mix-scroll-content"><div id="mixTrackLanes" class="mix-track-lanes"><div class="mix-track" data-track="0" data-label="1"></div><div class="mix-track" data-track="1" data-label="2"></div><div class="mix-track" data-track="2" data-label="3"></div></div><div id="mixPlayhead" class="mix-playhead" style="left:0"></div></div></div></div><div class="mix-controls"><div class="mix-controls-left"><button id="mixClearBtn" class="mix-btn" type="button">清除</button></div><div class="mix-controls-center"><button id="mixUndoBtn" class="mix-btn" type="button" aria-label="上一步">↺</button> <button id="mixRedoBtn" class="mix-btn" type="button" aria-label="下一步">↻</button> <button id="mixToStartBtn" class="mix-btn" type="button" aria-label="移到開頭">⏮</button> <button id="mixPlayPauseBtn" class="mix-btn" type="button" aria-label="播放或暫停">▶</button> <button id="mixToEndBtn" class="mix-btn" type="button" aria-label="移到結尾">⏭</button></div><div class="mix-controls-right"><button id="mixCloseBtn" class="mix-btn" type="button">關閉</button></div></div></div><div id="mixConfirmModal" class="mix-modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="mixConfirmTitle"><div class="mix-modal"><h3 id="mixConfirmTitle">要清除所有音軌嗎？</h3><div class="mix-modal-actions"><button id="mixConfirmCancel" class="mix-btn" type="button">取消</button> <button id="mixConfirmAccept" class="mix-btn" type="button">清除</button></div></div></div><div id="stage" class="stage" aria-hidden="true"></div><div id="menu" class="menu hidden" role="menu" aria-label="音效選單"></div><div id="toast" class="toast hidden" role="status" aria-live="polite"></div><script src="scripts/Tone.js"></script><script src="scripts/Sortable.min.js"></script><script>!function(){function t(t){return t+(t.includes("?")?"&":"?")+"v="+encodeURIComponent("ver2025-10-27-1")}function e(t,e=Math.random){for(let n=t.length-1;n>0;n--){const a=Math.floor(e()*(n+1));[t[n],t[a]]=[t[a],t[n]]}return t}const n={q:document.getElementById("q"),activeChips:document.getElementById("activeChips"),grid:document.getElementById("grid"),favGrid:document.getElementById("favGrid"),empty:document.getElementById("empty"),favEmpty:document.getElementById("favEmpty"),settingsBtn:document.getElementById("settingsBtn"),themeBtn:document.getElementById("themeBtn"),stage:document.getElementById("stage"),clearBtn:document.getElementById("clearBtn"),get menu(){return document.getElementById("menu")},get toast(){return document.getElementById("toast")},mixPanel:document.getElementById("mixPanel"),mixScrollHost:document.getElementById("mixScrollHost"),mixScrollContent:document.getElementById("mixScrollContent"),mixTrackLanes:document.getElementById("mixTrackLanes"),mixPlayhead:document.getElementById("mixPlayhead"),mixScrollRange:document.getElementById("mixScrollRange"),mixZoomRange:document.getElementById("mixZoomRange"),mixClearBtn:document.getElementById("mixClearBtn"),mixUndoBtn:document.getElementById("mixUndoBtn"),mixRedoBtn:document.getElementById("mixRedoBtn"),mixToStartBtn:document.getElementById("mixToStartBtn"),mixPlayPauseBtn:document.getElementById("mixPlayPauseBtn"),mixToEndBtn:document.getElementById("mixToEndBtn"),mixCloseBtn:document.getElementById("mixCloseBtn"),mixConfirmModal:document.getElementById("mixConfirmModal"),mixConfirmCancel:document.getElementById("mixConfirmCancel"),mixConfirmAccept:document.getElementById("mixConfirmAccept"),openMixBtn:document.getElementById("openMixBtn"),pageHome:document.getElementById("page-home"),pageGame:document.getElementById("page-game"),pageAbout:document.getElementById("page-about"),pageawards:document.getElementById("page-awards"),pageBg:document.getElementById("page-bg"),settingsModal:document.getElementById("settingsModal"),settingsClose:document.getElementById("settingsClose"),settingsVolume:document.getElementById("settingsVolume"),settingsVolumeValue:document.getElementById("settingsVolumeValue"),navToggle:document.getElementById("navToggle"),get navTabs(){return document.querySelectorAll(".tab")},tagList:document.getElementById("tagList"),receivedSection:document.getElementById("receivedSection"),receivedGrid:document.getElementById("receivedGrid"),receivedHeader:document.getElementById("receivedHeader"),awardsTop10:document.getElementById("awards-top10"),awardsNext20:document.getElementById("awards-next20"),sortFavBtn:document.getElementById("sortFavBtn"),doneSortBtn:document.getElementById("doneSortBtn"),shareFavBtn:document.getElementById("shareFavBtn"),shuffleBtn:document.getElementById("shuffleBtn"),resetOrderBtn:document.getElementById("resetOrderBtn")},a={tags:{},tagList:[],sounds:[],favorites:JSON.parse(localStorage.getItem("favorites")||"[]"),favSet:new Set,queryText:"",queryTags:new Set,soundMap:new Map,contextTimer:null,page:"home",receivedList:[],toastTimer:null,usedTagList:[],isSorting:!1,sortable:null,highlightedCardId:"",cgRunning:!1,defaultSoundsSnapshot:[]};function i(t){try{t&&"number"==typeof t.volume&&(t.volume=a.globalVolume)}catch(t){}}function o(t,e={}){try{const{snd:n=null,onPlay:a=null,onEnded:o=null,preload:r="auto",loop:s=!1,autoplay:l=!0}=e,c=new Audio(t);if(r&&(c.preload=r),c.loop=!!s,a&&"function"==typeof a&&c.addEventListener("play",()=>a(n,c)),o&&"function"==typeof o&&c.addEventListener("ended",()=>o(n,c)),i(c),l)try{c.play().catch(()=>{})}catch(t){}return c}catch(t){return console.warn("[createPlayer] failed",t),null}}function r(t){return t&&t.src?o(t.src,{snd:t,onPlay:Pt,onEnded:Rt,preload:"auto"}):null}a.favSet=new Set(a.favorites),a.globalVolume=function(){try{const t=localStorage.getItem("globalVolume");if(null!==t){const e=Number(t);if(!isNaN(e)&&e>=0&&e<=1)return e}}catch(t){}return 1}();let s=null;const l={el(t,e={},n=[]){const a=document.createElement(t);return Object.entries(e).forEach(([t,e])=>{"class"===t?a.className=e:"style"===t?Object.assign(a.style,e):t.startsWith("on")&&"function"==typeof e?a.addEventListener(t.substring(2),e):null!=e&&a.setAttribute(t,e)}),(Array.isArray(n)?n:[n]).filter(Boolean).forEach(t=>{"string"==typeof t?a.appendChild(document.createTextNode(t)):a.appendChild(t)}),a},svgHeart(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox","0 0 24 24"),t.innerHTML='<path d="M12 21s-6.716-4.438-9.428-7.15C.59 11.868.59 8.608 2.57 6.627 4.55 4.647 7.81 4.647 9.79 6.627L12 8.838l2.21-2.21c1.98-1.98 5.24-1.98 7.22 0 1.98 1.98 1.98 5.24 0 7.223C18.716 16.562 12 21 12 21z" fill="none" stroke="currentColor" stroke-width="1.5"/>',t}},c={slug:t=>t.normalize("NFKC").trim(),byId:t=>document.getElementById(t),saveFav(){localStorage.setItem("favorites",JSON.stringify(a.favorites))},inFav:t=>a.favSet.has(t),download(t,e){const n=document.createElement("a");n.href=t,n.download=e||"",document.body.appendChild(n),n.click(),n.remove()},parseQuery(){const t=a.queryText.trim(),e=t.length?t.split(/\s+/):[],n=new Set([...a.queryTags]),i=[];for(const t of e)t.startsWith("#")?n.add(c.slug(t.slice(1))):i.push(c.slug(t));return{terms:i,tags:n}},match(t,e,n){for(const e of n)if(!t.tags.some(t=>c.slug(t)===e))return!1;for(const n of e){const e=t.title.toLowerCase().includes(n.toLowerCase()),a=t.tags.some(t=>t.toLowerCase().includes(n.toLowerCase()));if(!e&&!a)return!1}return!0},debounce(t,e=200){let n=null;return(...a)=>{n&&clearTimeout(n),n=setTimeout(()=>{n=null;try{t(...a)}catch(t){console.error(t)}},e)}}},d="mix_tracks_v1",u={tracks:Array.from({length:3},()=>[]),playhead:0,pxPerSecond:30,contentDuration:0,timelineDuration:30,durationCache:new Map,durationRequests:new Map,history:[],future:[],isOpen:!1,isPlaying:!1,scrollRatio:0,initialized:!1},m={players:new Map,loading:new Map,rafId:0,startTime:0,startPlayhead:0,scheduleIds:[],masterGain:null,toneStarted:!1};let g=null,f=null,p=!1,h=null;function v(){return Array.from({length:3},()=>[])}function y(t){if(!t||"object"!=typeof t)return null;return function(t){if(!t||"object"!=typeof t)return null;const e="string"==typeof t.soundId?t.soundId:"";if(!e)return null;const n=Number(t.start),a=Number(t.duration),i=Number(t.track);return!Number.isFinite(n)||n<0||!Number.isFinite(a)||a<=0||!Number.isInteger(i)||i<0||i>=3?null:{id:"string"==typeof t.id&&t.id?t.id:L(),soundId:e,start:x(n),duration:x(a),track:i}}({id:t.id,soundId:t.sid??t.soundId,start:t.st??t.start,duration:t.du??t.duration,track:t.tr??t.track})}function x(t){return Number.isFinite(t)?Number(t.toFixed(3)):0}function L(){return"cp-"+Math.random().toString(36).slice(3,6)+Date.now().toString(36).slice(-2)}function E(){let t=0;return u.tracks.forEach(e=>e.forEach(e=>{const n=e.start+e.duration;n>t&&(t=n)})),u.contentDuration=t,u.timelineDuration=Math.max(30,Math.ceil(t)),u.playhead>u.timelineDuration&&(u.playhead=u.timelineDuration),u.timelineDuration}function S(){return u.timelineDuration*u.pxPerSecond}function b(t,e){let n=!1;const a=x(e);u.tracks.forEach(e=>{e.forEach(e=>{e.soundId===t&&Math.abs(e.duration-a)>1e-4&&(e.duration=a,n=!0)})}),n&&(E(),P(),H())}function B(t,e){if(!t)return;const n=u.durationCache.get(t.id);if("number"==typeof n&&n>0)return;if(u.durationRequests.has(t.id))return;const a=new Audio;a.preload="metadata",a.src=t.src,i(a);const o=new Promise(n=>{const i=()=>{a.removeEventListener("loadedmetadata",o),a.removeEventListener("error",r),a.src=""},o=()=>{const o=Number(a.duration);if(i(),isFinite(o)&&o>0){const n=x(o);u.durationCache.set(t.id,n),b(t.id,n),e&&(e.duration=n)}n()},r=()=>{i(),n()};a.addEventListener("loadedmetadata",o,{once:!0}),a.addEventListener("error",r,{once:!0});try{a.load()}catch(t){i(),n()}});u.durationRequests.set(t.id,o),o.finally(()=>u.durationRequests.delete(t.id))}function w(t){const e=a.soundMap.get(t.soundId),n=e?.title||t.soundId,i=Math.max(t.duration*u.pxPerSecond,36),o=t.start*u.pxPerSecond,r=function(t){if(!t||!Array.isArray(t.tags))return"#64748b";for(const e of t.tags){const t=a.tags[c.slug(e)];if(t&&t.color)return t.color}return"#64748b"}(e),s=l.el("button",{class:"mix-clip-remove",type:"button","data-clip-id":t.id,"aria-label":"移除音效"},"×");s.addEventListener("click",e=>{e.stopPropagation(),function(t,{silent:e=!1,recordHistory:n=!0}={}){if(!t)return null;if(u.isPlaying)return null;const a=O(t);if(!a)return null;n&&q();const i=u.tracks[a.trackIndex],[o]=i.splice(a.index,1);E(),H(),P(),e||Mt("已移除音效")}(t.id)});const d=l.el("span",{class:"mix-clip-title"},n),m=l.el("div",{class:"mix-clip","data-clip-id":t.id,style:{left:`${o}px`,width:`${i}px`,background:r},title:n},[d,s]);return m.dataset.start=String(t.start),m.dataset.duration=String(t.duration),m.dataset.track=String(t.track),m}function M(){const t=n.mixTrackLanes;if(!t)return;const e=S();t.querySelectorAll(".mix-track").forEach(t=>{t.style.width=e+"px",t.innerHTML=""}),u.tracks.forEach((e,n)=>{const i=t.querySelector(`.mix-track[data-track="${n}"]`);i&&(e.sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id)),e.forEach(t=>{!function(t){const e=a.soundMap.get(t.soundId);e&&(u.durationCache.has(e.id)||B(e,t))}(t);const e=w(t);i.appendChild(e)}))})}function T(){const t=n.mixPlayhead;if(!t)return;const e=u.playhead*u.pxPerSecond;t.style.left=`${e}px`}function I(){const t=n.mixScrollHost,e=n.mixScrollRange;if(!t||!e)return;const a=Math.max(0,t.scrollWidth-t.clientWidth);if(a<=1)return e.value="0",e.disabled=!0,void(u.scrollRatio=0);e.disabled=!1;const i=t.scrollLeft/a;u.scrollRatio=isFinite(i)?i:0,e.value=String(Math.round(100*u.scrollRatio))}function k(t){const e=n.mixScrollHost;if(!e)return;if(u.timelineDuration<=0)return;const a=t.deltaY||0,i=t.deltaX||0,o=Math.abs(a)>=Math.abs(i)?a:i;if(0===o)return;t.preventDefault();const r=o>0?-5:5;if(0===r)return;const s=e.getBoundingClientRect(),l=t.clientX-s.left,c=u.pxPerSecond;N(u.pxPerSecond+r,{persist:!1,anchorPixel:l}),c!==u.pxPerSecond&&(h&&clearTimeout(h),h=setTimeout(()=>{H(),h=null},240))}function C(){const t=n.mixScrollHost,e=n.mixScrollRange;if(!t||!e)return;const a=Math.max(0,t.scrollWidth-t.clientWidth),i=Number(e.value)/100;t.scrollLeft=a*i,u.scrollRatio=isFinite(i)?i:0,I()}function P(){if(!n.mixPanel)return;E();const t=S();if(n.mixScrollContent&&(n.mixScrollContent.style.width=`${t}px`),n.mixZoomRange){const t=String(Math.round(u.pxPerSecond));n.mixZoomRange.value!==t&&(n.mixZoomRange.value=t)}M();const e=n.mixScrollHost;if(e){const t=Math.max(0,e.scrollWidth-e.clientWidth);e.scrollLeft=t*u.scrollRatio}T(),I(),G()}function R(){const t=n.mixScrollHost;if(!t)return;const e=u.playhead*u.pxPerSecond;e<t.scrollLeft+40?t.scrollLeft=Math.max(0,e-40):e>t.scrollLeft+t.clientWidth-40&&(t.scrollLeft=Math.max(0,e-t.clientWidth+40)),I()}function A(t){const e=n.mixScrollHost;if(!e)return;const a=t.start*u.pxPerSecond,i=(t.start+t.duration)*u.pxPerSecond;a<e.scrollLeft+40?e.scrollLeft=Math.max(0,a-40):i>e.scrollLeft+e.clientWidth-40&&(e.scrollLeft=Math.max(0,i-e.clientWidth+40)),I()}function N(t,{persist:e=!0,maintainCenter:a=!1,anchorPixel:i=null}={}){const o=n.mixScrollHost,r=u.pxPerSecond,s=Math.min(120,Math.max(20,Number(t)||30));let l=u.scrollRatio;if(null!=i&&o){const t=Math.max(0,Math.min(i,o.clientWidth)),e=u.timelineDuration*r,n=o.scrollLeft+t,a=e>0?n/e:0,c=u.timelineDuration*s,d=c*a,m=Math.max(0,d-t),g=Math.max(0,c-o.clientWidth);l=g>0?m/g:0}else if(a&&o){const t=u.timelineDuration*r,e=o.scrollLeft+o.clientWidth/2,n=t>0?e/t:0,a=u.timelineDuration*s,i=a*n,c=Math.max(0,i-o.clientWidth/2),d=Math.max(0,a-o.clientWidth);l=d>0?c/d:0}if(Math.abs(s-u.pxPerSecond)<1e-4)e&&H();else{if(u.pxPerSecond=s,u.scrollRatio=Math.min(1,Math.max(0,l)),P(),o&&(a||null!=i)){const t=Math.max(0,o.scrollWidth-o.clientWidth);o.scrollLeft=t*u.scrollRatio,I()}if(n.mixZoomRange){const t=String(Math.round(u.pxPerSecond));n.mixZoomRange.value!==t&&(n.mixZoomRange.value=t)}e&&H()}}function H(){try{const t={plh:x(u.playhead),pps:u.pxPerSecond,trs:u.tracks.map(t=>t.map(t=>({id:t.id,sid:t.soundId,st:x(t.start),du:x(t.duration),tr:t.track})))};localStorage.setItem(d,JSON.stringify(t))}catch(t){console.warn("[mix] save failed",t)}}function F(){return u.tracks.some(t=>t.length>0)}function $(){return{playhead:u.playhead,tracks:u.tracks.map(t=>t.map(t=>({...t,start:x(t.start),duration:x(t.duration)})))}}function q(){u.history.push($()),u.history.length>10&&u.history.shift(),u.future=[]}function D(t){u.tracks=t.tracks.map(t=>t.map(t=>({...t}))),u.playhead=t.playhead,E(),P(),H()}function W(){if(u.isPlaying||0===u.history.length)return;const t=u.history.pop();t&&(u.future.push($()),u.future.length>10&&u.future.shift(),D(t))}function V(){if(u.isPlaying||0===u.future.length)return;const t=u.future.pop();t&&(u.history.push($()),u.history.length>10&&u.history.shift(),D(t))}function G(){const t=u.isPlaying,e=F();n.mixUndoBtn&&(n.mixUndoBtn.disabled=t||0===u.history.length),n.mixRedoBtn&&(n.mixRedoBtn.disabled=t||0===u.future.length),n.mixPlayPauseBtn&&(n.mixPlayPauseBtn.disabled=!e,n.mixPlayPauseBtn&&(n.mixPlayPauseBtn.textContent=u.isPlaying?"⏸":"▶",n.mixPlayPauseBtn.setAttribute("aria-label",u.isPlaying?"暫停混音":"播放混音"))),n.mixClearBtn&&(n.mixClearBtn.disabled=t||!e),n.mixToStartBtn&&(n.mixToStartBtn.disabled=!e),n.mixToEndBtn&&(n.mixToEndBtn.disabled=!e)}function O(t){for(let e=0;e<3;e++){const n=u.tracks[e],a=n.findIndex(e=>e.id===t);if(-1!==a)return{clip:n[a],trackIndex:e,index:a}}return null}function j(t,{scroll:e=!0,persist:n=!0}={}){const a=x(Math.max(0,Math.min(t,u.timelineDuration)));u.playhead=a,T(),e&&R(),n&&!u.isPlaying&&H()}function Z(){let t=1/0;u.tracks.forEach(e=>e.forEach(e=>{e.start<t&&(t=e.start)})),isFinite(t)||(t=0);const e=u.isPlaying;if(e&&ft(!1),j(t,{scroll:!0,persist:!e}),e){lt().length?gt():G()}}function _(){const t=Math.max(u.contentDuration,0),e=u.isPlaying;if(e&&ft(!1),j(t,{scroll:!0,persist:!e}),e){lt().length?gt():G()}}function X(t,e){for(let n=0;n<3;n++){if(!u.tracks[n].some(n=>!(t+e<=n.start||t>=n.start+n.duration)))return n}return 0}function U(t){if(p)return void(p=!1);if(t.target.closest(".mix-clip"))return;const e=n.mixScrollHost;if(!e)return;const a=e.getBoundingClientRect(),i=(t.clientX-a.left+e.scrollLeft)/u.pxPerSecond,o=u.isPlaying;if(o&&ft(!1),j(i,{scroll:!0,persist:!o}),o){lt().length?gt():G()}}function z(){if(n.mixConfirmModal&&(n.mixConfirmModal.classList.remove("hidden"),n.mixConfirmModal.setAttribute("aria-hidden","false"),n.mixConfirmAccept))try{n.mixConfirmAccept.focus()}catch(t){}}function J(){if(n.mixConfirmModal&&(n.mixConfirmModal.classList.add("hidden"),n.mixConfirmModal.setAttribute("aria-hidden","true"),n.mixClearBtn))try{n.mixClearBtn.focus()}catch(t){}}function Y(t){"Escape"===t.key&&n.mixConfirmModal&&!n.mixConfirmModal.classList.contains("hidden")&&J()}function K(t){const e=t.target.closest(".mix-clip");if(!e)return void function(t){const e=n.mixScrollHost,a=n.mixTrackLanes;if(!e||!a)return;if(void 0!==t.button&&0!==t.button)return;p=!1,f={pointerId:t.pointerId,startX:t.clientX,startScroll:e.scrollLeft,lanes:a};try{a.setPointerCapture(t.pointerId)}catch(t){}a.addEventListener("pointermove",et),a.addEventListener("pointerup",nt),a.addEventListener("pointercancel",at)}(t);if(void 0!==t.button&&0!==t.button)return;if(t.target.closest(".mix-clip-remove"))return;if(u.isPlaying)return;const a=O(e.dataset.clipId||"");if(!a)return;const i=n.mixScrollHost,o=n.mixTrackLanes;if(!i||!o)return;const r=e.getBoundingClientRect(),s=i.getBoundingClientRect(),l=o.getBoundingClientRect(),c=t.clientX-r.left,d=t.clientY-r.top,m=document.createElement("div");m.className="mix-clip-placeholder",m.style.width=r.width+"px",m.style.height=r.height+"px";const h=e.parentElement;if(h){const t=parseFloat(e.style.left||"0"),n=a.clip.start*u.pxPerSecond,i=Number.isFinite(t)?t:n;m.style.left=i+"px",h.insertBefore(m,e)}o.appendChild(e);const v=r.width,y=r.height;e.classList.add("dragging"),e.style.position="absolute",e.style.zIndex="10",e.style.width=v+"px",e.style.left=`${t.clientX-l.left-c+i.scrollLeft}px`,e.style.top=r.top-l.top+"px",g={clip:a.clip,clipEl:e,placeholder:m,pointerId:t.pointerId,pointerOffsetX:c,pointerOffsetY:d,clipWidth:v,clipHeight:y,hostRect:s,lanesRect:l,originTrack:a.trackIndex,originStart:a.clip.start,trackHeight:o.querySelector(".mix-track")?.offsetHeight||36,historyCaptured:!1,currentTrack:a.trackIndex,currentStart:a.clip.start};try{e.setPointerCapture(t.pointerId)}catch(t){}e.addEventListener("pointermove",Q),e.addEventListener("pointerup",rt),e.addEventListener("pointercancel",st),t.preventDefault()}function Q(t){if(!g||t.pointerId!==g.pointerId)return;const e=n.mixScrollHost;if(!e)return;if(!n.mixTrackLanes)return;const a=t.clientX-g.hostRect.left+e.scrollLeft-g.pointerOffsetX,i=Math.max(0,S()-g.clipWidth),o=Math.min(Math.max(0,a),i);g.clipEl.style.left=`${o}px`;const r=o/u.pxPerSecond,s=t.clientY-g.lanesRect.top-g.pointerOffsetY+g.clipHeight/2,l=g.trackHeight,c=Math.min(2,Math.max(0,Math.floor(s/l))),d=c*l+Math.max(0,(l-g.clipHeight)/2);g.clipEl.style.top=`${d}px`,g.currentTrack=c,g.currentStart=x(Math.max(0,r)),g.historyCaptured||(Math.abs(r-g.originStart)>5e-4||c!==g.originTrack)&&(q(),g.historyCaptured=!0);const m=Math.max(0,e.scrollWidth-e.clientWidth);t.clientX>g.hostRect.right-40?e.scrollLeft=Math.min(e.scrollLeft+14,m):t.clientX<g.hostRect.left+40&&(e.scrollLeft=Math.max(e.scrollLeft-14,0)),I()}function tt(){if(!g)return;const{clipEl:t,placeholder:e}=g;e&&e.parentNode&&e.parentNode.removeChild(e),t&&(t.classList.remove("dragging"),t.style.position="",t.style.zIndex="",t.style.width="",t.style.left="",t.style.top="")}function et(t){if(!f||t.pointerId!==f.pointerId)return;const e=n.mixScrollHost;if(!e)return;const a=t.clientX-f.startX;Math.abs(a)>2&&(p=!0);const i=Math.max(0,e.scrollWidth-e.clientWidth),o=Math.min(Math.max(f.startScroll-a,0),i);e.scrollLeft=o,I(),t.preventDefault()}function nt(t){it(t,!1)}function at(t){it(t,!0)}function it(t,e){if(!f||t.pointerId!==f.pointerId)return;const{lanes:n}=f;try{n.releasePointerCapture(t.pointerId)}catch(t){}n.removeEventListener("pointermove",et),n.removeEventListener("pointerup",nt),n.removeEventListener("pointercancel",at),f=null,e&&(p=!1)}function ot(t,e){if(!g||t.pointerId!==g.pointerId)return;const{clip:n,clipEl:a,placeholder:i,originTrack:o,originStart:r,currentTrack:s,currentStart:l,historyCaptured:c}=g;try{a.releasePointerCapture(t.pointerId)}catch(t){}a.removeEventListener("pointermove",Q),a.removeEventListener("pointerup",rt),a.removeEventListener("pointercancel",st);const d=Math.abs(l-r)>5e-4||s!==o;if(!c||!d||e)return c&&u.history.length>0&&u.history.pop(),tt(),a&&a.parentNode&&a.parentNode.removeChild(a),P(),void(g=null);const m=u.tracks[o];if(s!==o){const t=m.indexOf(n);-1!==t&&m.splice(t,1),u.tracks[s].push(n),n.track=s}n.start=x(Math.max(0,l)),u.tracks[s].sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id)),s!==o&&m.sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id)),tt(),a&&a.parentNode&&a.parentNode.removeChild(a),E(),H(),P(),A(n),g=null}function rt(t){ot(t,!1)}function st(t){ot(t,!0)}function lt(){const t=u.playhead,e=[];return u.tracks.forEach(n=>{n.forEach(n=>{n.start+n.duration>t&&e.push(n)})}),e.sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id)),e}function ct(){return"undefined"!=typeof window&&"undefined"!=typeof Tone&&Tone&&void 0!==Tone.Transport}function dt(t,e){return`${t}::${e}`}async function ut(t){const e=t.map(t=>{const e=a.soundMap.get(t.soundId);return e?async function(t,e){const n=dt(t.id,e);if(m.players.has(n))return m.players.get(n);if(m.loading.has(n))return m.loading.get(n);if(!ct())throw new Error("Tone.js unavailable");const a=new Promise((e,a)=>{let i;try{i=new Tone.Player({url:t.src,autostart:!1,onload:()=>{m.players.set(n,i);const a=i.buffer?.duration;if(isFinite(a)&&a>0){const e=x(a);u.durationCache.set(t.id,e),b(t.id,e)}e(i)},onerror:t=>{try{i.dispose()}catch(t){}a(t||new Error("load failed"))}});try{m.masterGain&&"function"==typeof m.masterGain.connect?i.connect(m.masterGain):i.toDestination()}catch(t){try{i.toDestination()}catch(t){}}}catch(t){if(i)try{i.dispose()}catch(t){}a(t)}});return m.loading.set(n,a),a.finally(()=>m.loading.delete(n))}(e,t.track):Promise.resolve()});await Promise.all(e)}function mt(){m.rafId&&(cancelAnimationFrame(m.rafId),m.rafId=0)}async function gt(){if(u.isPlaying)return;if(!F())return void Mt("沒有可播放的片段");if(!ct())return void Mt("Tone.js 載入失敗，無法播放");const t=lt();if(!t.length)return void Mt("播放位置之後沒有音效");try{await async function(){if(!ct())throw new Error("Tone.js unavailable");if(!m.toneStarted){await Tone.start();try{m.masterGain=new Tone.Gain(a.globalVolume||1).toDestination()}catch(t){m.masterGain=null}m.toneStarted=!0}}(),await ut(t)}catch(t){return console.error("[mix] player load error",t),void Mt("音訊載入失敗")}try{Tone.Transport.stop(),Tone.Transport.cancel(),m.scheduleIds.forEach(t=>Tone.Transport.clear(t)),m.scheduleIds=[]}catch(t){console.warn("[mix] transport reset failed",t)}t.forEach(t=>{const e=dt(t.soundId,t.track),n=m.players.get(e);if(!n)return;const a=Math.max(0,t.start-u.playhead),i=Math.max(0,u.playhead-t.start),o=t.duration-i;if(o<=0)return;const r=Tone.Transport.schedule(t=>{try{n.start(t,i,o)}catch(t){console.warn("[mix] player start failed",t)}},a);m.scheduleIds.push(r)});const e=Math.max(0,u.contentDuration-u.playhead);if(e>0){const t=Tone.Transport.schedule(()=>ft(!0),e+.05);m.scheduleIds.push(t)}m.startPlayhead=u.playhead,m.startTime=Tone.now(),u.isPlaying=!0,G();try{Tone.Transport.start("+0.02")}catch(t){return console.error("[mix] transport start error",t),u.isPlaying=!1,G(),void Mt("播放啟動失敗")}!function(){mt();const t=()=>{if(!u.isPlaying||!ct())return;const e=Tone.now()-m.startTime,n=m.startPlayhead+e;u.playhead=Math.min(n,u.timelineDuration),T(),R(),m.rafId=requestAnimationFrame(t)};m.rafId=requestAnimationFrame(t)}()}function ft(t=!1){if(!ct())return u.isPlaying=!1,void G();try{Tone.Transport.stop(),Tone.Transport.cancel(),m.scheduleIds.forEach(t=>Tone.Transport.clear(t)),m.scheduleIds=[]}catch(t){console.warn("[mix] transport stop error",t)}if(m.players.forEach(t=>{try{t.stop()}catch(t){}}),mt(),!u.isPlaying)return;const e=Tone.now()-m.startTime,n=m.startPlayhead+Math.max(0,e);u.isPlaying=!1,j(Math.min(n,u.contentDuration),{scroll:!0,persist:!0}),t&&Mt("播放結束"),G()}function pt(){u.isPlaying?ft(!1):gt()}function ht(t=!0){n.mixPanel&&(n.mixPanel.classList.remove("hidden"),n.mixPanel.setAttribute("aria-hidden","false"),u.isOpen=!0,P(),t&&R())}function vt(t,e={}){if(!t)return null;u.initialized||yt(),q();const n=x(Math.max(.5,Number(e.duration)||function(t){if(!t)return 2;const e=u.durationCache.get(t.id);return"number"==typeof e&&e>0?e:2}(t))),a=x(Math.max(0,Number.isFinite(e.start)?Number(e.start):u.playhead));let i=Number.isInteger(e.track)?Number(e.track):X(a,n);(i<0||i>=3)&&(i=X(a,n));const o={id:L(),soundId:t.id,start:a,duration:n,track:i};return u.tracks[i].push(o),u.tracks[i].sort((t,e)=>t.start-e.start),E(),H(),P(),ht(!1),A(o),B(t,o),o}function yt(){if(!u.initialized){if(u.initialized=!0,function(){try{const t=localStorage.getItem(d);if(!t)return u.tracks=v(),u.playhead=0,u.pxPerSecond=30,void E();const e=JSON.parse(t);if(!e||"object"!=typeof e)throw new Error("invalid mix payload");const n=v(),a=Array.isArray(e.trs)?e.trs:e.tracks;for(let t=0;t<3;t++){const e=Array.isArray(a?.[t])?a[t]:[];n[t]=e.map(y).filter(Boolean).sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id))}u.tracks=n;const i=e.plh??e.playhead;u.playhead=x(Math.max(0,Number(i)||0));const o=Number(e.pps??e.pxPerSecond);Number.isFinite(o)&&o>=20&&o<=120?u.pxPerSecond=o:u.pxPerSecond=30,E()}catch(t){console.warn("[mix] load failed，已還原為預設值。",t),localStorage.removeItem(d),u.tracks=v(),u.playhead=0,u.pxPerSecond=30,E()}u.history=[],u.future=[],u.scrollRatio=0}(),P(),n.mixScrollHost&&(n.mixScrollHost.addEventListener("scroll",I,{passive:!0}),n.mixScrollHost.addEventListener("wheel",k,{passive:!1})),n.mixScrollRange&&n.mixScrollRange.addEventListener("input",C),n.mixZoomRange&&!n.mixZoomRange.dataset.mixBound?(n.mixZoomRange.dataset.mixBound="1",n.mixZoomRange.setAttribute("min",String(20)),n.mixZoomRange.setAttribute("max",String(120)),n.mixZoomRange.setAttribute("step","5"),n.mixZoomRange.value=String(Math.round(u.pxPerSecond)),n.mixZoomRange.addEventListener("input",t=>{N(Number(t.target.value),{persist:!1,maintainCenter:!0})}),n.mixZoomRange.addEventListener("change",t=>{N(Number(t.target.value),{persist:!0,maintainCenter:!0})})):n.mixZoomRange&&(n.mixZoomRange.value=String(Math.round(u.pxPerSecond))),n.mixTrackLanes){n.mixTrackLanes.addEventListener("click",U),n.mixTrackLanes.addEventListener("pointerdown",K);try{n.mixTrackLanes.addEventListener("contextmenu",t=>{t.preventDefault()}),n.mixTrackLanes.addEventListener("selectstart",t=>{t.preventDefault()})}catch(t){}}n.mixPlayPauseBtn&&n.mixPlayPauseBtn.addEventListener("click",pt),n.mixToStartBtn&&n.mixToStartBtn.addEventListener("click",Z),n.mixToEndBtn&&n.mixToEndBtn.addEventListener("click",_),n.mixUndoBtn&&n.mixUndoBtn.addEventListener("click",W),n.mixRedoBtn&&n.mixRedoBtn.addEventListener("click",V),n.mixClearBtn&&n.mixClearBtn.addEventListener("click",z),n.mixCloseBtn&&n.mixCloseBtn.addEventListener("click",()=>{ft(!1),n.mixPanel&&(n.mixPanel.classList.add("hidden"),n.mixPanel.setAttribute("aria-hidden","true"),u.isOpen=!1)}),n.mixConfirmCancel&&n.mixConfirmCancel.addEventListener("click",J),n.mixConfirmAccept&&n.mixConfirmAccept.addEventListener("click",()=>{!function({silent:t=!1}={}){!u.isPlaying&&F()&&(q(),u.tracks=v(),u.playhead=0,E(),H(),P(),t||Mt("已清除所有音效"))}({silent:!1}),J()}),n.mixConfirmModal&&n.mixConfirmModal.addEventListener("click",t=>{t.target===n.mixConfirmModal&&J()}),document.addEventListener("keydown",Y),n.openMixBtn&&!n.openMixBtn.dataset.mixBound&&(n.openMixBtn.dataset.mixBound="1",n.openMixBtn.addEventListener("click",()=>{yt(),ht(!0)})),G()}}function xt(){const{terms:t,tags:e}=c.parseQuery(),n=new URLSearchParams(window.location.search);return t.length?n.set("q",t.join(" ")):n.delete("q"),e.size?n.set("tags",[...e].join(",")):n.delete("tags"),n.delete("sound"),n}function Lt(t=!1){const e=xt(),n=new URLSearchParams(location.search);n.has("list")&&e.set("list",n.get("list")),n.has("sound")&&e.set("sound",n.get("sound")),a.page&&"home"!==a.page?e.set("page",a.page):e.delete("page");const i=e.toString(),o=`${location.pathname}${i?"?"+i:""}`;(t?history.pushState:history.replaceState).call(history,null,"",o)}function Et(){const t=new URLSearchParams(location.search),e=t.get("q")||"",i=t.get("tags")||"";a.queryTags.clear();const o=i?i.split(",").map(t=>c.slug(t)).filter(Boolean):[];for(const t of o)a.queryTags.add(t);a.queryText=e;const r=o.map(t=>"#"+(a.tags[t]?.name||t));n.q.value=[e,...r].filter(Boolean).join(" ");const s=t.get("page");a.page="game"===s||"about"===s||"bg"===s||"awards"===s?s:"home";const l=t.get("list");a.receivedList=l?l.split(",").filter(Boolean):[]}function St(){const t=new URLSearchParams(location.search).get("sound");if(!t)return;const e=c.byId("snd-"+t);if(e){if(e.scrollIntoView({behavior:"smooth",block:"center"}),a.highlightedCardId){const t=c.byId("snd-"+a.highlightedCardId);t&&t.classList.remove("glow-persistent")}a.highlightedCardId=t,e.classList.add("glow-persistent")}}function bt(t){const e=a.page;try{document.dispatchEvent(new CustomEvent("pageChange",{detail:{page:t,prevPage:e,phase:"before"}}))}catch(t){}a.page=t,n.pageHome.classList.add("hidden"),n.pageGame.classList.add("hidden"),n.pageAbout.classList.add("hidden"),n.pageawards&&n.pageawards.classList.add("hidden"),n.pageBg&&n.pageBg.classList.add("hidden"),"home"===t?n.pageHome.classList.remove("hidden"):"game"===t?n.pageGame.classList.remove("hidden"):"about"===t?n.pageAbout.classList.remove("hidden"):"awards"===t&&n.pageawards?n.pageawards.classList.remove("hidden"):"bg"===t&&n.pageBg&&n.pageBg.classList.remove("hidden"),n.navTabs.forEach(e=>{e.getAttribute("data-page")===t?e.classList.add("active"):e.classList.remove("active")}),document.body.classList.toggle("bg-full","bg"===t||"about"===t),document.body.classList.remove("nav-open"),n.navToggle&&n.navToggle.setAttribute("aria-expanded","false"),Lt(!0);try{document.dispatchEvent(new CustomEvent("pageChange",{detail:{page:t,prevPage:e,phase:"after"}}))}catch(t){}}function Bt(t){return navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).catch(()=>wt(t)):wt(t)}function wt(t){const e=l.el("textarea",{style:{position:"fixed",left:"-9999px",top:"0"}},t);document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){}return e.remove(),Promise.resolve()}function Mt(t,e=2200){const i=n.toast;i&&(a.toastTimer&&(clearTimeout(a.toastTimer),a.toastTimer=null),i.textContent=t,i.classList.remove("hidden"),e>0&&(a.toastTimer=setTimeout(()=>{i.classList.add("hidden"),a.toastTimer=null},e)))}function Tt(t,e,i){const o=n.menu;if(!o)return;o.innerHTML="";const r=l.el("div",{class:"menu-item",role:"menuitem",tabindex:"0"},"分享網址");r.addEventListener("click",async()=>{const e=function(t){const e=String(location.href||"").replace(/[?#].*$/,"");return`${e}${e.includes("?")?"&":"?"}sound=${encodeURIComponent(t)}`}(t.id);await Bt(e),It(),Mt("已複製分享連結");c.byId("snd-"+t.id)});const s=l.el("div",{class:"menu-item",role:"menuitem",tabindex:"0"},"加入軌道");s.addEventListener("click",()=>{It(),function(t){const e=a.soundMap.get(t)||a.sounds.find(e=>e.id===t);if(!e)return void Mt("找不到音效");yt(),vt(e)&&Mt("已加入混音軌道")}(t.id)});const d=l.el("div",{class:"menu-item",role:"menuitem",tabindex:"0"},"下載音檔");d.addEventListener("click",()=>{It(),c.download(t.src,t.file)}),o.append(r,s,d),o.classList.remove("hidden"),requestAnimationFrame(()=>function(t,e){const a=n.menu;if(!a)return;const i=6,o=a.offsetWidth||180,r=a.offsetHeight||100,s=window.innerWidth,l=window.innerHeight,c=Math.min(Math.max(0,t),s-o-i),d=Math.min(Math.max(0,e),l-r-i);a.style.left=c+"px",a.style.top=d+"px"}(e,i))}function It(){const t=n.menu;t&&(t.classList.add("hidden"),t.innerHTML="")}function kt(t){document.documentElement.classList.toggle("light","light"===t)}window.addEventListener("popstate",()=>{Et(),Dt(),St()}),document.addEventListener("click",t=>{const e=n.menu;!e||e.classList.contains("hidden")||e.contains(t.target)||It()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&It()}),window.addEventListener("resize",It);kt(localStorage.getItem("theme")||(matchMedia("(prefers-color-scheme:light)").matches?"light":"dark")),n.themeBtn.addEventListener("click",()=>{const t=document.documentElement.classList.contains("light")?"dark":"light";"dark"==t&&function(t){const e=a.sounds.find(e=>e.id===t);e&&r(e)}("oNTWqg"),localStorage.setItem("theme",t),kt(t)});try{n.settingsBtn&&n.settingsBtn.addEventListener("click",t=>{t.preventDefault(),n.settingsModal&&(n.settingsModal.classList.remove("hidden"),n.settingsModal.setAttribute("aria-hidden","false"),n.settingsVolume&&(n.settingsVolume.value=String(Math.round(100*(a.globalVolume||1)))),n.settingsVolumeValue&&(n.settingsVolumeValue.textContent=`${Math.round(100*(a.globalVolume||1))}%`))}),n.settingsClose&&n.settingsClose.addEventListener("click",()=>{n.settingsModal&&(n.settingsModal.classList.add("hidden"),n.settingsModal.setAttribute("aria-hidden","true"))}),document.addEventListener("click",t=>{n.settingsModal&&(n.settingsModal.classList.contains("hidden")||t.target===n.settingsModal&&(n.settingsModal.classList.add("hidden"),n.settingsModal.setAttribute("aria-hidden","true")))}),document.addEventListener("keydown",t=>{"Escape"===t.key&&n.settingsModal&&!n.settingsModal.classList.contains("hidden")&&(n.settingsModal.classList.add("hidden"),n.settingsModal.setAttribute("aria-hidden","true"))}),n.settingsVolume&&n.settingsVolume.addEventListener("input",t=>{const e=Number(n.settingsVolume.value)||0,i=Math.max(0,Math.min(100,e))/100;a.globalVolume=i;try{localStorage.setItem("globalVolume",String(i))}catch(t){}n.settingsVolumeValue&&(n.settingsVolumeValue.textContent=`${Math.round(100*i)}%`);try{if(m&&m.masterGain&&m.masterGain.gain)try{m.masterGain.gain.value=i}catch(t){try{m.masterGain.gain.rampTo(i,.02)}catch(t){}}}catch(t){}})}catch(t){console.warn("[settings] init failed",t)}const Ct=new Set;function Pt(e,i){const o=e.tags.map(t=>a.tags[c.slug(t)]).filter(t=>t&&"streamer"===t.role&&t.avatar);if(0===o.length)return;const r=l.el("div",{class:"group"});Ct.add(r),o.forEach((e,n)=>{const a=l.el("div",{class:"avatar pop-in jit",style:{animationDelay:60*n+"ms"}},[l.el("img",{src:t(e.avatar),alt:e.name})]);r.appendChild(a)}),n.stage.appendChild(r),i.__group=r}function Rt(t,e){const n=e.__group;if(!n)return;Array.from(n.children).forEach((t,e)=>{t.classList.remove("jit"),setTimeout(()=>{t.classList.add("hop-out"),t.addEventListener("animationend",()=>{t.remove(),0===n.childElementCount&&(n.remove(),Ct.delete(n))},{once:!0})},90*e)})}const At="favorites",Nt="favorites_version",Ht=/^[A-Za-z0-9_-]{6}$/;function Ft(t){if(!t)return[];try{const e=JSON.parse(t);if(Array.isArray(e))return e.map(String);if(e&&"object"==typeof e)return Object.keys(e).filter(t=>!!e[t]).map(String)}catch(e){if("string"==typeof t)return t.split(/[,\s]+/).map(t=>t.trim()).filter(Boolean)}return[]}function $t(t){if(!t)return"";let e=String(t);e=e.split("?")[0],e=e.replace(/^\.?\//,"");try{e=decodeURIComponent(e)}catch{}return e}function qt(t){try{const e=localStorage.getItem(At);if(!function(t){const e=Ft(t);return 0!==e.length&&!e.every(t=>Ht.test(t))}(e))return void localStorage.setItem(Nt,"2");const n=Ft(e),{exact:i,lower:o}=function(t){const e=new Map,n=new Map;return t.forEach(t=>{const a=$t(t.file),i=a.split("/").pop(),o=t.id||i;[a,i,"sounds/"+a,"sounds/"+i].forEach(t=>{e.set(t,o),n.set(t.toLowerCase(),o)})}),{exact:e,lower:n}}(t),r=[],s=new Set,l=[];n.forEach(t=>{const e=$t(t),n=e.split("/").pop(),a=[e,e.replace(/^sounds\//,""),n,"sounds/"+e,"sounds/"+n];let c=null;for(const t of a)if(c=i.get(t)||o.get(t.toLowerCase()),c)break;c?s.has(c)||(s.add(c),r.push(c)):l.push(t)}),localStorage.setItem("favorites_legacy_backup",e),localStorage.setItem(At,JSON.stringify(r)),localStorage.setItem(Nt,"2"),a.favorites=r,a.favSet=new Set(r),Mt(`已升級最愛格式，共 ${r.length} 筆${l.length?`；未匹配 ${l.length} 筆`:""}。`),console.info("[favorites migration] done:",{converted:r.length,missing:l})}catch(t){console.warn("[favorites migration] error:",t)}}function Dt(){const{terms:t,tags:e}=c.parseQuery(),i=a.sounds.filter(n=>c.match(n,t,e)),o=a.receivedList.map(t=>a.sounds.find(e=>e.id===t)).filter(Boolean),r=new Map(a.sounds.map(t=>[t.id,t])),s=new Set(i.map(t=>t.id)),d=a.favorites.map(t=>r.get(t)).filter(t=>t&&s.has(t.id)),u=o.filter(t=>i.includes(t)&&!a.favSet.has(t.id)),m=i.filter(t=>!a.favSet.has(t.id)&&!u.includes(t));a.isSorting||Wt(n.favGrid,d,{inFav:!0}),Wt(n.receivedGrid,u),Wt(n.grid,m),n.favEmpty.classList.toggle("hidden",d.length>0),n.empty.classList.toggle("hidden",i.length>0),u.length>0?n.receivedSection&&n.receivedSection.classList.remove("hidden"):n.receivedSection&&n.receivedSection.classList.add("hidden"),function(){n.activeChips.innerHTML="";for(const t of a.queryTags){const e=a.tags[t],i=e?.color||"#94a3b8",o=l.el("span",{class:"chip",style:{background:i},onclick:()=>{a.queryTags.delete(t),Dt(),Lt(!0)}},[`#${e?.name||t}`,l.el("button",{title:"移除",onclick:()=>{a.queryTags.delete(t),Dt(),Lt(!0)}},"×")]);n.activeChips.appendChild(o)}}()}function Wt(t,e,n={inFav:!1}){t.innerHTML="";for(const a of e)t.appendChild(Vt(a,n))}function Vt(t,e={inFav:!1}){const n=!(!a.isSorting||!e.inFav),i={class:"heart","aria-pressed":String(c.inFav(t.id)),"aria-label":"加入/移除最愛"};n?(i.disabled="true",i["aria-disabled"]="true",i.title="正在編輯最愛排序，無法變更最愛"):i.onclick=e=>{e.stopPropagation(),function(t,e){if(a.isSorting)return void Mt("正在編輯最愛排序，無法變更最愛");a.favSet.has(t)?a.favorites=a.favorites.filter(e=>e!==t):a.favorites.push(t);a.favSet=new Set(a.favorites),c.saveFav(),e&&e.setAttribute("aria-pressed",String(a.favSet.has(t)));Dt()}(t.id,o)};const o=l.el("button",i,l.svgHeart()),s=l.el("div",{class:"tags"});for(const e of t.tags){const t=c.slug(e),n=a.tags[t],i=n?.color||"#94a3b8",o=l.el("span",{class:"tag",style:{background:i}},e);o.addEventListener("click",e=>{e.stopPropagation(),Gt(t)}),s.appendChild(o)}const d=l.el("div",{id:"snd-"+t.id,"data-id":t.id,class:"sound",role:"button",tabindex:"0","aria-label":`播放音效：${t.title}`},[l.el("div",{class:"sound-top"},[l.el("div",{class:"title",title:t.title},t.title),o]),s]),u=async()=>{try{r(t)}catch(t){console.error(t)}};a.isSorting&&e.inFav||d.addEventListener("click",u),a.isSorting&&e.inFav||d.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),u())}),a.isSorting&&e.inFav||d.addEventListener("contextmenu",e=>{e.preventDefault(),It(),Tt(t,e.clientX,e.clientY)});const m=()=>{clearTimeout(a.contextTimer)};return a.isSorting&&e.inFav||d.addEventListener("pointerdown",e=>{clearTimeout(a.contextTimer);const{clientX:n,clientY:i}=e;a.contextTimer=setTimeout(()=>{It(),Tt(t,n||window.innerWidth/2,i||window.innerHeight/2)},650)}),a.isSorting&&e.inFav||d.addEventListener("pointerup",m),a.isSorting&&e.inFav||d.addEventListener("pointerleave",m),d.addEventListener("pointercancel",m),d}function Gt(t){a.queryTags.add(t),Dt(),Lt(!0)}function Ot(){n.q.addEventListener("input",c.debounce(()=>{a.queryText=n.q.value;const t=n.q.value,e=t.split(/\s+/).pop()||"",i=e.startsWith("#")?e.slice(1).toLowerCase():t.trim().toLowerCase();i?a.tagList.filter(t=>t.name.toLowerCase().includes(i)||t.key.toLowerCase().includes(i)):a.tagList.slice(0,8);Dt(),Lt(!1)},180)),n.clearBtn.addEventListener("click",()=>{n.q.value="",a.queryText="",a.queryTags.clear(),Dt(),Lt(!0)}),n.navTabs.forEach(t=>{t.addEventListener("click",()=>{bt(t.getAttribute("data-page")||"home")})}),n.navToggle&&n.navToggle.addEventListener("click",()=>{const t=!document.body.classList.contains("nav-open");document.body.classList.toggle("nav-open",t),n.navToggle.setAttribute("aria-expanded",String(t))}),document.addEventListener("click",t=>{if(document.body.classList.contains("nav-open")){const e=document.querySelector("header");e&&!e.contains(t.target)&&(document.body.classList.remove("nav-open"),n.navToggle&&n.navToggle.setAttribute("aria-expanded","false"))}}),n.navTabs.forEach(t=>t.addEventListener("click",()=>{document.body.classList.remove("nav-open"),n.navToggle&&n.navToggle.setAttribute("aria-expanded","false")})),n.shuffleBtn&&n.shuffleBtn.addEventListener("click",()=>{const t=[],n=[];a.sounds.forEach((e,i)=>{a.favSet.has(e.id)||(t.push(e),n.push(i))}),e(t),n.forEach((e,n)=>{a.sounds[e]=t[n]}),Dt()}),n.resetOrderBtn&&n.resetOrderBtn.addEventListener("click",()=>{if(!a.defaultSoundsSnapshot||!a.defaultSoundsSnapshot.length)return;const t=a.defaultSoundsSnapshot,e=new Map(t.map((t,e)=>[t.id,e]));a.sounds.sort((t,n)=>(e.has(t.id)?e.get(t.id):Number.MAX_SAFE_INTEGER)-(e.has(n.id)?e.get(n.id):Number.MAX_SAFE_INTEGER)),Dt()}),n.sortFavBtn&&n.doneSortBtn&&(n.sortFavBtn.addEventListener("click",()=>{a.isSorting=!0,document.body.classList.add("sorting"),n.sortFavBtn.classList.add("hidden"),n.doneSortBtn.classList.remove("hidden");const{terms:t,tags:e}=c.parseQuery(),i=new Map(a.sounds.map(t=>[t.id,t])),o=new Set(a.sounds.filter(n=>c.match(n,t,e)).map(t=>t.id)),r=a.favorites.map(t=>i.get(t)).filter(t=>t&&o.has(t.id));Wt(n.favGrid,r,{inFav:!0}),"undefined"!=typeof Sortable?a.sortable=Sortable.create(n.favGrid,{dataIdAttr:"data-id",animation:150,delay:150,delayOnTouchOnly:!0,ghostClass:"drag-ghost",chosenClass:"drag-chosen",dragClass:"dragging",filter:".heart",preventOnFilter:!1}):console.warn("SortableJS 未載入")}),n.doneSortBtn.addEventListener("click",()=>{const t=Array.from(n.favGrid.children).map(t=>t.getAttribute("data-id")).filter(Boolean);if(t.length){const e=a.favorites.filter(e=>!t.includes(e));a.favorites=t.concat(e),a.favSet=new Set(a.favorites),c.saveFav(),Mt("已儲存最愛排序")}a.sortable&&(a.sortable.destroy(),a.sortable=null),a.isSorting=!1,document.body.classList.remove("sorting"),n.doneSortBtn.classList.add("hidden"),n.sortFavBtn.classList.remove("hidden"),Dt()})),n.shareFavBtn&&n.shareFavBtn.addEventListener("click",async()=>{const t=[...a.favorites];if(0===t.length)return void Mt("沒有最愛可分享");const e=function(t){const e=xt();t&&t.length?e.set("list",t.join(",")):e.delete("list"),e.delete("sound");const n=e.toString();return`${location.origin}${location.pathname}${n?"?"+n:""}`}(t);await Bt(e),Mt("已複製分享最愛列表連結")})}function jt(){const n=document.getElementById("concentration-game"),i=document.getElementById("cg-board"),r=document.getElementById("cg-timer"),l=document.getElementById("cg-accuracy"),d=document.getElementById("cg-result"),u=document.getElementById("cg-restart");if(!n)return;let m=[],g=null,f=null,p=0,h=0,v=0,y=0,x=0,L=null,E=!1,S=!0,b=[],B=null,w=null,M=!1;function T(){const t=a.tagList.filter(t=>"streamer"===t.role).map(t=>c.slug(t.key)),n=e=>t.includes(e);let i=a.sounds.filter(t=>1===t.tags.filter(n).length&&(!t.tags.includes("髒話")&&!t.tags.includes("SUS")));i=e(i);let o=function(t){let e=[],n=0,a=0,i=0,o=0,r=0,s=0,l=0;for(const c of t){const t=Array.isArray(c.tags)?c.tags:[];if(n<2&&t.includes("阿萬")?(n++,e.push(c)):a<1&&t.includes("瓦哈")?(a++,e.push(c)):i<1&&t.includes("Matsuko")?(i++,e.push(c)):o<1&&t.includes("豹子頭")?(o++,e.push(c)):r<1&&t.includes("貓下去")?(r++,e.push(c)):s<1&&(t.includes("貓下去")||t.includes("豹子頭")||t.includes("Matsuko")||t.includes("豹子頭")||t.includes("瓦哈"))?(s++,e.push(c)):!(t.includes("阿萬")||t.includes("瓦哈")||t.includes("豹子頭")||t.includes("貓下去")||t.includes("Matsuko"))&&l<2&&(l++,e.push(c)),e.length>=8)break}return e.slice(0,8)}(i);return o=e(o),o.splice(8),o.map(t=>{const e=t.tags.find(n),i=a.tags[c.slug(e)];return{id:t.id,audio:t.src,streamer:e,avatar:i?.avatar||"",streamerName:i?.name||e,title:t.title}})}function I(){if(b=T(),!b||0===b.length)return d.innerHTML='<h3>無法開始遊戲</h3><p style="color:var(--muted)">目前沒有足夠的音效可供配對（需至少 1 組）。請回到主頁或稍後再試。</p>',d.classList.remove("hidden"),E=!1,void(a.cgRunning=!1);m=[];try{B&&(clearTimeout(B),B=null,w=null)}catch(t){}b.forEach((t,e)=>{m.push({type:"card",pairId:t.id,id:`${t.id}-0`,audio:t.audio,avatar:t.avatar,streamer:t.streamer,streamerName:t.streamerName,title:t.title,matched:!1,seen:!1}),m.push({type:"card",pairId:t.id,id:`${t.id}-1`,audio:t.audio,avatar:t.avatar,streamer:t.streamer,streamerName:t.streamerName,title:t.title,matched:!1,seen:!1})}),e(m),v=0,p=0,h=0,y=0,x=0,g=null,f=null,S=!0,M=!1,E=!1,a.cgRunning=!1,r&&(r.textContent=N(x),r.classList.remove("cg-running")),k(),A(),d.classList.add("hidden"),s=()=>{E=!1,a.cgRunning=!1,H(),P(),r&&r.classList.remove("cg-running"),i.innerHTML="";try{B&&(clearTimeout(B),B=null,w=null)}catch(t){}}}function k(){i.innerHTML="",m.forEach((e,n)=>{const s=document.createElement("div");s.className="cg-card",s.dataset.idx=n,(e.flipped||e.matched)&&s.classList.add("flipped"),e.matched&&s.classList.add("matched");const l=e.avatar?`<img src="${t(e.avatar)}" alt="${e.streamerName}">`:`<div style="font-weight:700;color:var(--muted);font-size:12px">${e.streamerName}</div>`;s.innerHTML=`\n        <div class="cg-card-inner">\n          <div class="cg-card-front"></div>\n          <div class="cg-card-back">\n            ${l}\n            ${e.matched?'<div class="cg-lock">✓</div>':""}\n          </div>\n        </div>\n      `,s.onclick=()=>function(t){if(void 0!==w&&w&&(w.f||w.s)){B&&(clearTimeout(B),B=null);const t=w;w=null,R(t.f,t.s),g=null,f=null,S=!0}if(!S)return;const e=m[t];if(e.flipped||e.matched)return;M||(M=!0,E=!0,a.cgRunning=!0,r&&r.classList.add("cg-running"),function(){L&&clearInterval(L);L=setInterval(()=>{a.cgRunning&&(x++,r.textContent=N(x))},1e3)}());if(e.flipped=!0,k(),g){if(!f){e._seenBefore=!!e.seen,e.seen=!0,f=e,P(),C=o(e.audio,{preload:"auto"}),e.title&&Mt(e.title,3e3),y++,S=!1;w={f:g,s:f},B&&(clearTimeout(B),B=null),B=setTimeout(()=>{B=null;const t=w;w=null,R(t.f,t.s),g=null,f=null,S=!0},500)}}else e._seenBefore=!!e.seen,e.seen=!0,g=e,P(),C=o(e.audio,{preload:"auto"}),e.title&&Mt(e.title,3e3);A()}(n),s.addEventListener("pointerdown",t=>{s.classList.add("clicked"),setTimeout(()=>s.classList.remove("clicked"),160)}),i.appendChild(s)})}let C=null;function P(){if(C){try{C.pause(),C.currentTime=0}catch(t){}C=null}}function R(t,e){if(t&&e){if(t.pairId===e.pairId)t.matched=!0,e.matched=!0,p+=2,v+=1;else{const n=!!t._seenBefore,a=!!e._seenBefore;n&&a?h+=2:(n||a)&&(h+=1),t.flipped=!1,e.flipped=!1}delete t._seenBefore,delete e._seenBefore,k(),A(),v===b.length&&(P(),function(){E=!1,a.cgRunning=!1,H(),P(),r&&r.classList.remove("cg-running");const t=p+h,e=t?Math.round(p/t*100):"--";d.innerHTML=`\n            <h3>完成！</h3>\n            <div class="stats">\n              <div><div class="big-num">${N(x)}</div><div class="muted">用時</div></div>\n              <div><div class="big-num">${p}</div><div class="muted">正確數</div></div>\n              <div><div class="big-num">${h}</div><div class="muted">錯解數</div></div>\n              <div><div class="big-num">${e}%</div><div class="muted">準確率</div></div>\n            </div>\n            <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">\n              <button class="btn small-btn" id="cg-restart-2">再來一局</button>\n              <button class="btn small-btn" id="cg-home">回主頁</button>\n            </div>\n          `,d.classList.remove("hidden");try{if(e>=90){const t=["c4B1fg","Hv3yFA","JkJ9-A","5VHtAg"],e=a.sounds&&a.sounds.find(e=>e.id===t[Math.floor(Math.random()*t.length)]);e&&e.src&&(P(),C=o(e.src,{preload:"auto"}),Mt("你是記憶猛肝",3e3))}}catch(t){}const n=document.getElementById("cg-restart-2");n&&n.addEventListener("click",()=>{I()});const i=document.getElementById("cg-home");i&&i.addEventListener("click",()=>{bt("home")})}())}}function A(){r.textContent=N(x);const t=p+h,e=t?Math.round(p/t*100):null;l.textContent=null!==e?`準確率：${e}%`:"準確率：--%"}function N(t){return`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`}function H(){L&&clearInterval(L),L=null}u.onclick=I,I()}(async function(){const[e,i]=await Promise.all([fetch(t("config/tags.json"),{cache:"no-store"}).then(t=>t.json()),fetch(t("config/sounds.json"),{cache:"no-store"}).then(t=>t.json())]);qt(i),a.tags={},a.tagList=e.map(t=>({key:c.slug(t.key),name:t.name,color:t.color,role:t.role,avatar:t.avatar}));for(const t of a.tagList)a.tags[c.slug(t.key)]=t;a.sounds=i.map(e=>({id:e.id||e.file.replace(/^.*[\\\/]/,""),src:t(`sounds/${e.file}`),file:e.file,title:e.title,tags:e.tags.slice()})),a.soundMap=new Map(a.sounds.map(t=>[t.id,t])),a.defaultSoundsSnapshot=a.sounds.map(t=>({...t}));try{const e=30,i=t("misc/第一屆音效板票選結果.csv");let o="";try{const t=await fetch(i,{cache:"no-store"});t.ok?o=await t.text():console.warn("[csv load] resp not ok",t.status,i)}catch(t){console.warn("[csv load] failed to fetch",i,t)}if(o){const r=o.split(/\r?\n/).map(t=>t.trim()).filter(Boolean);if(r.length>0){const o=r[0].split(",").map(t=>t.replace(/^\s+|\s+$/g,"")),s=/(id|url|link|網址|code)/i;let l=o.findIndex(t=>s.test(t));if(-1===l){const t=new Map,e=/^[A-Za-z0-9_-]{4,20}$/;for(let n=1;n<Math.min(r.length,30);n++){const a=r[n].split(",");for(let n=0;n<a.length;n++){const i=a[n]?a[n].trim().replace(/^"|"$/g,""):"";e.test(i)&&t.set(n,(t.get(n)||0)+1)}}let n=-1,a=0;for(const[e,i]of t.entries())i>a&&(n=e,a=i);-1!==n&&(l=n)}-1===l&&(l=0);const c=[];for(let t=1;t<r.length&&c.length<e;t++){const e=r[t].split(",");let n=e[l]?e[l].trim():"";n.startsWith('"')&&n.endsWith('"')&&(n=n.slice(1,-1)),n=n.trim(),n&&c.push(n)}if(c.length>0){const o=t=>String(t||"").trim().toLowerCase().replace(/\.(mp3|wav|ogg|m4a)$/i,""),r=new Map;for(const t of a.sounds)r.set(o(t.id),t),t.file&&r.set(o(t.file),t);const s=new Set,l=[],d=[];for(const t of c){let e=a.soundMap.get(t);e||(e=r.get(o(t))),e&&!s.has(e.id)&&(l.push(e),s.add(e.id),d.push(e))}for(const t of a.sounds)s.has(t.id)||l.push(t);const u=d.length;a.sounds=l,a.soundMap=new Map(a.sounds.map(t=>[t.id,t])),a.defaultSoundsSnapshot=a.sounds.map(t=>({...t})),console.info("[csv reorder] applied ordering from",i,"csvIds=",c.length,"matched=",u),console.debug("[csv reorder] csv topIds sample:",c.slice(0,e)),0===u&&console.warn("[csv reorder] no ids matched; check csv id column vs sounds.json ids"),a.voteResults={topIds:c,matchedList:d,top10:d.slice(0,10),next20:d.slice(10,30)};try{n.awardsBanner&&(n.awardsBanner.src=t("misc/第一屆貓下去.png"))}catch(t){}}}}}catch(t){console.warn("[csv reorder] unexpected error",t)}const o=new Set;a.sounds.forEach(t=>t.tags.forEach(t=>o.add(c.slug(t)))),a.usedTagList=a.tagList.filter(t=>o.has(t.key))})().then(()=>{Et(),function(){const t=n.tagList;t&&(t.innerHTML="",a.usedTagList.forEach(e=>{const n=l.el("span",{class:"tag",style:{background:e.color||"#94a3b8"}},e.name);n.addEventListener("click",()=>{Gt(e.key)}),t.appendChild(n)}))}(),yt(),bt(a.page),Dt(),St(),Ot();try{const t=document.querySelector("header h1");t&&t.addEventListener("click",t=>{if(!(t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)){if("home"===a.page)return location.reload();t.preventDefault(),a.queryText="",a.queryTags.clear(),n.q&&(n.q.value=""),bt("home"),Dt(),Lt(!0);try{window.scrollTo({top:0,behavior:"smooth"})}catch(t){}}})}catch(t){}}).catch(t=>{console.error(t),n.grid.innerHTML='<div class="empty">載入設定檔失敗，請確認 <code>config/</code> 路徑是否正確。</div>'}),document.addEventListener("pageChange",t=>{const e=t&&t.detail&&t.detail.page,i=t&&t.detail&&t.detail.prevPage;try{const o=t&&t.detail&&t.detail.phase;if("before"===o&&"game"===i&&"function"==typeof s)try{s()}catch(t){}"after"===o&&("game"===e&&jt(),"awards"===e&&function(){try{if(!a.voteResults)return n.awardsTop10&&(n.awardsTop10.innerHTML=""),void(n.awardsNext20&&(n.awardsNext20.innerHTML=""));n.awardsTop10&&Wt(n.awardsTop10,a.voteResults.top10||[]),n.awardsNext20&&Wt(n.awardsNext20,a.voteResults.next20||[])}catch(t){console.warn("[renderawardsPage] error",t)}}())}catch(t){}})}()</script></div></body></html>