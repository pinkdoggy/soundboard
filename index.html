<!doctype html><html lang="zh-Hant"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="assets/favicon.png" type="image/png"><title>阿萬與動物朋友按鈕</title><style>:root{--bg:#0b0d10;--search:#0b0d1000;--fg:#e9eef5;--muted:#a8b3c7;--card:#141821;--card-2:#212832;--border:#202636;--accent:#6aa9ff;--accent2:#ff9e6a;--heart:#ff5a7a;--chip-fg:#0b0d10;--shadow:0 6px 24px rgba(0, 0, 0, .25);--bg-blend-mode:normal;--bg-opacity:0.25;--control-h:44px;--liquid-hover:rgba(96, 150, 255, .20)}:root.light{--bg:#f8fafc;--search:#f8fafc00;--fg:#0d1320;--muted:#4b5563;--card:#ffffff;--card-2:#f3f6fb;--border:#e5e7eb;--accent:#2563eb;--accent2:#eb7b25;--heart:#e11d48;--chip-fg:#ffffff;--shadow:0 4px 18px rgba(2, 6, 23, .08);--bg-blend-mode:normal;--bg-opacity:0.35}*{box-sizing:border-box}body,html{height:100%}body{margin:0;background-color:var(--bg);color:var(--fg);font:medium ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Noto Sans,"Helvetica Neue",Arial;position:relative;z-index:1}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:url('assets/background-by-jia.avif');background-size:auto 90%;background-repeat:repeat;background-attachment:fixed;mix-blend-mode:var(--bg-blend-mode);opacity:var(--bg-opacity);z-index:-1}a{color:inherit}.wrap{max-width:1100px;margin:0 auto;padding:20px}header{display:flex;align-items:center;flex-wrap:wrap;gap:12px;margin-bottom:14px}header h1{white-space:nowrap;margin-right:auto}h1{font-size:1.4rem;margin:0 8px 0 0;letter-spacing:.5px}.theme-toggle{border:1px solid var(--border);background:var(--card);color:var(--fg);border-radius:10px;padding:8px 12px;cursor:pointer;box-shadow:var(--shadow)}.search-row{display:flex;flex-wrap:wrap;gap:0;align-items:stretch;position:sticky;top:0;background:var(--search);padding:8px 0 12px;z-index:5}.searchbar{flex:1 1 260px;display:flex;align-items:center;gap:6px;background:var(--glass-bg)!important;border:1px solid var(--glass-border)!important;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-radius:12px;padding:6px 8px;box-shadow:var(--shadow);position:relative;height:var(--control-h)}.searchbar input{flex:1;background:0 0;border:0;outline:0;color:var(--fg);font-size:16px;min-width:160px;height:100%;line-height:var(--control-h);padding:0 6px}.chips{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}.chip{display:inline-flex;align-items:center;gap:4px;border-radius:999px;padding:4px 8px;font-size:12px;color:var(--chip-fg);box-shadow:0 2px 6px rgba(0,0,0,.18)}.chip button{appearance:none;border:0;background:0 0;color:inherit;cursor:pointer;font-size:14px;line-height:1;padding:0 0 0 2px}.searchbar .chip{cursor:pointer}.section-title{margin:18px 0 10px;font-weight:700;letter-spacing:.3px}.grid{display:grid;gap:4px;grid-template-columns:repeat(6,minmax(0,1fr))}@media (max-width:1000px){.grid{grid-template-columns:repeat(5,minmax(0,1fr))}}@media (max-width:800px){.grid{grid-template-columns:repeat(4,minmax(0,1fr))}}@media (max-width:600px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}@media (max-width:400px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}.sound{background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1) blur(8px);-webkit-backdrop-filter:saturate(1) blur(8px);border-radius:12px;padding:8px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:5px 2px;user-select:none;cursor:pointer;transition:transform .06s ease}.sound:active{transform:scale(.985)}.sound-top{display:flex;align-items:center;gap:4px}.title{font-weight:600;font-size:smaller;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.heart{width:24px;height:24px;border-radius:50%;place-items:center;border:1px solid var(--border);background:var(--card-2);cursor:pointer;flex:0 0 auto}.heart svg{width:16px;height:16px;display:block}.heart[aria-pressed=true] svg path{fill:var(--heart)}.tags{display:flex;flex-wrap:wrap;gap:6px}.tag{border-radius:999px;padding:3px 6px;font-size:small;color:var(--chip-fg);cursor:pointer;white-space:nowrap;box-shadow:0 2px 6px rgba(0,0,0,.16)}.stage{position:fixed;left:0;right:0;bottom:12px;display:flex;flex-wrap:wrap;gap:12px 14px;justify-content:center;pointer-events:none;z-index:40;padding:0 12px}.group{display:inline-flex;gap:8px;align-items:flex-end}.avatar{width:75px;height:75px;border-radius:999px;background:0 0;overflow:hidden;border:2px solid rgba(255,255,255,.8);box-shadow:0 8px 24px rgba(0,0,0,.35);transform-origin:50% 100%}.avatar>img{width:100%;height:100%;object-fit:cover}@keyframes popIn{0%{transform:translateY(20px) scale(.7);opacity:0}100%{transform:translateY(0) scale(1);opacity:1}}@keyframes jitter{0%,100%{transform:translateY(0) rotate(0)}20%{transform:translateY(-2px) rotate(-1deg)}40%{transform:translateY(1px) rotate(1deg)}60%{transform:translateY(-1px) rotate(.6deg)}80%{transform:translateY(1px) rotate(-.6deg)}}@keyframes hopOut{0%{transform:translateY(0);opacity:1}22%{transform:translateY(-12px);opacity:1}100%{transform:translateY(60px);opacity:0}}.pop-in{animation:popIn .28s cubic-bezier(.2,.9,.18,1) both}.jit{animation:jitter .9s ease-in-out infinite}.hop-out{animation:hopOut .5s cubic-bezier(.2,.8,.2,1) forwards}.hidden{display:none}.desc{color:var(--muted);font-size:14px;margin:0 0 6px}.empty{color:var(--muted);padding:12px 0}.row{display:flex;gap:10px;flex-wrap:wrap}.btn{border:1px solid var(--border);background:var(--card);color:var(--fg);border-radius:10px;padding:8px 12px;cursor:pointer}.tabs{display:flex;gap:8px;align-items:center;flex-wrap:wrap}.tab{display:inline-block;padding:6px 16px;font-size:14px;border:1px solid var(--border);border-radius:999px;background:var(--card-2);color:var(--fg);cursor:pointer;transition:background .15s ease,color .15s ease}.tab:hover{background:var(--card)}.tab.active{background:var(--accent);border-color:var(--accent);color:var(--chip-fg)}@media (max-width:600px){header .tabs{margin-top:8px}header .theme-toggle{margin-top:8px}}.section-header{display:flex;align-items:center;justify-content:space-between;margin:14px 0 8px}.section-header .actions{display:flex;gap:3px}.section-header h3{margin:0;font-size:1rem;font-weight:600;letter-spacing:.2px}.small-btn{font-size:12px;padding:4px 8px;border-radius:8px}.tag-list{display:flex;flex-wrap:wrap;gap:6px 8px;margin:8px 0}.tag-list .tag{cursor:pointer}.menu{position:fixed;z-index:9999;min-width:180px;background:var(--glass-bg)!important;border:1px solid var(--glass-border)!important;backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);border-radius:12px;overflow:hidden}.menu.hidden{display:none}.menu-item{padding:10px 12px;cursor:pointer;border-bottom:1px solid var(--border)}.menu-item:last-child{border-bottom:0}.menu-item:hover{background:var(--liquid-hover)}.toast{position:fixed;left:50%;bottom:80px;transform:translateX(-50%);background:var(--card);border:1px solid var(--border);padding:10px 14px;border-radius:10px;box-shadow:var(--shadow);z-index:70}.toast.hidden{display:none}.mix-panel{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;width:min(980px,calc(100% - 32px));background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.6) blur(18px);-webkit-backdrop-filter:saturate(1.6) blur(18px);border-radius:16px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px;padding:12px 14px 14px;z-index:80}.mix-panel.hidden{display:none}.mix-header{display:flex;flex-direction:column;gap:6px}.mix-scroll-host{position:relative;overflow-x:auto;overflow-y:hidden;border-radius:12px;background:rgba(15,23,42,.22);border:1px solid rgba(255,255,255,.12);scrollbar-width:none}.mix-scroll-host::-webkit-scrollbar{display:none}.mix-scroll-content{position:relative;min-height:75px}.mix-track-lanes{position:relative}.mix-track{position:relative;height:25px;border-bottom:1px dashed var(--glass-border);background-color:var(--glass-bg);overflow:hidden}.mix-track:last-of-type{border-bottom:0}.mix-track::before{content:attr(data-label);position:absolute;left:0;top:50%;transform:translate(-110%,-50%);font-size:12px;color:var(--muted)}.mix-clip{position:absolute;top:1px;height:23px;border-radius:8px;padding:4px 26px 4px 8px;font-size:12px;font-weight:600;color:var(--chip-fg);display:flex;align-items:center;cursor:grab;box-shadow:0 1px 3px rgba(0,0,0,.35)}.mix-clip:active{cursor:grabbing}.mix-clip.dragging{opacity:.85;box-shadow:0 2px 5px rgba(0,0,0,.55);cursor:grabbing}.mix-clip,.mix-scroll-host,.mix-track-lanes{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.mix-clip,.mix-scroll-host,.mix-track-lanes{touch-action:none}.mix-clip-title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}.mix-clip-remove{position:absolute;right:4px;top:4px;border:0;width:15px;height:15px;border-radius:999px;background:rgba(15,23,42,.6);color:var(--chip-fg);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px}.mix-clip-remove:hover{background:rgba(15,23,42,.8)}.mix-clip-placeholder{height:23px;margin:0;position:absolute;top:1px;left:0;right:0;pointer-events:none}.mix-playhead{position:absolute;top:0;bottom:0;width:2px;background:var(--accent);z-index:3;pointer-events:none}.mix-bar-row{display:flex;align-items:center;gap:8px;margin:0 4px}.mix-bar-row>.mix-bar{flex:1;display:flex;align-items:center;gap:6px;min-width:0}.mix-bar input[type=range]{flex:1;min-width:0}.mix-controls{display:flex;align-items:center;justify-content:space-between;gap:4px}.mix-controls-left{display:flex;align-items:center;gap:4px}.mix-controls-center{display:flex;align-items:center;gap:2px}.mix-controls-right{display:flex;align-items:center;gap:4px}.mix-btn{border:1px solid var(--glass-border);background:var(--card-2);color:var(--fg);border-radius:8px;padding:6px 6px;cursor:pointer;min-width:32px;display:inline-flex;align-items:center;justify-content:center;gap:2px;font-size:13px}.mix-btn:hover{background:rgba(15,23,42,.55)}.mix-btn[disabled]{opacity:.4;cursor:not-allowed}.mix-muted{color:var(--muted);font-size:12px}.mix-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:120}.mix-modal-backdrop.hidden{display:none}.mix-modal{background:var(--bg);border:1px solid var(--glass-border);border-radius:12px;padding:18px 20px;max-width:320px;box-shadow:var(--shadow)}.mix-modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:16px}.glow-persistent{box-shadow:0 0 0 4px rgba(106,169,255,.5),0 0 12px rgba(106,169,255,.75);transition:box-shadow .3s ease}:root{--glass-bg:rgba(20, 24, 33, .8);--glass-border:rgba(255, 255, 255, .12)}:root.light{--glass-bg:rgba(255, 255, 255, .6);--glass-border:rgba(15, 23, 42, .12)}.glass{background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px);background-clip:padding-box;box-shadow:var(--shadow)}.menu,.searchbar,.sound{background:var(--glass-bg)!important;border-color:var(--glass-border)!important;backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px)}header{position:relative}.nav-toggle{display:none;align-items:center;justify-content:center;border:1px solid var(--border);background:var(--card);color:var(--fg);border-radius:10px;padding:8px;cursor:pointer;box-shadow:var(--shadow)}@media (max-width:760px){.nav-toggle{display:inline-flex}header .tabs{display:none;position:absolute;right:0;top:100%;padding:8px;border-radius:12px;gap:6px;flex-direction:column;align-items:stretch;min-width:180px;z-index:120;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);box-shadow:var(--shadow)}body.nav-open header .tabs{display:flex}}body.bg-full{--bg-opacity:1!important}.bg-page{min-height:50vh}.bg-credit{position:fixed;right:16px;bottom:16px;font-size:large;padding:8px 12px;border-radius:10px;font-weight:800;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(10px);-webkit-backdrop-filter:saturate(1.8) blur(10px);box-shadow:var(--shadow);z-index:60}.bg-credit a{text-decoration:underline}#clearBtn.btn{height:var(--control-h);display:inline-flex;align-items:center;justify-content:center;padding:0 14px}.search-row .searchbar{border-top-right-radius:0;border-bottom-right-radius:0;border-right:0!important}.search-row #clearBtn{border-top-left-radius:0;border-bottom-left-radius:0;border-left:1px solid var(--glass-border);background:var(--glass-bg);backdrop-filter:saturate(1.5) blur(8px);-webkit-backdrop-filter:saturate(1.5) blur(8px)}#page-about .about-content{background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);border-radius:14px;padding:14px 16px;box-shadow:var(--shadow)}header{flex-wrap:nowrap}header h1{white-space:normal;min-width:0;overflow-wrap:anywhere}.search-row{flex-wrap:nowrap}.search-row .searchbar{flex:1 1 auto;min-width:0}.search-row .searchbar input{min-width:0}.search-row #clearBtn{flex:0 0 auto;white-space:nowrap}.drag-ghost{opacity:.6;transform:scale(.98)}.drag-chosen{outline:2px dashed var(--accent)}.dragging{cursor:grabbing}body.sorting #favGrid .card{cursor:grab}</style></head><body><div class="wrap"><header><h1>阿萬與動物朋友按鈕₁₈₅₄</h1><button id="navToggle" class="nav-toggle" aria-label="打開選單" aria-expanded="false" aria-controls="primaryNav" title="選單"><svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 6h18M3 12h18M3 18h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></button><nav id="primaryNav" class="tabs" aria-label="主選單"><button class="tab active" data-page="home">主頁</button> <button class="tab" data-page="game">小遊戲</button> <button class="tab" data-page="bg" id="tab-bg">背景</button> <button class="tab" data-page="about">關於</button> <button id="themeBtn" class="theme-toggle" aria-label="切換主題">電燈開關</button></nav></header><div id="page-home"><div class="search-row"><div class="searchbar" role="search"><svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"/></svg> <input id="q" placeholder="搜尋標題或 #標籤（可多個，用空白分隔）" autocomplete="off"><div id="activeChips" class="chips"></div></div><button id="clearBtn" class="btn" aria-label="清除搜尋">清除</button></div><div id="tagList" class="tag-list"></div><div class="section-header"><h3>最愛音效</h3><div class="actions"><button id="sortFavBtn" class="btn small-btn">手動排列</button> <button id="doneSortBtn" class="btn small-btn glow-persistent hidden">儲存排列</button> <button id="shareFavBtn" class="btn small-btn">分享</button></div></div><div id="favGrid" class="grid"></div><div id="favEmpty" class="empty hidden">還沒有最愛。點音效右上的 ❤️ 加入最愛。</div><div id="receivedSection" class="hidden"><div id="receivedHeader" class="section-header"><h3>收到的列表</h3></div><div id="receivedGrid" class="grid"></div></div><div class="section-header"><h3>全部音效</h3><div class="actions"><button id="openMixBtn" class="btn small-btn">音軌</button> <button id="shuffleBtn" class="btn small-btn">洗牌</button> <button id="resetOrderBtn" class="btn small-btn">預設順序</button></div></div><p class="desc">提示：點音效即可播放；右鍵（或行動裝置長按）可分享/下載。</p><div id="grid" class="grid"></div><div id="empty" class="empty hidden">沒有符合搜尋的音效。</div></div><div id="page-game" class="hidden"><div id="concentration-game"><div class="cg-header"><div class="cg-stats"><span id="cg-timer">00:00</span> <span id="cg-accuracy">準確率：--%</span></div><div class="cg-controls"><button id="cg-restart" class="btn small-btn">重開一局</button></div></div><div id="cg-board" class="cg-board"></div><div id="cg-result" class="cg-result hidden"></div><div id="cg-rules" class="cg-rules" aria-labelledby="cg-rules-title"><h4 id="cg-rules-title">記憶小遊戲規則</h4><ul><li>第一次翻開的牌不對計分造成影響，屬於記憶提示。</li><li>每翻開兩張卡，若為相同主播的相同音效即為配對，共有 8 對配對。</li><li>（不會出現帶有「髒話」或「SUS」標籤的語音，但是會有尖叫，請小心耳膜。）</li></ul></div></div><style>.cg-board{display:grid;grid-template-columns:repeat(4,70px);grid-template-rows:repeat(4,70px);gap:8px;justify-content:center;margin:12px auto;width:min(720px,96%);padding:12px;border-radius:12px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);box-shadow:var(--shadow);justify-items:center}.cg-card{width:70px;height:70px;background:#888;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;perspective:600px;will-change:transform;transition:transform 140ms ease,box-shadow 140ms ease;user-select:none}.cg-card.matched{opacity:.5;pointer-events:none}.cg-card-inner{width:100%;height:100%;transition:transform .4s cubic-bezier(.4, 2, .6, 1);transform-style:preserve-3d;position:relative}.cg-card.flipped .cg-card-inner{transform:rotateY(180deg)}.cg-card-back,.cg-card-front{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:10px;display:flex;align-items:center;justify-content:center}.cg-card-front{background:#888}.cg-card.clicked,.cg-card:active{transform:scale(1.06);box-shadow:0 10px 28px rgba(0,0,0,.28)}.cg-card-back{background:#fff;transform:rotateY(180deg);overflow:hidden}.cg-card-back img{width:80%;height:80%;object-fit:contain;border-radius:8px}.cg-lock{position:absolute;right:6px;top:6px;background:rgba(0,0,0,.4);color:#fff;width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:50%;font-weight:700;font-size:14px}.cg-header{display:flex;gap:6px;align-items:center;justify-content:space-between;margin:4px auto;padding:8px 12px;width:min(720px,96%);border-radius:12px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);box-shadow:var(--shadow);position:sticky;top:12px;z-index:60;flex-wrap:wrap}#cg-timer{font-size:1rem;font-weight:700;color:var(--fg);letter-spacing:.6px;min-width:25px;text-align:left}#cg-timer.cg-running{color:#34d399}#cg-accuracy{color:var(--muted);font-weight:600;margin-left:8px}.cg-stats{display:flex;align-items:center;gap:8px;flex:1 1 auto;min-width:0}.cg-controls{display:flex;align-items:center;gap:8px;flex:0 0 auto}.cg-header button{margin-left:8px;flex:0 0 auto}@media (max-width:420px){.cg-header{gap:8px;padding:8px}#cg-timer{font-size:1rem}.cg-board{grid-template-columns:repeat(4,56px);grid-template-rows:repeat(4,56px);gap:4px;padding:10px}.cg-card{width:56px;height:56px}}.cg-result{text-align:center;font-size:1.05rem;margin-top:18px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);border-radius:14px;padding:14px 16px;box-shadow:var(--shadow);max-width:480px;margin:18px auto 0}.cg-result h3{margin:0 0 6px;font-size:1.15rem}.cg-result .stats{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;color:var(--muted);font-weight:600}.cg-result .big-num{font-size:1.25rem;font-weight:700;color:var(--fg)}.cg-rules{width:min(720px,96%);margin:14px auto 28px;background:var(--glass-bg);border:1px solid var(--glass-border);backdrop-filter:saturate(1.8) blur(12px);-webkit-backdrop-filter:saturate(1.8) blur(12px);border-radius:12px;padding:12px 16px;box-shadow:var(--shadow);color:var(--fg)}.cg-rules h4{margin:0 0 8px;font-size:1.05rem}.cg-rules ul{margin:0;padding-left:18px;color:var(--muted)}</style></div><div id="page-bg" class="bg-page hidden" aria-labelledby="tab-bg" role="region"><div class="bg-credit"><a href="https://x.com/jiauwu_0730" target="_blank" rel="noopener">背景插畫由 Jia 繪製</a></div></div><div id="page-about" class="hidden"><div class="about-content"><p>本站由粉肝製作，並非由厭世醫師阿萬官方經營。音效內容皆是粉肝去脈絡式、斷章取義的剪輯，僅供娛樂。最後更新時間：2025/10/4。</p><p>阿萬本家→ <a href="https://x.com/drlifesucks" target="_blank">厭世醫師阿萬X</a>、<a href="https://www.youtube.com/@Dr.lifesucks" target="_blank">厭世醫師阿萬Youtube</a></p><p><a href="https://discord.gg/e6ch4VbRB4" target="_blank">音效板問題回報與建議區</a></p><img src="assets/art-by-sigh.png" alt="" style="margin:0 auto;max-width:100%;max-height:250px;display:block;object-fit:cover"><p style="text-align:right">插畫：<a href="https://x.com/sigh121212" target="_blank">Minie(Sigh)</a></p><h2>大德芳名錄</h2><p>感謝53、Kie在DC弄了一堆音效，讓南想到可以做這個網站，並在提出這個想法的一開始就弄了一堆音效過來。還有同樣感謝在原型階段就幫忙收集音效的米糕跟薰薰草。<br>感謝Jia繪製超可愛的背景圖跟收集了很多音效。<br><br>感謝粉肝們收集很多音效，豐富了這個網站（Word筆劃順）：<br>AmBinBong、CZ、HUI、Lococco de suzuran、Nokimi07、Sigh、TENN、Yichen沉沉、🌙🐰月桂葉香包♏🎵、布丁(25:00)、幸福柴柴、青末枝、凌伊LingYi（01）、夏白衫、澐▽米粉 肉干、貓貓雨。 以及其他回報問題、提出建議的粉肝們，你們讓這個網站的功能更完善。</p></div><div class="bg-credit"><a href="https://x.com/jiauwu_0730" target="_blank" rel="noopener">背景插畫由 Jia 繪製</a></div></div></div><div id="mixPanel" class="mix-panel hidden" aria-hidden="true" role="region" aria-label="混音軌道控制"><div class="mix-header"><div class="mix-bar-row"><div class="mix-bar"><span class="mix-muted">縮放</span> <input id="mixZoomRange" type="range" min="5" max="150" step="5" value="50" aria-label="混音軌道縮放"></div><div class="mix-bar"><span class="mix-muted">位置</span> <input id="mixScrollRange" type="range" min="0" max="100" step="1" value="0" aria-label="混音軌道檢視位置"></div></div><div id="mixScrollHost" class="mix-scroll-host" aria-hidden="false"><div id="mixScrollContent" class="mix-scroll-content"><div id="mixTrackLanes" class="mix-track-lanes"><div class="mix-track" data-track="0" data-label="1"></div><div class="mix-track" data-track="1" data-label="2"></div><div class="mix-track" data-track="2" data-label="3"></div></div><div id="mixPlayhead" class="mix-playhead" style="left:0"></div></div></div></div><div class="mix-controls"><div class="mix-controls-left"><button id="mixClearBtn" class="mix-btn" type="button">清除</button></div><div class="mix-controls-center"><button id="mixUndoBtn" class="mix-btn" type="button" aria-label="上一步">↺</button> <button id="mixRedoBtn" class="mix-btn" type="button" aria-label="下一步">↻</button> <button id="mixToStartBtn" class="mix-btn" type="button" aria-label="移到開頭">⏮</button> <button id="mixPlayPauseBtn" class="mix-btn" type="button" aria-label="播放或暫停">▶</button> <button id="mixToEndBtn" class="mix-btn" type="button" aria-label="移到結尾">⏭</button></div><div class="mix-controls-right"><button id="mixCloseBtn" class="mix-btn" type="button">關閉</button></div></div></div><div id="mixConfirmModal" class="mix-modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="mixConfirmTitle"><div class="mix-modal"><h3 id="mixConfirmTitle">要清除所有音軌嗎？</h3><div class="mix-modal-actions"><button id="mixConfirmCancel" class="mix-btn" type="button">取消</button> <button id="mixConfirmAccept" class="mix-btn" type="button">清除</button></div></div></div><div id="stage" class="stage" aria-hidden="true"></div><div id="menu" class="menu hidden" role="menu" aria-label="音效選單"></div><div id="toast" class="toast hidden" role="status" aria-live="polite"></div><script src="scripts/Tone.js"></script><script src="scripts/Sortable.min.js"></script><script>!function(){function t(t){return t+(t.includes("?")?"&":"?")+"v="+encodeURIComponent("ver2025-10-05")}function e(t,e=Math.random){for(let n=t.length-1;n>0;n--){const i=Math.floor(e()*(n+1));[t[n],t[i]]=[t[i],t[n]]}return t}const n={q:document.getElementById("q"),activeChips:document.getElementById("activeChips"),grid:document.getElementById("grid"),favGrid:document.getElementById("favGrid"),empty:document.getElementById("empty"),favEmpty:document.getElementById("favEmpty"),themeBtn:document.getElementById("themeBtn"),stage:document.getElementById("stage"),clearBtn:document.getElementById("clearBtn"),get menu(){return document.getElementById("menu")},get toast(){return document.getElementById("toast")},mixPanel:document.getElementById("mixPanel"),mixScrollHost:document.getElementById("mixScrollHost"),mixScrollContent:document.getElementById("mixScrollContent"),mixTrackLanes:document.getElementById("mixTrackLanes"),mixPlayhead:document.getElementById("mixPlayhead"),mixScrollRange:document.getElementById("mixScrollRange"),mixZoomRange:document.getElementById("mixZoomRange"),mixClearBtn:document.getElementById("mixClearBtn"),mixUndoBtn:document.getElementById("mixUndoBtn"),mixRedoBtn:document.getElementById("mixRedoBtn"),mixToStartBtn:document.getElementById("mixToStartBtn"),mixPlayPauseBtn:document.getElementById("mixPlayPauseBtn"),mixToEndBtn:document.getElementById("mixToEndBtn"),mixCloseBtn:document.getElementById("mixCloseBtn"),mixConfirmModal:document.getElementById("mixConfirmModal"),mixConfirmCancel:document.getElementById("mixConfirmCancel"),mixConfirmAccept:document.getElementById("mixConfirmAccept"),openMixBtn:document.getElementById("openMixBtn"),pageHome:document.getElementById("page-home"),pageGame:document.getElementById("page-game"),pageAbout:document.getElementById("page-about"),pageBg:document.getElementById("page-bg"),navToggle:document.getElementById("navToggle"),get navTabs(){return document.querySelectorAll(".tab")},tagList:document.getElementById("tagList"),receivedSection:document.getElementById("receivedSection"),receivedGrid:document.getElementById("receivedGrid"),receivedHeader:document.getElementById("receivedHeader"),sortFavBtn:document.getElementById("sortFavBtn"),doneSortBtn:document.getElementById("doneSortBtn"),shareFavBtn:document.getElementById("shareFavBtn"),shuffleBtn:document.getElementById("shuffleBtn"),resetOrderBtn:document.getElementById("resetOrderBtn")},i={tags:{},tagList:[],sounds:[],favorites:JSON.parse(localStorage.getItem("favorites")||"[]"),favSet:new Set,queryText:"",queryTags:new Set,soundMap:new Map,contextTimer:null,page:"home",receivedList:[],toastTimer:null,usedTagList:[],isSorting:!1,sortable:null,highlightedCardId:"",cgRunning:!1,defaultSoundsSnapshot:[]};i.favSet=new Set(i.favorites);let a=null;const r={el(t,e={},n=[]){const i=document.createElement(t);return Object.entries(e).forEach(([t,e])=>{"class"===t?i.className=e:"style"===t?Object.assign(i.style,e):t.startsWith("on")&&"function"==typeof e?i.addEventListener(t.substring(2),e):null!=e&&i.setAttribute(t,e)}),(Array.isArray(n)?n:[n]).filter(Boolean).forEach(t=>{"string"==typeof t?i.appendChild(document.createTextNode(t)):i.appendChild(t)}),i},svgHeart(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox","0 0 24 24"),t.innerHTML='<path d="M12 21s-6.716-4.438-9.428-7.15C.59 11.868.59 8.608 2.57 6.627 4.55 4.647 7.81 4.647 9.79 6.627L12 8.838l2.21-2.21c1.98-1.98 5.24-1.98 7.22 0 1.98 1.98 1.98 5.24 0 7.223C18.716 16.562 12 21 12 21z" fill="none" stroke="currentColor" stroke-width="1.5"/>',t}},o={slug:t=>t.normalize("NFKC").trim(),byId:t=>document.getElementById(t),saveFav(){localStorage.setItem("favorites",JSON.stringify(i.favorites))},inFav:t=>i.favSet.has(t),download(t,e){const n=document.createElement("a");n.href=t,n.download=e||"",document.body.appendChild(n),n.click(),n.remove()},parseQuery(){const t=i.queryText.trim(),e=t.length?t.split(/\s+/):[],n=new Set([...i.queryTags]),a=[];for(const t of e)t.startsWith("#")?n.add(o.slug(t.slice(1))):a.push(o.slug(t));return{terms:a,tags:n}},match(t,e,n){for(const e of n)if(!t.tags.some(t=>o.slug(t)===e))return!1;for(const n of e){const e=t.title.toLowerCase().includes(n.toLowerCase()),i=t.tags.some(t=>t.toLowerCase().includes(n.toLowerCase()));if(!e&&!i)return!1}return!0},debounce(t,e=200){let n=null;return(...i)=>{n&&clearTimeout(n),n=setTimeout(()=>{n=null;try{t(...i)}catch(t){console.error(t)}},e)}}},s="mix_tracks_v1",c={tracks:Array.from({length:3},()=>[]),playhead:0,pxPerSecond:30,contentDuration:0,timelineDuration:30,durationCache:new Map,durationRequests:new Map,history:[],future:[],isOpen:!1,isPlaying:!1,scrollRatio:0,initialized:!1},l={players:new Map,loading:new Map,rafId:0,startTime:0,startPlayhead:0,scheduleIds:[],toneStarted:!1};let d=null,u=null,m=!1,f=null;function p(){return Array.from({length:3},()=>[])}function g(t){if(!t||"object"!=typeof t)return null;return function(t){if(!t||"object"!=typeof t)return null;const e="string"==typeof t.soundId?t.soundId:"";if(!e)return null;const n=Number(t.start),i=Number(t.duration),a=Number(t.track);return!Number.isFinite(n)||n<0||!Number.isFinite(i)||i<=0||!Number.isInteger(a)||a<0||a>=3?null:{id:"string"==typeof t.id&&t.id?t.id:v(),soundId:e,start:h(n),duration:h(i),track:a}}({id:t.id,soundId:t.sid??t.soundId,start:t.st??t.start,duration:t.du??t.duration,track:t.tr??t.track})}function h(t){return Number.isFinite(t)?Number(t.toFixed(3)):0}function v(){return"cp-"+Math.random().toString(36).slice(3,6)+Date.now().toString(36).slice(-2)}function y(){let t=0;return c.tracks.forEach(e=>e.forEach(e=>{const n=e.start+e.duration;n>t&&(t=n)})),c.contentDuration=t,c.timelineDuration=Math.max(30,Math.ceil(t)),c.playhead>c.timelineDuration&&(c.playhead=c.timelineDuration),c.timelineDuration}function x(){return c.timelineDuration*c.pxPerSecond}function L(t,e){let n=!1;const i=h(e);c.tracks.forEach(e=>{e.forEach(e=>{e.soundId===t&&Math.abs(e.duration-i)>1e-4&&(e.duration=i,n=!0)})}),n&&(y(),M(),R())}function E(t,e){if(!t)return;const n=c.durationCache.get(t.id);if("number"==typeof n&&n>0)return;if(c.durationRequests.has(t.id))return;const i=new Audio;i.preload="metadata",i.src=t.src;const a=new Promise(n=>{const a=()=>{i.removeEventListener("loadedmetadata",r),i.removeEventListener("error",o),i.src=""},r=()=>{const r=Number(i.duration);if(a(),isFinite(r)&&r>0){const n=h(r);c.durationCache.set(t.id,n),L(t.id,n),e&&(e.duration=n)}n()},o=()=>{a(),n()};i.addEventListener("loadedmetadata",r,{once:!0}),i.addEventListener("error",o,{once:!0});try{i.load()}catch(t){a(),n()}});c.durationRequests.set(t.id,a),a.finally(()=>c.durationRequests.delete(t.id))}function S(t){const e=i.soundMap.get(t.soundId),n=e?.title||t.soundId,a=Math.max(t.duration*c.pxPerSecond,36),s=t.start*c.pxPerSecond,l=function(t){if(!t||!Array.isArray(t.tags))return"#64748b";for(const e of t.tags){const t=i.tags[o.slug(e)];if(t&&t.color)return t.color}return"#64748b"}(e),d=r.el("button",{class:"mix-clip-remove",type:"button","data-clip-id":t.id,"aria-label":"移除音效"},"×");d.addEventListener("click",e=>{e.stopPropagation(),function(t,{silent:e=!1,recordHistory:n=!0}={}){if(!t)return null;if(c.isPlaying)return null;const i=D(t);if(!i)return null;n&&H();const a=c.tracks[i.trackIndex],[r]=a.splice(i.index,1);y(),R(),M(),e||bt("已移除音效")}(t.id)});const u=r.el("span",{class:"mix-clip-title"},n),m=r.el("div",{class:"mix-clip","data-clip-id":t.id,style:{left:`${s}px`,width:`${a}px`,background:l},title:n},[u,d]);return m.dataset.start=String(t.start),m.dataset.duration=String(t.duration),m.dataset.track=String(t.track),m}function b(){const t=n.mixTrackLanes;if(!t)return;const e=x();t.querySelectorAll(".mix-track").forEach(t=>{t.style.width=e+"px",t.innerHTML=""}),c.tracks.forEach((e,n)=>{const a=t.querySelector(`.mix-track[data-track="${n}"]`);a&&(e.sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id)),e.forEach(t=>{!function(t){const e=i.soundMap.get(t.soundId);e&&(c.durationCache.has(e.id)||E(e,t))}(t);const e=S(t);a.appendChild(e)}))})}function B(){const t=n.mixPlayhead;if(!t)return;const e=c.playhead*c.pxPerSecond;t.style.left=`${e}px`}function T(){const t=n.mixScrollHost,e=n.mixScrollRange;if(!t||!e)return;const i=Math.max(0,t.scrollWidth-t.clientWidth);if(i<=1)return e.value="0",e.disabled=!0,void(c.scrollRatio=0);e.disabled=!1;const a=t.scrollLeft/i;c.scrollRatio=isFinite(a)?a:0,e.value=String(Math.round(100*c.scrollRatio))}function k(t){const e=n.mixScrollHost;if(!e)return;if(c.timelineDuration<=0)return;const i=t.deltaY||0,a=t.deltaX||0,r=Math.abs(i)>=Math.abs(a)?i:a;if(0===r)return;t.preventDefault();const o=r>0?-5:5;if(0===o)return;const s=e.getBoundingClientRect(),l=t.clientX-s.left,d=c.pxPerSecond;P(c.pxPerSecond+o,{persist:!1,anchorPixel:l}),d!==c.pxPerSecond&&(f&&clearTimeout(f),f=setTimeout(()=>{R(),f=null},240))}function I(){const t=n.mixScrollHost,e=n.mixScrollRange;if(!t||!e)return;const i=Math.max(0,t.scrollWidth-t.clientWidth),a=Number(e.value)/100;t.scrollLeft=i*a,c.scrollRatio=isFinite(a)?a:0,T()}function M(){if(!n.mixPanel)return;y();const t=x();if(n.mixScrollContent&&(n.mixScrollContent.style.width=`${t}px`),n.mixZoomRange){const t=String(Math.round(c.pxPerSecond));n.mixZoomRange.value!==t&&(n.mixZoomRange.value=t)}b();const e=n.mixScrollHost;if(e){const t=Math.max(0,e.scrollWidth-e.clientWidth);e.scrollLeft=t*c.scrollRatio}B(),T(),W()}function C(){const t=n.mixScrollHost;if(!t)return;const e=c.playhead*c.pxPerSecond;e<t.scrollLeft+40?t.scrollLeft=Math.max(0,e-40):e>t.scrollLeft+t.clientWidth-40&&(t.scrollLeft=Math.max(0,e-t.clientWidth+40)),T()}function w(t){const e=n.mixScrollHost;if(!e)return;const i=t.start*c.pxPerSecond,a=(t.start+t.duration)*c.pxPerSecond;i<e.scrollLeft+40?e.scrollLeft=Math.max(0,i-40):a>e.scrollLeft+e.clientWidth-40&&(e.scrollLeft=Math.max(0,a-e.clientWidth+40)),T()}function P(t,{persist:e=!0,maintainCenter:i=!1,anchorPixel:a=null}={}){const r=n.mixScrollHost,o=c.pxPerSecond,s=Math.min(120,Math.max(20,Number(t)||30));let l=c.scrollRatio;if(null!=a&&r){const t=Math.max(0,Math.min(a,r.clientWidth)),e=c.timelineDuration*o,n=r.scrollLeft+t,i=e>0?n/e:0,d=c.timelineDuration*s,u=d*i,m=Math.max(0,u-t),f=Math.max(0,d-r.clientWidth);l=f>0?m/f:0}else if(i&&r){const t=c.timelineDuration*o,e=r.scrollLeft+r.clientWidth/2,n=t>0?e/t:0,i=c.timelineDuration*s,a=i*n,d=Math.max(0,a-r.clientWidth/2),u=Math.max(0,i-r.clientWidth);l=u>0?d/u:0}if(Math.abs(s-c.pxPerSecond)<1e-4)e&&R();else{if(c.pxPerSecond=s,c.scrollRatio=Math.min(1,Math.max(0,l)),M(),r&&(i||null!=a)){const t=Math.max(0,r.scrollWidth-r.clientWidth);r.scrollLeft=t*c.scrollRatio,T()}if(n.mixZoomRange){const t=String(Math.round(c.pxPerSecond));n.mixZoomRange.value!==t&&(n.mixZoomRange.value=t)}e&&R()}}function R(){try{const t={plh:h(c.playhead),pps:c.pxPerSecond,trs:c.tracks.map(t=>t.map(t=>({id:t.id,sid:t.soundId,st:h(t.start),du:h(t.duration),tr:t.track})))};localStorage.setItem(s,JSON.stringify(t))}catch(t){console.warn("[mix] save failed",t)}}function A(){return c.tracks.some(t=>t.length>0)}function N(){return{playhead:c.playhead,tracks:c.tracks.map(t=>t.map(t=>({...t,start:h(t.start),duration:h(t.duration)})))}}function H(){c.history.push(N()),c.history.length>10&&c.history.shift(),c.future=[]}function F(t){c.tracks=t.tracks.map(t=>t.map(t=>({...t}))),c.playhead=t.playhead,y(),M(),R()}function q(){if(c.isPlaying||0===c.history.length)return;const t=c.history.pop();t&&(c.future.push(N()),c.future.length>10&&c.future.shift(),F(t))}function $(){if(c.isPlaying||0===c.future.length)return;const t=c.future.pop();t&&(c.history.push(N()),c.history.length>10&&c.history.shift(),F(t))}function W(){const t=c.isPlaying,e=A();n.mixUndoBtn&&(n.mixUndoBtn.disabled=t||0===c.history.length),n.mixRedoBtn&&(n.mixRedoBtn.disabled=t||0===c.future.length),n.mixPlayPauseBtn&&(n.mixPlayPauseBtn.disabled=!e,n.mixPlayPauseBtn&&(n.mixPlayPauseBtn.textContent=c.isPlaying?"⏸":"▶",n.mixPlayPauseBtn.setAttribute("aria-label",c.isPlaying?"暫停混音":"播放混音"))),n.mixClearBtn&&(n.mixClearBtn.disabled=t||!e),n.mixToStartBtn&&(n.mixToStartBtn.disabled=!e),n.mixToEndBtn&&(n.mixToEndBtn.disabled=!e)}function D(t){for(let e=0;e<3;e++){const n=c.tracks[e],i=n.findIndex(e=>e.id===t);if(-1!==i)return{clip:n[i],trackIndex:e,index:i}}return null}function O(t,{scroll:e=!0,persist:n=!0}={}){const i=h(Math.max(0,Math.min(t,c.timelineDuration)));c.playhead=i,B(),e&&C(),n&&!c.isPlaying&&R()}function j(){let t=1/0;c.tracks.forEach(e=>e.forEach(e=>{e.start<t&&(t=e.start)})),isFinite(t)||(t=0);const e=c.isPlaying;if(e&&ut(!1),O(t,{scroll:!0,persist:!e}),e){rt().length?dt():W()}}function Z(){const t=Math.max(c.contentDuration,0),e=c.isPlaying;if(e&&ut(!1),O(t,{scroll:!0,persist:!e}),e){rt().length?dt():W()}}function _(t,e){for(let n=0;n<3;n++){if(!c.tracks[n].some(n=>!(t+e<=n.start||t>=n.start+n.duration)))return n}return 0}function X(t){if(m)return void(m=!1);if(t.target.closest(".mix-clip"))return;const e=n.mixScrollHost;if(!e)return;const i=e.getBoundingClientRect(),a=(t.clientX-i.left+e.scrollLeft)/c.pxPerSecond,r=c.isPlaying;if(r&&ut(!1),O(a,{scroll:!0,persist:!r}),r){rt().length?dt():W()}}function G(){if(n.mixConfirmModal&&(n.mixConfirmModal.classList.remove("hidden"),n.mixConfirmModal.setAttribute("aria-hidden","false"),n.mixConfirmAccept))try{n.mixConfirmAccept.focus()}catch(t){}}function U(){if(n.mixConfirmModal&&(n.mixConfirmModal.classList.add("hidden"),n.mixConfirmModal.setAttribute("aria-hidden","true"),n.mixClearBtn))try{n.mixClearBtn.focus()}catch(t){}}function z(t){"Escape"===t.key&&n.mixConfirmModal&&!n.mixConfirmModal.classList.contains("hidden")&&U()}function J(t){const e=t.target.closest(".mix-clip");if(!e)return void function(t){const e=n.mixScrollHost,i=n.mixTrackLanes;if(!e||!i)return;if(void 0!==t.button&&0!==t.button)return;m=!1,u={pointerId:t.pointerId,startX:t.clientX,startScroll:e.scrollLeft,lanes:i};try{i.setPointerCapture(t.pointerId)}catch(t){}i.addEventListener("pointermove",Q),i.addEventListener("pointerup",V),i.addEventListener("pointercancel",tt)}(t);if(void 0!==t.button&&0!==t.button)return;if(t.target.closest(".mix-clip-remove"))return;if(c.isPlaying)return;const i=D(e.dataset.clipId||"");if(!i)return;const a=n.mixScrollHost,r=n.mixTrackLanes;if(!a||!r)return;const o=e.getBoundingClientRect(),s=a.getBoundingClientRect(),l=r.getBoundingClientRect(),f=t.clientX-o.left,p=t.clientY-o.top,g=document.createElement("div");g.className="mix-clip-placeholder",g.style.width=o.width+"px",g.style.height=o.height+"px";const h=e.parentElement;if(h){const t=parseFloat(e.style.left||"0"),n=i.clip.start*c.pxPerSecond,a=Number.isFinite(t)?t:n;g.style.left=a+"px",h.insertBefore(g,e)}r.appendChild(e);const v=o.width,y=o.height;e.classList.add("dragging"),e.style.position="absolute",e.style.zIndex="10",e.style.width=v+"px",e.style.left=`${t.clientX-l.left-f+a.scrollLeft}px`,e.style.top=o.top-l.top+"px",d={clip:i.clip,clipEl:e,placeholder:g,pointerId:t.pointerId,pointerOffsetX:f,pointerOffsetY:p,clipWidth:v,clipHeight:y,hostRect:s,lanesRect:l,originTrack:i.trackIndex,originStart:i.clip.start,trackHeight:r.querySelector(".mix-track")?.offsetHeight||36,historyCaptured:!1,currentTrack:i.trackIndex,currentStart:i.clip.start};try{e.setPointerCapture(t.pointerId)}catch(t){}e.addEventListener("pointermove",Y),e.addEventListener("pointerup",it),e.addEventListener("pointercancel",at),t.preventDefault()}function Y(t){if(!d||t.pointerId!==d.pointerId)return;const e=n.mixScrollHost;if(!e)return;if(!n.mixTrackLanes)return;const i=t.clientX-d.hostRect.left+e.scrollLeft-d.pointerOffsetX,a=Math.max(0,x()-d.clipWidth),r=Math.min(Math.max(0,i),a);d.clipEl.style.left=`${r}px`;const o=r/c.pxPerSecond,s=t.clientY-d.lanesRect.top-d.pointerOffsetY+d.clipHeight/2,l=d.trackHeight,u=Math.min(2,Math.max(0,Math.floor(s/l))),m=u*l+Math.max(0,(l-d.clipHeight)/2);d.clipEl.style.top=`${m}px`,d.currentTrack=u,d.currentStart=h(Math.max(0,o)),d.historyCaptured||(Math.abs(o-d.originStart)>5e-4||u!==d.originTrack)&&(H(),d.historyCaptured=!0);const f=Math.max(0,e.scrollWidth-e.clientWidth);t.clientX>d.hostRect.right-40?e.scrollLeft=Math.min(e.scrollLeft+14,f):t.clientX<d.hostRect.left+40&&(e.scrollLeft=Math.max(e.scrollLeft-14,0)),T()}function K(){if(!d)return;const{clipEl:t,placeholder:e}=d;e&&e.parentNode&&e.parentNode.removeChild(e),t&&(t.classList.remove("dragging"),t.style.position="",t.style.zIndex="",t.style.width="",t.style.left="",t.style.top="")}function Q(t){if(!u||t.pointerId!==u.pointerId)return;const e=n.mixScrollHost;if(!e)return;const i=t.clientX-u.startX;Math.abs(i)>2&&(m=!0);const a=Math.max(0,e.scrollWidth-e.clientWidth),r=Math.min(Math.max(u.startScroll-i,0),a);e.scrollLeft=r,T(),t.preventDefault()}function V(t){et(t,!1)}function tt(t){et(t,!0)}function et(t,e){if(!u||t.pointerId!==u.pointerId)return;const{lanes:n}=u;try{n.releasePointerCapture(t.pointerId)}catch(t){}n.removeEventListener("pointermove",Q),n.removeEventListener("pointerup",V),n.removeEventListener("pointercancel",tt),u=null,e&&(m=!1)}function nt(t,e){if(!d||t.pointerId!==d.pointerId)return;const{clip:n,clipEl:i,placeholder:a,originTrack:r,originStart:o,currentTrack:s,currentStart:l,historyCaptured:u}=d;try{i.releasePointerCapture(t.pointerId)}catch(t){}i.removeEventListener("pointermove",Y),i.removeEventListener("pointerup",it),i.removeEventListener("pointercancel",at);const m=Math.abs(l-o)>5e-4||s!==r;if(!u||!m||e)return u&&c.history.length>0&&c.history.pop(),K(),i&&i.parentNode&&i.parentNode.removeChild(i),M(),void(d=null);const f=c.tracks[r];if(s!==r){const t=f.indexOf(n);-1!==t&&f.splice(t,1),c.tracks[s].push(n),n.track=s}n.start=h(Math.max(0,l)),c.tracks[s].sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id)),s!==r&&f.sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id)),K(),i&&i.parentNode&&i.parentNode.removeChild(i),y(),R(),M(),w(n),d=null}function it(t){nt(t,!1)}function at(t){nt(t,!0)}function rt(){const t=c.playhead,e=[];return c.tracks.forEach(n=>{n.forEach(n=>{n.start+n.duration>t&&e.push(n)})}),e.sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id)),e}function ot(){return"undefined"!=typeof window&&"undefined"!=typeof Tone&&Tone&&void 0!==Tone.Transport}function st(t,e){return`${t}::${e}`}async function ct(t){const e=t.map(t=>{const e=i.soundMap.get(t.soundId);return e?async function(t,e){const n=st(t.id,e);if(l.players.has(n))return l.players.get(n);if(l.loading.has(n))return l.loading.get(n);if(!ot())throw new Error("Tone.js unavailable");const i=new Promise((e,i)=>{let a;try{a=new Tone.Player({url:t.src,autostart:!1,onload:()=>{l.players.set(n,a);const i=a.buffer?.duration;if(isFinite(i)&&i>0){const e=h(i);c.durationCache.set(t.id,e),L(t.id,e)}e(a)},onerror:t=>{try{a.dispose()}catch(t){}i(t||new Error("load failed"))}}).toDestination()}catch(t){if(a)try{a.dispose()}catch(t){}i(t)}});return l.loading.set(n,i),i.finally(()=>l.loading.delete(n))}(e,t.track):Promise.resolve()});await Promise.all(e)}function lt(){l.rafId&&(cancelAnimationFrame(l.rafId),l.rafId=0)}async function dt(){if(c.isPlaying)return;if(!A())return void bt("沒有可播放的片段");if(!ot())return void bt("Tone.js 載入失敗，無法播放");const t=rt();if(!t.length)return void bt("播放位置之後沒有音效");try{await async function(){if(!ot())throw new Error("Tone.js unavailable");l.toneStarted||(await Tone.start(),l.toneStarted=!0)}(),await ct(t)}catch(t){return console.error("[mix] player load error",t),void bt("音訊載入失敗")}try{Tone.Transport.stop(),Tone.Transport.cancel(),l.scheduleIds.forEach(t=>Tone.Transport.clear(t)),l.scheduleIds=[]}catch(t){console.warn("[mix] transport reset failed",t)}t.forEach(t=>{const e=st(t.soundId,t.track),n=l.players.get(e);if(!n)return;const i=Math.max(0,t.start-c.playhead),a=Math.max(0,c.playhead-t.start),r=t.duration-a;if(r<=0)return;const o=Tone.Transport.schedule(t=>{try{n.start(t,a,r)}catch(t){console.warn("[mix] player start failed",t)}},i);l.scheduleIds.push(o)});const e=Math.max(0,c.contentDuration-c.playhead);if(e>0){const t=Tone.Transport.schedule(()=>ut(!0),e+.05);l.scheduleIds.push(t)}l.startPlayhead=c.playhead,l.startTime=Tone.now(),c.isPlaying=!0,W();try{Tone.Transport.start("+0.02")}catch(t){return console.error("[mix] transport start error",t),c.isPlaying=!1,W(),void bt("播放啟動失敗")}!function(){lt();const t=()=>{if(!c.isPlaying||!ot())return;const e=Tone.now()-l.startTime,n=l.startPlayhead+e;c.playhead=Math.min(n,c.timelineDuration),B(),C(),l.rafId=requestAnimationFrame(t)};l.rafId=requestAnimationFrame(t)}()}function ut(t=!1){if(!ot())return c.isPlaying=!1,void W();try{Tone.Transport.stop(),Tone.Transport.cancel(),l.scheduleIds.forEach(t=>Tone.Transport.clear(t)),l.scheduleIds=[]}catch(t){console.warn("[mix] transport stop error",t)}if(l.players.forEach(t=>{try{t.stop()}catch(t){}}),lt(),!c.isPlaying)return;const e=Tone.now()-l.startTime,n=l.startPlayhead+Math.max(0,e);c.isPlaying=!1,O(Math.min(n,c.contentDuration),{scroll:!0,persist:!0}),t&&bt("播放結束"),W()}function mt(){c.isPlaying?ut(!1):dt()}function ft(t=!0){n.mixPanel&&(n.mixPanel.classList.remove("hidden"),n.mixPanel.setAttribute("aria-hidden","false"),c.isOpen=!0,M(),t&&C())}function pt(t,e={}){if(!t)return null;c.initialized||gt(),H();const n=h(Math.max(.5,Number(e.duration)||function(t){if(!t)return 2;const e=c.durationCache.get(t.id);return"number"==typeof e&&e>0?e:2}(t))),i=h(Math.max(0,Number.isFinite(e.start)?Number(e.start):c.playhead));let a=Number.isInteger(e.track)?Number(e.track):_(i,n);(a<0||a>=3)&&(a=_(i,n));const r={id:v(),soundId:t.id,start:i,duration:n,track:a};return c.tracks[a].push(r),c.tracks[a].sort((t,e)=>t.start-e.start),y(),R(),M(),ft(!1),w(r),E(t,r),r}function gt(){if(!c.initialized){if(c.initialized=!0,function(){try{const t=localStorage.getItem(s);if(!t)return c.tracks=p(),c.playhead=0,c.pxPerSecond=30,void y();const e=JSON.parse(t);if(!e||"object"!=typeof e)throw new Error("invalid mix payload");const n=p(),i=Array.isArray(e.trs)?e.trs:e.tracks;for(let t=0;t<3;t++){const e=Array.isArray(i?.[t])?i[t]:[];n[t]=e.map(g).filter(Boolean).sort((t,e)=>t.start-e.start||t.id.localeCompare(e.id))}c.tracks=n;const a=e.plh??e.playhead;c.playhead=h(Math.max(0,Number(a)||0));const r=Number(e.pps??e.pxPerSecond);Number.isFinite(r)&&r>=20&&r<=120?c.pxPerSecond=r:c.pxPerSecond=30,y()}catch(t){console.warn("[mix] load failed，已還原為預設值。",t),localStorage.removeItem(s),c.tracks=p(),c.playhead=0,c.pxPerSecond=30,y()}c.history=[],c.future=[],c.scrollRatio=0}(),M(),n.mixScrollHost&&(n.mixScrollHost.addEventListener("scroll",T,{passive:!0}),n.mixScrollHost.addEventListener("wheel",k,{passive:!1})),n.mixScrollRange&&n.mixScrollRange.addEventListener("input",I),n.mixZoomRange&&!n.mixZoomRange.dataset.mixBound?(n.mixZoomRange.dataset.mixBound="1",n.mixZoomRange.setAttribute("min",String(20)),n.mixZoomRange.setAttribute("max",String(120)),n.mixZoomRange.setAttribute("step","5"),n.mixZoomRange.value=String(Math.round(c.pxPerSecond)),n.mixZoomRange.addEventListener("input",t=>{P(Number(t.target.value),{persist:!1,maintainCenter:!0})}),n.mixZoomRange.addEventListener("change",t=>{P(Number(t.target.value),{persist:!0,maintainCenter:!0})})):n.mixZoomRange&&(n.mixZoomRange.value=String(Math.round(c.pxPerSecond))),n.mixTrackLanes){n.mixTrackLanes.addEventListener("click",X),n.mixTrackLanes.addEventListener("pointerdown",J);try{n.mixTrackLanes.addEventListener("contextmenu",t=>{t.preventDefault()}),n.mixTrackLanes.addEventListener("selectstart",t=>{t.preventDefault()})}catch(t){}}n.mixPlayPauseBtn&&n.mixPlayPauseBtn.addEventListener("click",mt),n.mixToStartBtn&&n.mixToStartBtn.addEventListener("click",j),n.mixToEndBtn&&n.mixToEndBtn.addEventListener("click",Z),n.mixUndoBtn&&n.mixUndoBtn.addEventListener("click",q),n.mixRedoBtn&&n.mixRedoBtn.addEventListener("click",$),n.mixClearBtn&&n.mixClearBtn.addEventListener("click",G),n.mixCloseBtn&&n.mixCloseBtn.addEventListener("click",()=>{ut(!1),n.mixPanel&&(n.mixPanel.classList.add("hidden"),n.mixPanel.setAttribute("aria-hidden","true"),c.isOpen=!1)}),n.mixConfirmCancel&&n.mixConfirmCancel.addEventListener("click",U),n.mixConfirmAccept&&n.mixConfirmAccept.addEventListener("click",()=>{!function({silent:t=!1}={}){!c.isPlaying&&A()&&(H(),c.tracks=p(),c.playhead=0,y(),R(),M(),t||bt("已清除所有音效"))}({silent:!1}),U()}),n.mixConfirmModal&&n.mixConfirmModal.addEventListener("click",t=>{t.target===n.mixConfirmModal&&U()}),document.addEventListener("keydown",z),n.openMixBtn&&!n.openMixBtn.dataset.mixBound&&(n.openMixBtn.dataset.mixBound="1",n.openMixBtn.addEventListener("click",()=>{gt(),ft(!0)})),W()}}function ht(){const{terms:t,tags:e}=o.parseQuery(),n=new URLSearchParams(window.location.search);return t.length?n.set("q",t.join(" ")):n.delete("q"),e.size?n.set("tags",[...e].join(",")):n.delete("tags"),n.delete("sound"),n}function vt(t=!1){const e=ht(),n=new URLSearchParams(location.search);n.has("list")&&e.set("list",n.get("list")),n.has("sound")&&e.set("sound",n.get("sound")),i.page&&"home"!==i.page?e.set("page",i.page):e.delete("page");const a=e.toString(),r=`${location.pathname}${a?"?"+a:""}`;(t?history.pushState:history.replaceState).call(history,null,"",r)}function yt(){const t=new URLSearchParams(location.search),e=t.get("q")||"",a=t.get("tags")||"";i.queryTags.clear();const r=a?a.split(",").map(t=>o.slug(t)).filter(Boolean):[];for(const t of r)i.queryTags.add(t);i.queryText=e;const s=r.map(t=>"#"+(i.tags[t]?.name||t));n.q.value=[e,...s].filter(Boolean).join(" ");const c=t.get("page");i.page="game"===c||"about"===c||"bg"===c?c:"home";const l=t.get("list");i.receivedList=l?l.split(",").filter(Boolean):[]}function xt(){const t=new URLSearchParams(location.search).get("sound");if(!t)return;const e=o.byId("snd-"+t);if(e){if(e.scrollIntoView({behavior:"smooth",block:"center"}),i.highlightedCardId){const t=o.byId("snd-"+i.highlightedCardId);t&&t.classList.remove("glow-persistent")}i.highlightedCardId=t,e.classList.add("glow-persistent")}}function Lt(t){const e=i.page;try{document.dispatchEvent(new CustomEvent("pageChange",{detail:{page:t,prevPage:e,phase:"before"}}))}catch(t){}i.page=t,n.pageHome.classList.add("hidden"),n.pageGame.classList.add("hidden"),n.pageAbout.classList.add("hidden"),n.pageBg&&n.pageBg.classList.add("hidden"),"home"===t?n.pageHome.classList.remove("hidden"):"game"===t?n.pageGame.classList.remove("hidden"):"about"===t?n.pageAbout.classList.remove("hidden"):"bg"===t&&n.pageBg&&n.pageBg.classList.remove("hidden"),n.navTabs.forEach(e=>{e.getAttribute("data-page")===t?e.classList.add("active"):e.classList.remove("active")}),document.body.classList.toggle("bg-full","bg"===t||"about"===t),document.body.classList.remove("nav-open"),n.navToggle&&n.navToggle.setAttribute("aria-expanded","false"),vt(!0);try{document.dispatchEvent(new CustomEvent("pageChange",{detail:{page:t,prevPage:e,phase:"after"}}))}catch(t){}}function Et(t){return navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).catch(()=>St(t)):St(t)}function St(t){const e=r.el("textarea",{style:{position:"fixed",left:"-9999px",top:"0"}},t);document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){}return e.remove(),Promise.resolve()}function bt(t,e=2200){const a=n.toast;a&&(i.toastTimer&&(clearTimeout(i.toastTimer),i.toastTimer=null),a.textContent=t,a.classList.remove("hidden"),e>0&&(i.toastTimer=setTimeout(()=>{a.classList.add("hidden"),i.toastTimer=null},e)))}function Bt(t,e,a){const s=n.menu;if(!s)return;s.innerHTML="";const c=r.el("div",{class:"menu-item",role:"menuitem",tabindex:"0"},"分享網址");c.addEventListener("click",async()=>{const e=function(t){const e=String(location.href||"").replace(/[?#].*$/,"");return`${e}${e.includes("?")?"&":"?"}sound=${encodeURIComponent(t)}`}(t.id);await Et(e),Tt(),bt("已複製分享連結");o.byId("snd-"+t.id)});const l=r.el("div",{class:"menu-item",role:"menuitem",tabindex:"0"},"加入軌道");l.addEventListener("click",()=>{Tt(),function(t){const e=i.soundMap.get(t)||i.sounds.find(e=>e.id===t);if(!e)return void bt("找不到音效");gt(),pt(e)&&bt("已加入混音軌道")}(t.id)});const d=r.el("div",{class:"menu-item",role:"menuitem",tabindex:"0"},"下載音檔");d.addEventListener("click",()=>{Tt(),o.download(t.src,t.file)}),s.append(c,l,d),s.classList.remove("hidden"),requestAnimationFrame(()=>function(t,e){const i=n.menu;if(!i)return;const a=6,r=i.offsetWidth||180,o=i.offsetHeight||100,s=window.innerWidth,c=window.innerHeight,l=Math.min(Math.max(0,t),s-r-a),d=Math.min(Math.max(0,e),c-o-a);i.style.left=l+"px",i.style.top=d+"px"}(e,a))}function Tt(){const t=n.menu;t&&(t.classList.add("hidden"),t.innerHTML="")}function kt(t){document.documentElement.classList.toggle("light","light"===t)}window.addEventListener("popstate",()=>{yt(),Ft(),xt()}),document.addEventListener("click",t=>{const e=n.menu;!e||e.classList.contains("hidden")||e.contains(t.target)||Tt()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&Tt()}),window.addEventListener("resize",Tt);kt(localStorage.getItem("theme")||(matchMedia("(prefers-color-scheme:light)").matches?"light":"dark")),n.themeBtn.addEventListener("click",()=>{const t=document.documentElement.classList.contains("light")?"dark":"light";"dark"==t&&function(t){const e=i.sounds.find(e=>e.id===t);if(!e)return;const n=new Audio(e.src);n.preload="auto",n.addEventListener("play",()=>Mt(e,n)),n.addEventListener("ended",()=>Ct(e,n)),n.play().catch(()=>{})}("oNTWqg"),localStorage.setItem("theme",t),kt(t)});const It=new Set;function Mt(e,a){const s=e.tags.map(t=>i.tags[o.slug(t)]).filter(t=>t&&"streamer"===t.role&&t.avatar);if(0===s.length)return;const c=r.el("div",{class:"group"});It.add(c),s.forEach((e,n)=>{const i=r.el("div",{class:"avatar pop-in jit",style:{animationDelay:60*n+"ms"}},[r.el("img",{src:t(e.avatar),alt:e.name})]);c.appendChild(i)}),n.stage.appendChild(c),a.__group=c}function Ct(t,e){const n=e.__group;if(!n)return;Array.from(n.children).forEach((t,e)=>{t.classList.remove("jit"),setTimeout(()=>{t.classList.add("hop-out"),t.addEventListener("animationend",()=>{t.remove(),0===n.childElementCount&&(n.remove(),It.delete(n))},{once:!0})},90*e)})}const wt="favorites",Pt="favorites_version",Rt=/^[A-Za-z0-9_-]{6}$/;function At(t){if(!t)return[];try{const e=JSON.parse(t);if(Array.isArray(e))return e.map(String);if(e&&"object"==typeof e)return Object.keys(e).filter(t=>!!e[t]).map(String)}catch(e){if("string"==typeof t)return t.split(/[,\s]+/).map(t=>t.trim()).filter(Boolean)}return[]}function Nt(t){if(!t)return"";let e=String(t);e=e.split("?")[0],e=e.replace(/^\.?\//,"");try{e=decodeURIComponent(e)}catch{}return e}function Ht(t){try{const e=localStorage.getItem(wt);if(!function(t){const e=At(t);return 0!==e.length&&!e.every(t=>Rt.test(t))}(e))return void localStorage.setItem(Pt,"2");const n=At(e),{exact:a,lower:r}=function(t){const e=new Map,n=new Map;return t.forEach(t=>{const i=Nt(t.file),a=i.split("/").pop(),r=t.id||a;[i,a,"sounds/"+i,"sounds/"+a].forEach(t=>{e.set(t,r),n.set(t.toLowerCase(),r)})}),{exact:e,lower:n}}(t),o=[],s=new Set,c=[];n.forEach(t=>{const e=Nt(t),n=e.split("/").pop(),i=[e,e.replace(/^sounds\//,""),n,"sounds/"+e,"sounds/"+n];let l=null;for(const t of i)if(l=a.get(t)||r.get(t.toLowerCase()),l)break;l?s.has(l)||(s.add(l),o.push(l)):c.push(t)}),localStorage.setItem("favorites_legacy_backup",e),localStorage.setItem(wt,JSON.stringify(o)),localStorage.setItem(Pt,"2"),i.favorites=o,i.favSet=new Set(o),bt(`已升級最愛格式，共 ${o.length} 筆${c.length?`；未匹配 ${c.length} 筆`:""}。`),console.info("[favorites migration] done:",{converted:o.length,missing:c})}catch(t){console.warn("[favorites migration] error:",t)}}function Ft(){const{terms:t,tags:e}=o.parseQuery(),a=i.sounds.filter(n=>o.match(n,t,e)),s=i.receivedList.map(t=>i.sounds.find(e=>e.id===t)).filter(Boolean),c=new Map(i.sounds.map(t=>[t.id,t])),l=new Set(a.map(t=>t.id)),d=i.favorites.map(t=>c.get(t)).filter(t=>t&&l.has(t.id)),u=s.filter(t=>a.includes(t)&&!i.favSet.has(t.id)),m=a.filter(t=>!i.favSet.has(t.id)&&!u.includes(t));i.isSorting||qt(n.favGrid,d,{inFav:!0}),qt(n.receivedGrid,u),qt(n.grid,m),n.favEmpty.classList.toggle("hidden",d.length>0),n.empty.classList.toggle("hidden",a.length>0),u.length>0?n.receivedSection&&n.receivedSection.classList.remove("hidden"):n.receivedSection&&n.receivedSection.classList.add("hidden"),function(){n.activeChips.innerHTML="";for(const t of i.queryTags){const e=i.tags[t],a=e?.color||"#94a3b8",o=r.el("span",{class:"chip",style:{background:a},onclick:()=>{i.queryTags.delete(t),Ft(),vt(!0)}},[`#${e?.name||t}`,r.el("button",{title:"移除",onclick:()=>{i.queryTags.delete(t),Ft(),vt(!0)}},"×")]);n.activeChips.appendChild(o)}}()}function qt(t,e,n={inFav:!1}){t.innerHTML="";for(const i of e)t.appendChild($t(i,n))}function $t(t,e={inFav:!1}){const n=!(!i.isSorting||!e.inFav),a={class:"heart","aria-pressed":String(o.inFav(t.id)),"aria-label":"加入/移除最愛"};n?(a.disabled="true",a["aria-disabled"]="true",a.title="正在編輯最愛排序，無法變更最愛"):a.onclick=e=>{e.stopPropagation(),function(t,e){if(i.isSorting)return void bt("正在編輯最愛排序，無法變更最愛");i.favSet.has(t)?i.favorites=i.favorites.filter(e=>e!==t):i.favorites.push(t);i.favSet=new Set(i.favorites),o.saveFav(),e&&e.setAttribute("aria-pressed",String(i.favSet.has(t)));Ft()}(t.id,s)};const s=r.el("button",a,r.svgHeart()),c=r.el("div",{class:"tags"});for(const e of t.tags){const t=o.slug(e),n=i.tags[t],a=n?.color||"#94a3b8",s=r.el("span",{class:"tag",style:{background:a}},e);s.addEventListener("click",e=>{e.stopPropagation(),Wt(t)}),c.appendChild(s)}const l=r.el("div",{id:"snd-"+t.id,"data-id":t.id,class:"sound",role:"button",tabindex:"0","aria-label":`播放音效：${t.title}`},[r.el("div",{class:"sound-top"},[r.el("div",{class:"title",title:t.title},t.title),s]),c]),d=async()=>{const e=new Audio(t.src);e.preload="auto",e.addEventListener("play",()=>Mt(t,e)),e.addEventListener("ended",()=>Ct(0,e));try{await e.play()}catch(t){console.error(t)}};i.isSorting&&e.inFav||l.addEventListener("click",d),i.isSorting&&e.inFav||l.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),d())}),i.isSorting&&e.inFav||l.addEventListener("contextmenu",e=>{e.preventDefault(),Tt(),Bt(t,e.clientX,e.clientY)});const u=()=>{clearTimeout(i.contextTimer)};return i.isSorting&&e.inFav||l.addEventListener("pointerdown",e=>{clearTimeout(i.contextTimer);const{clientX:n,clientY:a}=e;i.contextTimer=setTimeout(()=>{Tt(),Bt(t,n||window.innerWidth/2,a||window.innerHeight/2)},650)}),i.isSorting&&e.inFav||l.addEventListener("pointerup",u),i.isSorting&&e.inFav||l.addEventListener("pointerleave",u),l.addEventListener("pointercancel",u),l}function Wt(t){i.queryTags.add(t),Ft(),vt(!0)}function Dt(){n.q.addEventListener("input",o.debounce(()=>{i.queryText=n.q.value;const t=n.q.value,e=t.split(/\s+/).pop()||"",a=e.startsWith("#")?e.slice(1).toLowerCase():t.trim().toLowerCase();a?i.tagList.filter(t=>t.name.toLowerCase().includes(a)||t.key.toLowerCase().includes(a)):i.tagList.slice(0,8);Ft(),vt(!1)},180)),n.clearBtn.addEventListener("click",()=>{n.q.value="",i.queryText="",i.queryTags.clear(),Ft(),vt(!0)}),n.navTabs.forEach(t=>{t.addEventListener("click",()=>{Lt(t.getAttribute("data-page")||"home")})}),n.navToggle&&n.navToggle.addEventListener("click",()=>{const t=!document.body.classList.contains("nav-open");document.body.classList.toggle("nav-open",t),n.navToggle.setAttribute("aria-expanded",String(t))}),document.addEventListener("click",t=>{if(document.body.classList.contains("nav-open")){const e=document.querySelector("header");e&&!e.contains(t.target)&&(document.body.classList.remove("nav-open"),n.navToggle&&n.navToggle.setAttribute("aria-expanded","false"))}}),n.navTabs.forEach(t=>t.addEventListener("click",()=>{document.body.classList.remove("nav-open"),n.navToggle&&n.navToggle.setAttribute("aria-expanded","false")})),n.shuffleBtn&&n.shuffleBtn.addEventListener("click",()=>{const t=[],n=[];i.sounds.forEach((e,a)=>{i.favSet.has(e.id)||(t.push(e),n.push(a))}),e(t),n.forEach((e,n)=>{i.sounds[e]=t[n]}),Ft()}),n.resetOrderBtn&&n.resetOrderBtn.addEventListener("click",()=>{if(!i.defaultSoundsSnapshot||!i.defaultSoundsSnapshot.length)return;const t=i.defaultSoundsSnapshot,e=new Map(t.map((t,e)=>[t.id,e]));i.sounds.sort((t,n)=>(e.has(t.id)?e.get(t.id):Number.MAX_SAFE_INTEGER)-(e.has(n.id)?e.get(n.id):Number.MAX_SAFE_INTEGER)),Ft()}),n.sortFavBtn&&n.doneSortBtn&&(n.sortFavBtn.addEventListener("click",()=>{i.isSorting=!0,document.body.classList.add("sorting"),n.sortFavBtn.classList.add("hidden"),n.doneSortBtn.classList.remove("hidden");const{terms:t,tags:e}=o.parseQuery(),a=new Map(i.sounds.map(t=>[t.id,t])),r=new Set(i.sounds.filter(n=>o.match(n,t,e)).map(t=>t.id)),s=i.favorites.map(t=>a.get(t)).filter(t=>t&&r.has(t.id));qt(n.favGrid,s,{inFav:!0}),"undefined"!=typeof Sortable?i.sortable=Sortable.create(n.favGrid,{dataIdAttr:"data-id",animation:150,delay:150,delayOnTouchOnly:!0,ghostClass:"drag-ghost",chosenClass:"drag-chosen",dragClass:"dragging",filter:".heart",preventOnFilter:!1}):console.warn("SortableJS 未載入")}),n.doneSortBtn.addEventListener("click",()=>{const t=Array.from(n.favGrid.children).map(t=>t.getAttribute("data-id")).filter(Boolean);if(t.length){const e=i.favorites.filter(e=>!t.includes(e));i.favorites=t.concat(e),i.favSet=new Set(i.favorites),o.saveFav(),bt("已儲存最愛排序")}i.sortable&&(i.sortable.destroy(),i.sortable=null),i.isSorting=!1,document.body.classList.remove("sorting"),n.doneSortBtn.classList.add("hidden"),n.sortFavBtn.classList.remove("hidden"),Ft()})),n.shareFavBtn&&n.shareFavBtn.addEventListener("click",async()=>{const t=[...i.favorites];if(0===t.length)return void bt("沒有最愛可分享");const e=function(t){const e=ht();t&&t.length?e.set("list",t.join(",")):e.delete("list"),e.delete("sound");const n=e.toString();return`${location.origin}${location.pathname}${n?"?"+n:""}`}(t);await Et(e),bt("已複製分享最愛列表連結")})}function Ot(){const n=document.getElementById("concentration-game"),r=document.getElementById("cg-board"),s=document.getElementById("cg-timer"),c=document.getElementById("cg-accuracy"),l=document.getElementById("cg-result"),d=document.getElementById("cg-restart");if(!n)return;let u=[],m=null,f=null,p=0,g=0,h=0,v=0,y=0,x=null,L=!1,E=!0,S=[],b=null,B=null,T=!1;function k(){const t=i.tagList.filter(t=>"streamer"===t.role).map(t=>o.slug(t.key)),n=e=>t.includes(e);let a=i.sounds.filter(t=>1===t.tags.filter(n).length&&(!t.tags.includes("髒話")&&!t.tags.includes("SUS")));a=e(a);let r=function(t){let e=[],n=0,i=0,a=0,r=0,o=0,s=0,c=0;for(const l of t){const t=Array.isArray(l.tags)?l.tags:[];if(n<2&&t.includes("阿萬")?(n++,e.push(l)):i<1&&t.includes("瓦哈")?(i++,e.push(l)):a<1&&t.includes("Matsuko")?(a++,e.push(l)):r<1&&t.includes("豹子頭")?(r++,e.push(l)):o<1&&t.includes("貓下去")?(o++,e.push(l)):s<1&&(t.includes("貓下去")||t.includes("豹子頭")||t.includes("Matsuko")||t.includes("豹子頭")||t.includes("瓦哈"))?(s++,e.push(l)):!(t.includes("阿萬")||t.includes("瓦哈")||t.includes("豹子頭")||t.includes("貓下去")||t.includes("Matsuko"))&&c<2&&(c++,e.push(l)),e.length>=8)break}return e.slice(0,8)}(a);return r=e(r),r.splice(8),r.map(t=>{const e=t.tags.find(n),a=i.tags[o.slug(e)];return{id:t.id,audio:t.src,streamer:e,avatar:a?.avatar||"",streamerName:a?.name||e,title:t.title}})}function I(){if(S=k(),!S||0===S.length)return l.innerHTML='<h3>無法開始遊戲</h3><p style="color:var(--muted)">目前沒有足夠的音效可供配對（需至少 1 組）。請回到主頁或稍後再試。</p>',l.classList.remove("hidden"),L=!1,void(i.cgRunning=!1);u=[];try{b&&(clearTimeout(b),b=null,B=null)}catch(t){}S.forEach((t,e)=>{u.push({type:"card",pairId:t.id,id:`${t.id}-0`,audio:t.audio,avatar:t.avatar,streamer:t.streamer,streamerName:t.streamerName,title:t.title,matched:!1,seen:!1}),u.push({type:"card",pairId:t.id,id:`${t.id}-1`,audio:t.audio,avatar:t.avatar,streamer:t.streamer,streamerName:t.streamerName,title:t.title,matched:!1,seen:!1})}),e(u),h=0,p=0,g=0,v=0,y=0,m=null,f=null,E=!0,T=!1,L=!1,i.cgRunning=!1,s&&(s.textContent=A(y),s.classList.remove("cg-running")),M(),R(),l.classList.add("hidden"),a=()=>{L=!1,i.cgRunning=!1,N(),w(),s&&s.classList.remove("cg-running"),r.innerHTML="";try{b&&(clearTimeout(b),b=null,B=null)}catch(t){}}}function M(){r.innerHTML="",u.forEach((e,n)=>{const a=document.createElement("div");a.className="cg-card",a.dataset.idx=n,(e.flipped||e.matched)&&a.classList.add("flipped"),e.matched&&a.classList.add("matched");const o=e.avatar?`<img src="${t(e.avatar)}" alt="${e.streamerName}">`:`<div style="font-weight:700;color:var(--muted);font-size:12px">${e.streamerName}</div>`;a.innerHTML=`\n        <div class="cg-card-inner">\n          <div class="cg-card-front"></div>\n          <div class="cg-card-back">\n            ${o}\n            ${e.matched?'<div class="cg-lock">✓</div>':""}\n          </div>\n        </div>\n      `,a.onclick=()=>function(t){if(void 0!==B&&B&&(B.f||B.s)){b&&(clearTimeout(b),b=null);const t=B;B=null,P(t.f,t.s),m=null,f=null,E=!0}if(!E)return;const e=u[t];if(e.flipped||e.matched)return;T||(T=!0,L=!0,i.cgRunning=!0,s&&s.classList.add("cg-running"),function(){x&&clearInterval(x);x=setInterval(()=>{i.cgRunning&&(y++,s.textContent=A(y))},1e3)}());if(e.flipped=!0,M(),m){if(!f){e._seenBefore=!!e.seen,e.seen=!0,f=e,w(),C=new Audio(e.audio),C.play().catch(()=>{}),e.title&&bt(e.title,3e3),v++,E=!1;B={f:m,s:f},b&&(clearTimeout(b),b=null),b=setTimeout(()=>{b=null;const t=B;B=null,P(t.f,t.s),m=null,f=null,E=!0},500)}}else e._seenBefore=!!e.seen,e.seen=!0,m=e,w(),C=new Audio(e.audio),C.play().catch(()=>{}),e.title&&bt(e.title,3e3);R()}(n),a.addEventListener("pointerdown",t=>{a.classList.add("clicked"),setTimeout(()=>a.classList.remove("clicked"),160)}),r.appendChild(a)})}let C=null;function w(){if(C){try{C.pause(),C.currentTime=0}catch(t){}C=null}}function P(t,e){if(t&&e){if(t.pairId===e.pairId)t.matched=!0,e.matched=!0,p+=2,h+=1;else{const n=!!t._seenBefore,i=!!e._seenBefore;n&&i?g+=2:(n||i)&&(g+=1),t.flipped=!1,e.flipped=!1}delete t._seenBefore,delete e._seenBefore,M(),R(),h===S.length&&(w(),function(){L=!1,i.cgRunning=!1,N(),w(),s&&s.classList.remove("cg-running");const t=p+g,e=t?Math.round(p/t*100):"--";l.innerHTML=`\n            <h3>完成！</h3>\n            <div class="stats">\n              <div><div class="big-num">${A(y)}</div><div class="muted">用時</div></div>\n              <div><div class="big-num">${p}</div><div class="muted">正確數</div></div>\n              <div><div class="big-num">${g}</div><div class="muted">錯解數</div></div>\n              <div><div class="big-num">${e}%</div><div class="muted">準確率</div></div>\n            </div>\n            <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">\n              <button class="btn small-btn" id="cg-restart-2">再來一局</button>\n              <button class="btn small-btn" id="cg-home">回主頁</button>\n            </div>\n          `,l.classList.remove("hidden");try{if(e>=90){const t=["c4B1fg","Hv3yFA","JkJ9-A","5VHtAg"],e=i.sounds&&i.sounds.find(e=>e.id===t[Math.floor(Math.random()*t.length)]);e&&e.src&&(w(),C=new Audio(e.src),C.play().catch(()=>{}),bt("你是記憶猛肝",3e3))}}catch(t){}const n=document.getElementById("cg-restart-2");n&&n.addEventListener("click",()=>{I()});const a=document.getElementById("cg-home");a&&a.addEventListener("click",()=>{Lt("home")})}())}}function R(){s.textContent=A(y);const t=p+g,e=t?Math.round(p/t*100):null;c.textContent=null!==e?`準確率：${e}%`:"準確率：--%"}function A(t){return`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`}function N(){x&&clearInterval(x),x=null}d.onclick=I,I()}(async function(){const[e,n]=await Promise.all([fetch(t("config/tags.json"),{cache:"no-store"}).then(t=>t.json()),fetch(t("config/sounds.json"),{cache:"no-store"}).then(t=>t.json())]);Ht(n),i.tags={},i.tagList=e.map(t=>({key:o.slug(t.key),name:t.name,color:t.color,role:t.role,avatar:t.avatar}));for(const t of i.tagList)i.tags[o.slug(t.key)]=t;i.sounds=n.map(e=>({id:e.id||e.file.replace(/^.*[\\\/]/,""),src:t(`sounds/${e.file}`),file:e.file,title:e.title,tags:e.tags.slice()})),i.soundMap=new Map(i.sounds.map(t=>[t.id,t])),i.defaultSoundsSnapshot=i.sounds.map(t=>({...t}));const a=new Set;i.sounds.forEach(t=>t.tags.forEach(t=>a.add(o.slug(t)))),i.usedTagList=i.tagList.filter(t=>a.has(t.key))})().then(()=>{yt(),function(){const t=n.tagList;t&&(t.innerHTML="",i.usedTagList.forEach(e=>{const n=r.el("span",{class:"tag",style:{background:e.color||"#94a3b8"}},e.name);n.addEventListener("click",()=>{Wt(e.key)}),t.appendChild(n)}))}(),gt(),Lt(i.page),Ft(),xt(),Dt();try{const t=document.querySelector("header h1");t&&t.addEventListener("click",t=>{if(!(t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)){if("home"===i.page)return location.reload();t.preventDefault(),i.queryText="",i.queryTags.clear(),n.q&&(n.q.value=""),Lt("home"),Ft(),vt(!0);try{window.scrollTo({top:0,behavior:"smooth"})}catch(t){}}})}catch(t){}}).catch(t=>{console.error(t),n.grid.innerHTML='<div class="empty">載入設定檔失敗，請確認 <code>config/</code> 路徑是否正確。</div>'}),document.addEventListener("pageChange",t=>{const e=t&&t.detail&&t.detail.page,n=t&&t.detail&&t.detail.prevPage;try{const i=t&&t.detail&&t.detail.phase;if("before"===i&&"game"===n&&"function"==typeof a)try{a()}catch(t){}"after"===i&&"game"===e&&Ot()}catch(t){}})}()</script></body></html>